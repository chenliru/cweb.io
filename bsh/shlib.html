<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #FF0000;
}
.sc4 {
	font-weight: bold;
	color: #0000FF;
}
.sc5 {
	color: #808080;
}
.sc6 {
	color: #808080;
}
.sc7 {
	font-weight: bold;
	color: #804000;
}
.sc8 {
}
.sc9 {
	font-weight: bold;
	color: #FF8040;
	background: #FFFFD9;
}
.sc10 {
	color: #008080;
	background: #00FFFF;
}
.sc11 {
	font-weight: bold;
	color: #804040;
	background: #E1FFF3;
}
.sc12 {
	font-weight: bold;
	color: #FFFF00;
	background: #FF0000;
}
.sc13 {
	color: #FF0000;
	background: #FFFF80;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">#!/bin/ksh93</span><span class="sc0">
</span><span class="sc2">#######################################################################</span><span class="sc0">
</span><span class="sc2"># SHELL SCRIPTS TOOLS LIBRARY</span><span class="sc0">
</span><span class="sc2">#----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2"># Author : Liru Chen</span><span class="sc0">
</span><span class="sc2"># Licensed Materials - Property of LIRU; All Rights Reserved 2015-2019</span><span class="sc0">
</span><span class="sc2">#######################################################################</span><span class="sc0">
</span><span class="sc4">set</span><span class="sc0"> </span><span class="sc8">-x</span><span class="sc0">          </span><span class="sc2">#display each line as it actually executes</span><span class="sc0">
</span><span class="sc2">#set -v         #display each lineas the shell reads it, therefore, </span><span class="sc0">
                </span><span class="sc2">#displaying comments, functions definitions,and so on.</span><span class="sc0">

</span><span class="sc2">#Set up running environment</span><span class="sc0">
</span><span class="sc8">PROFILEBASE</span><span class="sc7">=</span><span class="sc5">"/login/lchen/tools"</span><span class="sc0">
</span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-f</span><span class="sc0"> </span><span class="sc9">$PROFILEBASE</span><span class="sc7">/</span><span class="sc8">shlib.</span><span class="sc11">$(hostname)</span><span class="sc0"> </span><span class="sc7">];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">.</span><span class="sc0"> </span><span class="sc9">$PROFILEBASE</span><span class="sc7">/</span><span class="sc8">shlib.</span><span class="sc11">$(hostname)</span><span class="sc0">            </span><span class="sc2">#cron.$$.LOG 2&gt;&amp;1</span><span class="sc0">

</span><span class="sc2">##Date &amp; Time</span><span class="sc0">
</span><span class="sc8">current_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">
</span><span class="sc8">current_time</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">

</span><span class="sc2">#Mail address</span><span class="sc0">
</span><span class="sc8">mail_alert</span><span class="sc7">=</span><span class="sc10">${MAILALERT:="lchen@livingstonintl.com"}</span><span class="sc0">
</span><span class="sc8">mail_notice</span><span class="sc7">=</span><span class="sc10">${MAILNOTICE:="lchen@livingstonintl.com"}</span><span class="sc0">

</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : mail attachment</span><span class="sc0">
</span><span class="sc2"># $1: mail_subject (no_space_in_subject)</span><span class="sc0">
</span><span class="sc2"># $2: attachment file's directory</span><span class="sc0">
</span><span class="sc2"># $3: attachment file's name (only one)</span><span class="sc0">
</span><span class="sc2"># $4: recipients' email address (could be many email addresses)</span><span class="sc0">
</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc8">mail_Linux</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"PLEASE FIND ATTACHMENT FROM $(hostname)"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
</span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc7">/</span><span class="sc9">$3</span><span class="sc0"> </span><span class="sc9">$4</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">mail_AIX</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$4</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
PLEASE FIND ATTACHMENT FROM $(hostname)
~&lt;!uuencode $2/$3 $(basename $3)
EOF</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : ftp script</span><span class="sc0">
</span><span class="sc2"># $1: remote host name</span><span class="sc0">
</span><span class="sc2"># $2: user name</span><span class="sc0">
</span><span class="sc2"># $3: password</span><span class="sc0">
</span><span class="sc2"># $4: file local directory</span><span class="sc0">
</span><span class="sc2"># $5: file remote directory</span><span class="sc0">
</span><span class="sc2"># $6: remote file name</span><span class="sc0">
</span><span class="sc2"># $7: local file name</span><span class="sc0">
</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc8">ftp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vn</span><span class="sc0"> </span><span class="sc12">&lt;&lt; END_OF_PUT</span><span class="sc13">
open $1
user $2 $3
bin
lcd $4
cd $5
put $6 $7
bye
END_OF_PUT</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">ftp_get</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc8">ftp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vn</span><span class="sc0"> </span><span class="sc12">&lt;&lt; END_OF_GET</span><span class="sc13">
open $1
user $2 $3
bin
lcd $4
cd $5
get $6 $7
bye
END_OF_GET</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#For GUI on your workstation, </span><span class="sc0">
</span><span class="sc2">#1. check that ssh X11 forwarding requests are allowed on server side:</span><span class="sc0">
</span><span class="sc2">#   grep X11Forwarding /etc/ssh/sshd_config: X11Forwarding yes</span><span class="sc0">
</span><span class="sc2">#   If it's necessary, change the value from "no" to "yes", and restart the ssh service</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   AIX Service Resource:</span><span class="sc0">
</span><span class="sc2">#   stopsrc –s sshd; sleep 2; startsrc –s sshd</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#2. Now set the X11 forwarding on your workstation ssh client side tool</span><span class="sc0">
</span><span class="sc8">aix_src</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">aix_service</span><span class="sc7">=</span><span class="sc10">${AIXSERVICE:=sshd}</span><span class="sc0">

    </span><span class="sc8">stopsrc</span><span class="sc0"> –</span><span class="sc8">s</span><span class="sc0"> </span><span class="sc10">${aix_service}</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc8">startsrc</span><span class="sc0"> –</span><span class="sc8">s</span><span class="sc0"> </span><span class="sc10">${aix_service}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc2"># check_ssh_key: check for ssh key for given ip or host</span><span class="sc0">
</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc8">ssh_check</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0">
</span><span class="sc7">{</span><span class="sc0">
     </span><span class="sc8">ssh_knownhost</span><span class="sc7">=</span><span class="sc5">"$HOME/.ssh/known_hosts"</span><span class="sc0">
     </span><span class="sc4">ls</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">la</span><span class="sc0"> </span><span class="sc9">$ssh_knownhost</span><span class="sc0">

    </span><span class="sc8">ls_ssh_knownhost</span><span class="sc7">=</span><span class="sc11">$(ls -la $ssh_knownhost 2&gt;/dev/null)</span><span class="sc0">
    </span><span class="sc8">rc</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc2"># RC=0 OK</span><span class="sc0">
    </span><span class="sc2"># RC=2 &gt; file does not exist &lt;</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: rc=${rc} ssh_knownhost=${ls_ssh_knownhost}&lt;"</span><span class="sc0">

    </span><span class="sc2"># rsa or dss</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc8">-A</span><span class="sc0"> </span><span class="sc8">sshkey</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"ssh-"</span><span class="sc0"> </span><span class="sc10">${ssh_knownhost}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $1" "$2}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">sshhost</span><span class="sc0"> </span><span class="sc8">sshkeytype</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
      </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc9">$i</span><span class="sc7">+</span><span class="sc3">1</span><span class="sc0">
      </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${sshhost}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc8">IFS</span><span class="sc7">=</span><span class="sc5">","</span><span class="sc0"> </span><span class="sc8">read</span><span class="sc0"> </span><span class="sc8">hostip1</span><span class="sc0"> </span><span class="sc8">hostip2</span><span class="sc0"> </span><span class="sc8">hostip3</span><span class="sc0">
      </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${hostip3}</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
      </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${hostip2}</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
          </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc2"># only 1 entry</span><span class="sc0">
          </span><span class="sc8">sshkey</span><span class="sc7">[</span><span class="sc9">$i</span><span class="sc7">]=</span><span class="sc10">${hostip1}</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
          </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc2"># two entries found</span><span class="sc0">
          </span><span class="sc8">sshkey</span><span class="sc7">[</span><span class="sc9">$i</span><span class="sc7">]=</span><span class="sc10">${hostip1}</span><span class="sc0">
          </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc9">$i</span><span class="sc7">+</span><span class="sc3">1</span><span class="sc0">
          </span><span class="sc8">sshkey</span><span class="sc7">[</span><span class="sc9">$i</span><span class="sc7">]=</span><span class="sc10">${hostip2}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
      </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"Unexpected Error. hostip3=${hostip3}"</span><span class="sc0">
        </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc9">$i</span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc2"># more than two - nothing set</span><span class="sc0">
      </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0"> </span><span class="sc2"># grep ssh_key</span><span class="sc0">
    </span><span class="sc8">sshkey</span><span class="sc7">[</span><span class="sc3">0</span><span class="sc7">]=</span><span class="sc10">${i}</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[0]=${sshkey[0]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[1]=${sshkey[1]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[2]=${sshkey[2]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[3]=${sshkey[3]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[4]=${sshkey[4]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[5]=${sshkey[5]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[6]=${sshkey[6]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[7]=${sshkey[7]}&lt;"</span><span class="sc0">
    </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: sshkey[8]=${sshkey[8]}&lt;"</span><span class="sc0">
    
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">idx</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc8">AWCONST</span><span class="sc0"> </span><span class="sc5">"ssh_key: check for &gt;${host_ip}&lt;"</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$idx</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc10">${sshkey[0]}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
       </span><span class="sc4">let</span><span class="sc0"> </span><span class="sc8">idx</span><span class="sc7">=</span><span class="sc9">$idx</span><span class="sc7">+</span><span class="sc3">1</span><span class="sc0">
       </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${host_ip}</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc10">${sshkey[$idx]}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
       </span><span class="sc4">then</span><span class="sc0">
         </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc2"># FOUND !</span><span class="sc0">
         </span><span class="sc8">AWCONST</span><span class="sc0"> </span><span class="sc5">"ssh_key: found ${host_ip}"</span><span class="sc0">
         </span><span class="sc8">key_status</span><span class="sc7">=</span><span class="sc5">"OK"</span><span class="sc0">
         </span><span class="sc4">break</span><span class="sc0"> </span><span class="sc2"># leave the loop as we are done</span><span class="sc0">
       </span><span class="sc4">else</span><span class="sc0">
         </span><span class="sc8">key_status</span><span class="sc7">=</span><span class="sc5">"KO"</span><span class="sc0">
         </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${ssh_key_trace}</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"ON"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
         </span><span class="sc4">then</span><span class="sc0">
           </span><span class="sc8">ssh_key_trace</span><span class="sc7">=</span><span class="sc5">"OFF"</span><span class="sc0"> </span><span class="sc2"># set to OFF. (do it only once)</span><span class="sc0">
           </span><span class="sc8">AWTRACE</span><span class="sc0"> </span><span class="sc5">"ssh_key: search &gt;${sshkey[$idx]}&lt;"</span><span class="sc0">
         </span><span class="sc4">fi</span><span class="sc0"> </span><span class="sc2"># ssh_key_trace</span><span class="sc0">
       </span><span class="sc4">fi</span><span class="sc0">
     </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">ssh_key</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ssh_key_host</span><span class="sc7">=</span><span class="sc10">${1-$FTPHOST}</span><span class="sc0">
    </span><span class="sc8">ssh_key_user</span><span class="sc7">=</span><span class="sc10">${2-$FTPUSER}</span><span class="sc0">
    </span><span class="sc8">ssh_key_passwd</span><span class="sc7">=</span><span class="sc10">${3-$FTPPASSWD}</span><span class="sc0">
    </span><span class="sc8">ssh_key_publickey</span><span class="sc7">=</span><span class="sc10">${4-"Publickey"}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"${ssh_key_host}"</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">ftp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vn</span><span class="sc0"> </span><span class="sc12">&lt;&lt; END_OF_KEY</span><span class="sc13">
    open ${ssh_key_host}
    user ${ssh_key_user} ${ssh_key_passwd}
    bin
    lcd $HOME/.ssh
    append ${ssh_key_publickey} ./.ssh/authorized_keys
    bye
END_OF_KEY</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">ssh_port</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">

</span><span class="sc2"># ssh -f -g -L *:local_port:localhost:remote_port remote_server sleep 10</span><span class="sc0">

</span><span class="sc2"># The bind_address of 'localhost' indicates that the listening port </span><span class="sc0">
</span><span class="sc2"># be bound for local use only, while an empty address or '*' </span><span class="sc0">
</span><span class="sc2"># indicates that the port should be available from all interfaces</span><span class="sc0">
</span><span class="sc2"># -g  Allows remote hosts to connect to local forwarded ports.</span><span class="sc0">

</span><span class="sc2"># The following example tunnels an telnet session from client</span><span class="sc0">
</span><span class="sc2"># machine '127.0.0.1' (localhost) to remote server 'ifx01'</span><span class="sc0">
</span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0"> </span><span class="sc3">1234</span><span class="sc7">:</span><span class="sc8">ifx01</span><span class="sc7">:</span><span class="sc3">6800</span><span class="sc0"> </span><span class="sc8">ifx01</span><span class="sc0"> </span><span class="sc8">sleep</span><span class="sc0"> </span><span class="sc3">100</span><span class="sc0">
</span><span class="sc2">#             |     |     |</span><span class="sc0">
</span><span class="sc2">#             -------------</span><span class="sc0">
</span><span class="sc2"># This tunnels a connection to remote server 'ifx01', using port 1234.  </span><span class="sc0">
</span><span class="sc2"># It doesn't matter which port is used, as long as it's greater than </span><span class="sc0">
</span><span class="sc2"># 1023 (remember, only root can open sockets on privileged ports) and </span><span class="sc0">
</span><span class="sc2"># doesn't conflict with any ports already in use.  The connection is </span><span class="sc0">
</span><span class="sc2"># forwarded to port 6800 on the remote server interface:10.253.133.30</span><span class="sc0">
</span><span class="sc2"># (DNS name: ifx01), the first ifx01 in above example, since that's the</span><span class="sc0">
</span><span class="sc2"># standard port for informix server services.</span><span class="sc0">

</span><span class="sc2"># However, an explicit bind_address may be used to bind the </span><span class="sc0">
</span><span class="sc2"># connection to a specific address. </span><span class="sc0">

</span><span class="sc2"># The -f option backgrounds ssh and the remote command 'sleep</span><span class="sc0">
</span><span class="sc2"># 100' is specified to allow an amount of time (100 seconds, in</span><span class="sc0">
</span><span class="sc2"># the example) to start the service which is to be tunnelled.</span><span class="sc0">

</span><span class="sc8">telnet</span><span class="sc0"> </span><span class="sc8">ifx01</span><span class="sc0"> </span><span class="sc3">6800</span><span class="sc0">   </span><span class="sc2"># If no connections are made within the time</span><span class="sc0">
                    </span><span class="sc2"># specified, ssh will exit, then port forwarding</span><span class="sc0">
                    </span><span class="sc2"># is no long availble.</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">ssh_cmd</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc7">:</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">ssh_guicmd</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc7">:</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : cpu_idle</span><span class="sc0">
</span><span class="sc2"># Purpose : use vmstat to find out CPU usage on a system.</span><span class="sc0">
</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2"># vmstat display 6 head lines on Sun, 6 on AIX and 2 on Linux</span><span class="sc0">
</span><span class="sc2"># After head lines, display 19 data lines(one page) on Sun, 20 on AIX</span><span class="sc0">
</span><span class="sc2"># and 21 on Linux.., so had to avoid that...</span><span class="sc0">
</span><span class="sc8">cpu_idle</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">18</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b avm fre re pi po fr sr cy in sy cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">19</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b avm fre re pi po fr sr cy in sy cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">alias</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc7">=</span><span class="sc6">'echo -e'</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">20</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b swpd free buff cache si so bi bo in cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">intr</span><span class="sc7">=</span><span class="sc10">${1-1}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-30}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">total_id</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#echo $vmstat_param</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">org_cnt</span><span class="sc7">=</span><span class="sc9">$counter</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(uname -srvmn) $(date '+%m/%d/%Y')"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"TIME\t\tcpu(%idle)"</span><span class="sc0">

    </span><span class="sc2">#vmstat data collection more then one page</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">loop_counter</span><span class="sc7">=</span><span class="sc9">$vmstat_page_ctr</span><span class="sc0">
        </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc8">counter-loop_counter</span><span class="sc0">

        </span><span class="sc8">vmstat</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$vmstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$vmstat_param</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S') \t$id"</span><span class="sc0">

            </span><span class="sc8">total_id</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$id</span><span class="sc7">+</span><span class="sc9">$total_id</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

            </span><span class="sc8">loop_counter</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$loop_counter</span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$loop_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2">#Continue loop on 2nd level</span><span class="sc0">
                </span><span class="sc2">#that's "while [ $counter -gt $vmstat_page_ctr ]" level</span><span class="sc0">
                </span><span class="sc4">continue</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2">#echo Total :</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                </span><span class="sc8">avg_id</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_id</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$avg_id"</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc2">#data collection no more then one page, just loop till the end.</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc9">$vmstat_page_ctr</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">vmstat</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$vmstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$vmstat_param</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S') \t$id"</span><span class="sc0">

            </span><span class="sc8">counter</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">total_id</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$id</span><span class="sc7">+</span><span class="sc9">$total_id</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2">#echo Total :</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                </span><span class="sc8">avg_id</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_id</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$avg_id"</span><span class="sc0">
                </span><span class="sc2">#exit 0</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : mem_pipo</span><span class="sc0">
</span><span class="sc2"># Purpose : use vmstat to find out memory page in/out</span><span class="sc0">
</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc2"># vmstat display 6 head lines on Sun, 6 on AIX and 2 on Linux</span><span class="sc0">
</span><span class="sc2"># After head lines, display 19 data lines(one page) on Sun, 20 on AIX</span><span class="sc0">
</span><span class="sc2"># and 21 on Linux.., so had to avoid that...</span><span class="sc0">
</span><span class="sc8">mem_pipo</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">18</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b avm fre re pi po fr sr cy in sy cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">19</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b avm fre re pi po fr sr cy in sy cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">alias</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc7">=</span><span class="sc6">'echo -e'</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc7">=</span><span class="sc3">20</span><span class="sc0">
        </span><span class="sc8">vmstat_param</span><span class="sc7">=</span><span class="sc5">"r b swpd free buff cache pi po bi bo in cs us sy id etcetc"</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">vmstat_head</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">intr</span><span class="sc7">=</span><span class="sc10">${1-1}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-30}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">total_pi</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">total_po</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#echo $vmstat_param</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">org_cnt</span><span class="sc7">=</span><span class="sc9">$counter</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(uname -srvmn) $(date '+%m/%d/%Y')"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Time\t\tPageIn\tPageOut"</span><span class="sc0">

    </span><span class="sc2">#vmstat data collection more then one page</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">vmstat_page_ctr</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">loop_counter</span><span class="sc7">=</span><span class="sc9">$vmstat_page_ctr</span><span class="sc0">
        </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc8">counter-loop_counter</span><span class="sc0">

        </span><span class="sc8">vmstat</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$vmstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$vmstat_param</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S') \t$pi\t$po"</span><span class="sc0">

            </span><span class="sc8">total_pi</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$pi</span><span class="sc7">+</span><span class="sc9">$total_pi</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">total_po</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$po</span><span class="sc7">+</span><span class="sc9">$total_po</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">loop_counter</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$loop_counter</span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$loop_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2">#Continue loop on 2nd level</span><span class="sc0">
                </span><span class="sc2">#that's "while [ $counter -gt $vmstat_page_ctr ]" level</span><span class="sc0">
                </span><span class="sc4">continue</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2">#echo Total :</span><span class="sc0">
                </span><span class="sc2">#echo kB in : $total_pi kB out : $total_po</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                </span><span class="sc8">avg_pi</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_pi</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc8">avg_po</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_po</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$(( $avg_pi+$avg_po ))"</span><span class="sc0">
                </span><span class="sc2">#exit 0</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc2">#DATA collection no more then one page, just loop till the end</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc9">$vmstat_page_ctr</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">vmstat</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$vmstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$vmstat_param</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"`date '+%H:%M:%S'` \t$pi\t$po"</span><span class="sc0">
            </span><span class="sc8">counter</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">total_pi</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$pi</span><span class="sc7">+</span><span class="sc9">$total_pi</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">total_po</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$po</span><span class="sc7">+</span><span class="sc9">$total_po</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2"># echo Total :</span><span class="sc0">
                </span><span class="sc2"># echo kB in : $total_pi kB out : $total_po</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                </span><span class="sc8">avg_pi</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_pi</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc8">avg_po</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$total_po</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$(( $avg_pi+$avg_po ))"</span><span class="sc0">
                </span><span class="sc2">#exit 0</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : disk_active</span><span class="sc0">
</span><span class="sc2"># Purpose : use iostat to find %tm_act, the percentage of time the physical </span><span class="sc0">
</span><span class="sc2">#           disk/tape was active (bandwidth utilization for the drive)</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">disk_active</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">iostat_com</span><span class="sc7">=</span><span class="sc5">"iostat"</span><span class="sc0"> 
        </span><span class="sc8">iostat_param</span><span class="sc7">=</span><span class="sc5">"Disks utilization etcetc"</span><span class="sc0">
        </span><span class="sc8">iostat_head</span><span class="sc7">=</span><span class="sc3">8</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">iostat_com</span><span class="sc7">=</span><span class="sc5">"iostat"</span><span class="sc0">
        </span><span class="sc8">iostat_param</span><span class="sc7">=</span><span class="sc5">"Disks utilization etcetc"</span><span class="sc0">
        </span><span class="sc8">iostat_head</span><span class="sc7">=</span><span class="sc3">8</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">iostat_com</span><span class="sc7">=</span><span class="sc5">"iostat -d -x"</span><span class="sc0">
        </span><span class="sc4">alias</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc7">=</span><span class="sc6">'echo -e'</span><span class="sc0">
        </span><span class="sc8">iostat_param</span><span class="sc7">=</span><span class="sc5">"Disks rrqm wrqm r w rsec wsec avgrq avgqu await svctm utilization"</span><span class="sc0">
        </span><span class="sc8">iostat_head</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">intr</span><span class="sc7">=</span><span class="sc10">${1-1}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-30}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">org_cnt</span><span class="sc7">=</span><span class="sc9">$counter</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">DISK_NUM</span><span class="sc7">=</span><span class="sc11">$($iostat_com | tail -n +$iostat_head | awk '{print $1}' | wc -l)</span><span class="sc0">
    </span><span class="sc8">DISK_NAME</span><span class="sc7">=(</span><span class="sc11">$($iostat_com | tail -n +$iostat_head | awk '{print $1}')</span><span class="sc7">)</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$DISK_NUM</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Found $DISK_NUM disks...${DISK_NAME[*]}"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">disk_activity</span><span class="sc7">=(</span><span class="sc5">""</span><span class="sc7">)</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">DISK_NUM</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">disk_activity</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(uname -srvmn) $(date '+%m/%d/%Y')"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"TIME\t\tDiskName\tDiskActive%"</span><span class="sc0">

    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">org_cnt</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">j</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
        </span><span class="sc9">$iostat_com</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$iostat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$iostat_param</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$PLATFORM"</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">utilization</span><span class="sc7">=</span><span class="sc8">utilization</span><span class="sc7">*</span><span class="sc3">100</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S')\t$Disks\t$utilization"</span><span class="sc0">

            </span><span class="sc8">disk_activity</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]=$((</span><span class="sc0"> </span><span class="sc9">$utilization</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc10">${disk_activity[j]}</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">j</span><span class="sc7">=</span><span class="sc8">j+1</span><span class="sc0">

            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$j</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$DISK_NUM</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">break</span><span class="sc0">
   
        </span><span class="sc4">done</span><span class="sc0">

        </span><span class="sc8">org_cnt</span><span class="sc7">=</span><span class="sc8">org_cnt-1</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">avg_activity</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">k</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">k</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">DISK_NUM</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc2"># echo Total :</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage disk utilization(%) of ${DISK_NAME[k]}:\c"</span><span class="sc0">
        </span><span class="sc8">avg_activity</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc10">${disk_activity[k]}</span><span class="sc7">/</span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$avg_activity"</span><span class="sc0">
        </span><span class="sc8">k</span><span class="sc7">=</span><span class="sc8">k+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">############################################################################</span><span class="sc0">
</span><span class="sc2"># Program : net_io</span><span class="sc0">
</span><span class="sc2"># Purpose : use netstat to find network traffic</span><span class="sc0">
</span><span class="sc2">############################################################################</span><span class="sc0">
</span><span class="sc2"># netstat -I display 3 head lines on Sun, 3 on AIX and 2 on Linux</span><span class="sc0">
</span><span class="sc2"># After head lines, display 19 data lines(one page) on Sun, 20 on AIX</span><span class="sc0">
</span><span class="sc2"># and 8 on Linux.., so had to avoid that...</span><span class="sc0">
</span><span class="sc8">net_io</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">netstat_com</span><span class="sc7">=</span><span class="sc5">"netstat -I "</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">netstat_page_ctr</span><span class="sc7">=</span><span class="sc3">18</span><span class="sc0">
        </span><span class="sc8">netstat_param</span><span class="sc7">=</span><span class="sc5">"ipk ierr opk oerr"</span><span class="sc0">
        </span><span class="sc8">netstat_head</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
        </span><span class="sc2">#get_interface_name</span><span class="sc0">
        </span><span class="sc2">#get_interface_name</span><span class="sc0">
        </span><span class="sc8">if_num</span><span class="sc7">=</span><span class="sc11">$(netstat -i | grep link | awk '{print $1}' | wc -l)</span><span class="sc0">
        </span><span class="sc8">if_name</span><span class="sc7">=(</span><span class="sc11">$(netstat -i | grep link | awk '{print $1}')</span><span class="sc7">)</span><span class="sc0"> 
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">netstat_com</span><span class="sc7">=</span><span class="sc5">"netstat -I "</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">netstat_page_ctr</span><span class="sc7">=</span><span class="sc3">19</span><span class="sc0">
        </span><span class="sc8">netstat_param</span><span class="sc7">=</span><span class="sc5">"ipk ierr opk oerr"</span><span class="sc0">
        </span><span class="sc8">netstat_head</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
        </span><span class="sc2">#get_interface_name</span><span class="sc0">
        </span><span class="sc8">if_num</span><span class="sc7">=</span><span class="sc11">$(netstat -i | grep link | awk '{print $1}' | wc -l)</span><span class="sc0">
        </span><span class="sc8">if_name</span><span class="sc7">=(</span><span class="sc11">$(netstat -i | grep link | awk '{print $1}')</span><span class="sc7">)</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">netstat_com</span><span class="sc7">=</span><span class="sc5">"netstat -I="</span><span class="sc0">
        </span><span class="sc4">alias</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc7">=</span><span class="sc6">'echo -e'</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">netstat_page_ctr</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
        </span><span class="sc8">netstat_param</span><span class="sc7">=</span><span class="sc5">"Iface mtusz Met ipk RXERR RXDRP RXOVR opk TXERR"</span><span class="sc0">
        </span><span class="sc8">netstat_head</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
        </span><span class="sc2">#get_interface_number and names</span><span class="sc0">
        </span><span class="sc8">if_num</span><span class="sc7">=</span><span class="sc11">$(netstat -I | tail -n +3 | awk '{print $1}' |  wc -l)</span><span class="sc0">
        </span><span class="sc8">if_name</span><span class="sc7">=(</span><span class="sc11">$(netstat -I | tail -n +3 | awk '{print $1}')</span><span class="sc7">)</span><span class="sc0"> 
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">intr</span><span class="sc7">=</span><span class="sc10">${1-1}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-30}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">total_ipk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">total_opk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">interface</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${if_name[@]}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">org_cnt</span><span class="sc7">=</span><span class="sc9">$counter</span><span class="sc0">

        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">if_counter</span><span class="sc7">=</span><span class="sc9">$counter</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">if_total_ipk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">if_total_opk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">if_avg_ipk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">if_avg_opk</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">mtusz</span><span class="sc7">=</span><span class="sc11">$(netstat -I $interface | grep link | awk '{print $2}')</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(uname -srvmn) $(date '+%m/%d/%Y') "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"TIME\t\tkB IN\t\tkB OUT ON INTERFACE $interface"</span><span class="sc0">

        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">if_counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">netstat_page_ctr</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">loop_counter</span><span class="sc7">=</span><span class="sc9">$netstat_page_ctr</span><span class="sc0">
            </span><span class="sc8">if_counter</span><span class="sc7">=</span><span class="sc8">if_counter-loop_counter</span><span class="sc0">

            </span><span class="sc9">$netstat_com$interface</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$netstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
            </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$netstat_param</span><span class="sc0">
            </span><span class="sc4">do</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S')\t$((($ipk*$mtusz/$intr)/1024))\t\t$((($opk*$mtusz/$intr)/1024))"</span><span class="sc0">
                </span><span class="sc8">if_total_ipk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc0"> </span><span class="sc9">$ipk</span><span class="sc7">*</span><span class="sc9">$mtusz</span><span class="sc7">/</span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">)/</span><span class="sc3">1024</span><span class="sc7">+</span><span class="sc9">$if_total_ipk</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc8">if_total_opk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc0"> </span><span class="sc9">$opk</span><span class="sc7">*</span><span class="sc9">$mtusz</span><span class="sc7">/</span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">)/</span><span class="sc3">1024</span><span class="sc7">+</span><span class="sc9">$if_total_opk</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

                </span><span class="sc8">loop_counter</span><span class="sc7">=</span><span class="sc8">loop_counter-1</span><span class="sc0">
                
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$loop_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc2"># Continue loop on 2nd level</span><span class="sc0">
                    </span><span class="sc2"># that's "while [ $if_counter -gt $vmstat_page_ctr ]" level</span><span class="sc0">
                    </span><span class="sc4">continue</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">
 
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$if_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc2"># echo Total :</span><span class="sc0">
                    </span><span class="sc2"># echo kB ipk : $total_in KB OUT : $total_opk</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                    </span><span class="sc8">if_avg_ipk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$if_total_ipk</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                    </span><span class="sc8">if_avg_opk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$if_total_opk</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$if_avg_ipk\t\t$if_avg_opk\t\t$(( $if_avg_ipk+$if_avg_opk ))"</span><span class="sc0">
                    </span><span class="sc4">break</span><span class="sc0"> 
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">done</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$if_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc9">$netstat_page_ctr</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc9">$netstat_com$interface</span><span class="sc0"> </span><span class="sc9">$intr</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc9">$netstat_head</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
            </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc9">$netstat_param</span><span class="sc0">
            </span><span class="sc4">do</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date '+%H:%M:%S')\t$(( ( $ipk*$mtusz/$intr )/1024 ))\t\t$(( ( $opk*$mtusz/$intr )/1024 ))"</span><span class="sc0">
                </span><span class="sc8">if_counter</span><span class="sc7">=</span><span class="sc8">if_counter-1</span><span class="sc0">
                
                </span><span class="sc8">if_total_ipk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc9">$ipk</span><span class="sc7">*</span><span class="sc9">$mtusz</span><span class="sc7">/</span><span class="sc9">$intr</span><span class="sc7">)/</span><span class="sc3">1024</span><span class="sc7">+</span><span class="sc9">$if_total_ipk</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc8">if_total_opk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc9">$opk</span><span class="sc7">*</span><span class="sc9">$mtusz</span><span class="sc7">/</span><span class="sc9">$intr</span><span class="sc7">)/</span><span class="sc3">1024</span><span class="sc7">+</span><span class="sc9">$if_total_opk</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
 
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$if_counter</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc2"># echo Total :</span><span class="sc0">
                    </span><span class="sc2"># echo kB in : $total_ipk KB OUT : $total_opk</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nAverage:\c"</span><span class="sc0">
                    </span><span class="sc8">if_avg_ipk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$if_total_ipk</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                    </span><span class="sc8">if_avg_opk</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc9">$if_total_opk</span><span class="sc7">/</span><span class="sc9">$org_cnt</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t$if_avg_ipk\t\t$if_avg_opk\t\t$(( $if_avg_ipk+$if_avg_opk ))"</span><span class="sc0">
                    </span><span class="sc4">break</span><span class="sc0"> 
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">done</span><span class="sc0">

        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">mping</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc9">$MONITORSYSTEMS</span><span class="sc0">   
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">systemCount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">

    </span><span class="sc2"># Login the UNIX Systems in the listing</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">xCount</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc9">$xCount</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$systemCount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">ping</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"SYSTEM $1 CANNOT BE CONNECTED !"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0"> 

    </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc8">xCount</span><span class="sc7">=</span><span class="sc8">xCount+1</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#####################################################################</span><span class="sc0">
</span><span class="sc2">#SCRIPT TO CHECK WHETHER CERTAIN JOBS ARE RUNNING NORMALLY </span><span class="sc0">
</span><span class="sc2">#IF JOB NOT RUNNING NIRMALLY, THEN SEND EMAIL ALEARTS</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#USAGE: </span><span class="sc0">
</span><span class="sc2">#~~~~~~</span><span class="sc0">
</span><span class="sc2">#If the instance number of deamon is less than or more than supposed</span><span class="sc0">
</span><span class="sc2">#instance number, dmon will kill all instance, and run deamon start</span><span class="sc0">
</span><span class="sc2">#command (if exist) to set deamon in a normal situation</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#CHANGE HISTORY:</span><span class="sc0">
</span><span class="sc2">#~~~~~~~~~~~~~~~</span><span class="sc0">
</span><span class="sc2">#1. Modified version by Liru Chen</span><span class="sc0">
</span><span class="sc2">#                 - 23 April 2015</span><span class="sc0">
</span><span class="sc2">#####################################################################</span><span class="sc0">
</span><span class="sc8">dmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">idx</span><span class="sc0"> </span><span class="sc8">deamon_cnt</span><span class="sc0"> </span><span class="sc8">deamon_num</span><span class="sc0">

    </span><span class="sc2">#######################################################</span><span class="sc0">
    </span><span class="sc2"># processname to the list update below. </span><span class="sc0">
    </span><span class="sc2">#######################################################</span><span class="sc0">
    </span><span class="sc8">deamons</span><span class="sc7">=</span><span class="sc10">${DEAMON:="LoadL_master"}</span><span class="sc0">
    
    </span><span class="sc8">dmon_date</span><span class="sc7">=</span><span class="sc11">$(date +%m%d%Y%H%M%S)</span><span class="sc0">
    </span><span class="sc8">dmon_dir</span><span class="sc7">=</span><span class="sc10">${DMONDIR:="${TMP}"}</span><span class="sc0">           </span><span class="sc2">#directory of deamon command</span><span class="sc0">
    </span><span class="sc8">dmon_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_DMON_</span><span class="sc10">${dmon_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">deamon</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${deamons}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">deamon_name</span><span class="sc7">=</span><span class="sc11">$(echo ${deamon} | cut -f1 -d, )</span><span class="sc0">
        </span><span class="sc8">deamon_num</span><span class="sc7">=</span><span class="sc11">$(echo ${deamon} | cut -f2 -d, )</span><span class="sc0">
        </span><span class="sc8">deamon_start</span><span class="sc7">=</span><span class="sc11">$(echo ${deamon} | cut -f3 -d, )</span><span class="sc0">
        </span><span class="sc8">deamon_stop</span><span class="sc7">=</span><span class="sc11">$(echo ${deamon} | cut -f4 -d, )</span><span class="sc0">
        
        </span><span class="sc8">deamon_cnt</span><span class="sc7">=</span><span class="sc11">$(ps -ef|grep ${deamon_name}|grep -v grep|wc -l)</span><span class="sc0">
        
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${deamon_cnt}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc10">${deamon_num}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${deamon_name} Instance Number ${deamon_cnt} less than defined"</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) DEAMON ${deamon_name} less than Instance Number"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

            </span><span class="sc8">deamon_pid</span><span class="sc7">=</span><span class="sc11">$(ps -ef|grep -v grep|grep ${deamon_name}|awk '{print $2}')</span><span class="sc0">
            
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${deamon_start}</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">"NONE"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">deamon_kill</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${deamon_pid}</span><span class="sc0">
                </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc4">kill</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">9</span><span class="sc0"> </span><span class="sc10">${deamon_kill}</span><span class="sc0">
                </span><span class="sc4">done</span><span class="sc0">
                
                </span><span class="sc10">${dmon_dir}</span><span class="sc7">/</span><span class="sc10">${deamon_start}</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
            
        </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${deamon_cnt}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc10">${deamon_num}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${deamon_name} Instance Number ${deamon_cnt} more than defined"</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) DEAMON ${deamon_name} more than Instance Number"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            
            </span><span class="sc8">deamon_pid</span><span class="sc7">=</span><span class="sc11">$(ps -ef|grep -v grep|grep ${deamon_name}|awk '{print $2}')</span><span class="sc0">
            
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${deamon_start}</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">"NONE"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">deamon_kill</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${deamon_pid}</span><span class="sc0">
                </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc4">kill</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">9</span><span class="sc0"> </span><span class="sc10">${deamon_kill}</span><span class="sc0">
                </span><span class="sc4">done</span><span class="sc0">
                
                </span><span class="sc10">${dmon_dir}</span><span class="sc7">/</span><span class="sc10">${deamon_start}</span><span class="sc0">

            </span><span class="sc7">}</span><span class="sc0">
    
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#########################################################</span><span class="sc0">
</span><span class="sc2"># Program : fsckusage displays information about total</span><span class="sc0">
</span><span class="sc2"># space and available space on a file system. The</span><span class="sc0">
</span><span class="sc2"># FileSystem parameter specifies the name of the</span><span class="sc0">
</span><span class="sc2"># device on which the file system resides, the</span><span class="sc0">
</span><span class="sc2"># directory on which the file system is mounted, or</span><span class="sc0">
</span><span class="sc2"># the relative path name of a file system.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Purpose : use "df -k" to find system storage usage</span><span class="sc0">
</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc2">#df -k display file system name on 6 column on Linux, </span><span class="sc0">
</span><span class="sc2">#7 on AIX and 7 on SunOS</span><span class="sc0">
</span><span class="sc2">#Used% on 5 on Linux, 4 on AIX and 4 on SunOS</span><span class="sc0">
</span><span class="sc8">fsckusage</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_used_id</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_used_id</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_used_id</span><span class="sc7">=</span><span class="sc3">5</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2"># check file system usage</span><span class="sc0">
    </span><span class="sc4">df</span><span class="sc0"> </span><span class="sc8">-k</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tail</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{ print $'</span><span class="sc9">$fs_used_id</span><span class="sc6">'}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0">  </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">fsckdiff</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-f</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">date</span><span class="sc0">  </span><span class="sc7">&gt;</span><span class="sc0">  </span><span class="sc8">tmp_fc</span><span class="sc9">$$</span><span class="sc0">
        </span><span class="sc4">df</span><span class="sc0"> </span><span class="sc8">-k</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc9">$$</span><span class="sc0">
        </span><span class="sc4">diff</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc9">$$</span><span class="sc0">
        </span><span class="sc4">mv</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">date</span><span class="sc0">  </span><span class="sc7">&gt;</span><span class="sc0">  </span><span class="sc8">tmp_fc</span><span class="sc0">
        </span><span class="sc4">df</span><span class="sc0"> </span><span class="sc8">-k</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_fc</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># df -k display file-system name on 6 column on Linux, 7 on AIX and 7 on SunOS</span><span class="sc0">
</span><span class="sc2"># Used% on 5 on Linux, 4 on AIX and 4 on SunOS</span><span class="sc0">
</span><span class="sc8">fsckfull</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------------------- "</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Following File System space usage changed "</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------------------- "</span><span class="sc0">
    </span><span class="sc8">fsckdiff</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n--------------------------------------------- "</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Following File System(s) space full "</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"---------------------------------------------- "</span><span class="sc0">
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_name_id</span><span class="sc7">=</span><span class="sc3">7</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_head</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
        </span><span class="sc8">fs_name_id</span><span class="sc7">=</span><span class="sc3">2</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">fs_head</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
        </span><span class="sc8">fs_name_id</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">fsnames</span><span class="sc7">=</span><span class="sc11">$(mount | tail -n +$fs_head | awk '{print $'$fs_name_id'}')</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">fsname</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$fsnames</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">fsckusage</span><span class="sc0"> </span><span class="sc9">$fsname</span><span class="sc0"> </span><span class="sc5">"(9[0-9]|100)"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"WARNING: FILE SYSTEM $fsname IS FULL, ABOVE 90% SPACE USED"</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2"># Description: mperf &lt;interval&gt; &lt;counter&gt;</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># A system administrator should intuitively know when the system </span><span class="sc0">
</span><span class="sc2"># has gone into the "red zone". This is usually accompanied by </span><span class="sc0">
</span><span class="sc2"># their phone ringing as users call to complain about system performance.</span><span class="sc0">
</span><span class="sc2"># But there are more empirical measurements that an administrator can </span><span class="sc0">
</span><span class="sc2"># look for to show that the system is in imminent danger:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># 1. Average processor utilization exceeds 90%.</span><span class="sc0">
</span><span class="sc2"># 2. Network utilization exceeds 50% of network card(s) capacity</span><span class="sc0">
</span><span class="sc2"># 3. Available real memory starts Pages In and Pages Out,</span><span class="sc0">
</span><span class="sc2">#    Any substantive paging activity is occurring</span><span class="sc0">
</span><span class="sc2"># 4. Disk utilizations exceed 90% (this is cumulative activity, </span><span class="sc0">
</span><span class="sc2">#    or the ?tm acct? column from iostat).</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">mperf</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2">#Set following bench mark according to your system performance</span><span class="sc0">
    </span><span class="sc8">threshold_cpu_idle</span><span class="sc7">=</span><span class="sc10">${CPUIDLE:=10}</span><span class="sc0">
    </span><span class="sc8">threshold_mem_pio</span><span class="sc7">=</span><span class="sc10">${MEMPIO:=50}</span><span class="sc0">
    </span><span class="sc8">threshold_disk_activity</span><span class="sc7">=</span><span class="sc10">${DISKACTIVITY:=90}</span><span class="sc0">
    </span><span class="sc8">threshold_net_package</span><span class="sc7">=</span><span class="sc10">${NETPACKAGE:=1250000}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    
    </span><span class="sc2">##################################################################</span><span class="sc0">
    </span><span class="sc2"># Program : call alert_filesystem</span><span class="sc0">
    </span><span class="sc2">##################################################################</span><span class="sc0">
    </span><span class="sc8">fsckfull</span><span class="sc0">    </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_filesystem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    
    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_STORAGE_UTILIZATION_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_filesystem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
    
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_filesystem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">##################################################################</span><span class="sc0">
    </span><span class="sc2"># Program : call cpu_idle</span><span class="sc0">
    </span><span class="sc2">##################################################################</span><span class="sc0">
    </span><span class="sc8">interval</span><span class="sc7">=</span><span class="sc10">${1-2}</span><span class="sc0">
    </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-10}</span><span class="sc0">
    
    </span><span class="sc8">cpu_idle</span><span class="sc0"> </span><span class="sc9">$interval</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">#the highest recently used CPU-intensive user processes</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" Top 10 CPU intensive processes "</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">TIME</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">k4</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">head</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc8">cpu</span><span class="sc7">=</span><span class="sc11">$( grep Average tmp_cpu$$.txt | awk '{print $2}' )</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$cpu"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc5">"$threshold_cpu_idle"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0">  </span><span class="sc5">"$(hostname)_CPU_BUSY_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_cpu</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">#####################################################################</span><span class="sc0">
    </span><span class="sc2"># Program : call disk_active</span><span class="sc0">
    </span><span class="sc2">#####################################################################</span><span class="sc0">
    </span><span class="sc2">#[[ $(uname) = AIX ]] &amp;&amp; (filemon -o diskfmon.$$.txt -O all)  </span><span class="sc0">
    </span><span class="sc8">interval</span><span class="sc7">=</span><span class="sc10">${1-2}</span><span class="sc0">
    </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-10}</span><span class="sc0">

    </span><span class="sc8">disk_active</span><span class="sc0"> </span><span class="sc9">$interval</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0">  </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_disk</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">#if [[ $(uname) = AIX ]]; then</span><span class="sc0">
    </span><span class="sc2">#   trcstop </span><span class="sc0">
    </span><span class="sc2">#   sleep 10</span><span class="sc0">
    </span><span class="sc2">#   echo "\n\n\n" &gt;&gt; tmp_disk$$.txt</span><span class="sc0">
    </span><span class="sc2">#   cat diskfmon.$$  &gt;&gt; tmp_disk$$.txt</span><span class="sc0">
    </span><span class="sc2">#fi</span><span class="sc0">

    </span><span class="sc8">disk_usage</span><span class="sc7">=</span><span class="sc11">$( grep Average tmp_disk$$.txt | awk '{print $6}' )</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">disk</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$disk_usage</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$disk"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc5">"$threshold_disk_activity"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0"> 
            </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_DISK_BUSY_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_disk</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_disk</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">######################################################################</span><span class="sc0">
    </span><span class="sc2"># Program : call mem_pipo</span><span class="sc0">
    </span><span class="sc2">######################################################################</span><span class="sc0">
    </span><span class="sc8">interval</span><span class="sc7">=</span><span class="sc10">${1-2}</span><span class="sc0">
    </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-10}</span><span class="sc0">

    </span><span class="sc8">mem_pipo</span><span class="sc0"> </span><span class="sc9">$interval</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_mem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc8">mem</span><span class="sc7">=</span><span class="sc11">$( grep Average tmp_mem$$.txt | awk '{print $2}' )</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$mem"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc5">"$threshold_mem_pio"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_MEMORY_PIPO_BUSY_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_mem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_mem</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">######################################################################</span><span class="sc0">
    </span><span class="sc2"># Program : call net_io</span><span class="sc0">
    </span><span class="sc2">######################################################################</span><span class="sc0">
    </span><span class="sc2">#[[ $(uname) = AIX ]] &amp;&amp; (netpmon -v -o ${TMP}/netnmon.$$.txt)</span><span class="sc0">
    </span><span class="sc8">interval</span><span class="sc7">=</span><span class="sc10">${1-2}</span><span class="sc0">
    </span><span class="sc8">counter</span><span class="sc7">=</span><span class="sc10">${2-10}</span><span class="sc0">

    </span><span class="sc8">net_io</span><span class="sc0"> </span><span class="sc9">$interval</span><span class="sc0"> </span><span class="sc9">$counter</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_net</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc2">#if [[ $(uname) = AIX ]]; then</span><span class="sc0">
    </span><span class="sc2">#   trcstop</span><span class="sc0">
    </span><span class="sc2">#   sleep 10</span><span class="sc0">
    </span><span class="sc2">#   echo "\n\n\n" &gt;&gt; tmp_net$$.txt</span><span class="sc0">
    </span><span class="sc2">#   cat netnmon.$$  &gt;&gt; tmp_net$$.txt</span><span class="sc0">
    </span><span class="sc2">#fi</span><span class="sc0">

    </span><span class="sc8">net_usage</span><span class="sc7">=</span><span class="sc11">$( grep Average tmp_net$$.txt | awk '{print $4}' )</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">net</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$net_usage</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$net"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc5">"$threshold_net_package"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0">  </span><span class="sc5">"$(hostname)_NETWORK_IO_BUSY_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_net</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_net</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#######################################################################</span><span class="sc0">
</span><span class="sc2"># Description:</span><span class="sc0">
</span><span class="sc2"># 1. start NMON data collection under directory $nmonDir, and</span><span class="sc0">
</span><span class="sc2"># 2. The interval for NMON $second (seconds), and</span><span class="sc0">
</span><span class="sc2"># 3. Run this script for $hour (hours)</span><span class="sc0">
</span><span class="sc2">#######################################################################</span><span class="sc0">
</span><span class="sc8">snmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">nmon_interval</span><span class="sc7">=</span><span class="sc10">${NMONINTERVAL:=60}</span><span class="sc0">       </span><span class="sc2">#default 1 minute</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">nmon_duration</span><span class="sc7">=</span><span class="sc10">${NMONDURATION:=24}</span><span class="sc0">       </span><span class="sc2">#default 24 hours</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">nmon_count</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc7">*</span><span class="sc3">60</span><span class="sc7">*</span><span class="sc8">nmon_duration</span><span class="sc7">/</span><span class="sc8">nmon_interval</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">

    </span><span class="sc2">#start NMON</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$NMONRUNDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$NMONRUNDIR</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$NMONRUNDIR</span><span class="sc0">
    
    </span><span class="sc8">nmon</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$nmon_interval</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc9">$nmon_count</span><span class="sc0">

    </span><span class="sc8">success</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$success</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname)_NMON_STARTED"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###############################################################################</span><span class="sc0">
</span><span class="sc2"># Description:  When so many NMON running, use it to find the right NMON data</span><span class="sc0">
</span><span class="sc2">#               files which is done, compress and send out by email.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># 1. To get last_hour NMON report data files, run this script at right 10 </span><span class="sc0">
</span><span class="sc2">#    minutes after NMON just completed, the NMON report must being updated in</span><span class="sc0">
</span><span class="sc2">#    at least last 15 minutes, and should be completed at least 5 minutes ago</span><span class="sc0">
</span><span class="sc2">#    </span><span class="sc0">
</span><span class="sc2">#    --------5-----------0-------------5-------------10---------</span><span class="sc0">
</span><span class="sc2">#                        |                           |</span><span class="sc0">
</span><span class="sc2">#          (period NMON supposed to be done)    (send_nmon)</span><span class="sc0">
</span><span class="sc2">#                        |                           |</span><span class="sc0">
</span><span class="sc2">#            15**********10************5             0</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># 2. To get yesterday NMON report data files, run this script any time next day</span><span class="sc0">
</span><span class="sc2">#    (notice: 10 minutes later after this NMON collection stopped)</span><span class="sc0">
</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc8">mnmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">date_yesterday</span><span class="sc7">=</span><span class="sc11">$(TZ=EDT+24EDT date +%y%m%d)</span><span class="sc0">
    
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">nmon_report_dir</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${NMONREPORTDIR:="/login/lchen/nmon"}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${nmon_report_dir}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(hostname) ${nmon_report_dir} NOT EXIST"</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">        
        </span><span class="sc7">}</span><span class="sc0">
        
        </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${nmon_report_dir}</span><span class="sc0">
        </span><span class="sc8">nmon_lasthour</span><span class="sc7">=</span><span class="sc11">$(find . \( -name "*.nmon" -o -name "*.nmon.gz" \) -a -mmin -15 -a -mmin +5)</span><span class="sc0">
        </span><span class="sc8">nmon_yesterday</span><span class="sc7">=</span><span class="sc11">$(find . \( -name "*_$date_yesterday*.nmon" -o -name "*_$date_yesterday*.nmon.gz" \) -a -mmin +5)</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$NMONREADY</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"last_hour"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">nmon_reports</span><span class="sc7">=</span><span class="sc9">$nmon_lasthour</span><span class="sc0">
        </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$NMONREADY</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"yesterday"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">nmon_reports</span><span class="sc7">=</span><span class="sc9">$nmon_yesterday</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
        
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$nmon_reports"</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NO_NMON_REPORT_UNDER ${nmon_report_dir}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

        </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">nmon_report</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$nmon_reports</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">nmon_file</span><span class="sc7">=</span><span class="sc11">$(basename $nmon_report)</span><span class="sc0">
            </span><span class="sc4">file</span><span class="sc0"> </span><span class="sc9">$nmon_file</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">gzip</span><span class="sc0">
            </span><span class="sc8">compressed</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$compressed</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0"> 
                </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_NMON_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc10">${nmon_report_dir}</span><span class="sc0"> </span><span class="sc9">$nmon_file</span><span class="sc0"> </span><span class="sc5">"${mail_notice}"</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc8">gzip</span><span class="sc0"> </span><span class="sc9">$nmon_file</span><span class="sc0">
                </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_NMON_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc10">${nmon_report_dir}</span><span class="sc0"> </span><span class="sc9">$nmon_file</span><span class="sc7">.</span><span class="sc8">gz</span><span class="sc0"> </span><span class="sc5">"${mail_notice}"</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">


</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2"># Program : ftp script from Unix/Linux to Windows FTP Server</span><span class="sc0">
</span><span class="sc2"># $1: remote host name</span><span class="sc0">
</span><span class="sc2"># $2: user name</span><span class="sc0">
</span><span class="sc2"># $3: password</span><span class="sc0">
</span><span class="sc2"># $4: file local directory</span><span class="sc0">
</span><span class="sc2"># $5: file remote directory</span><span class="sc0">
</span><span class="sc2"># $6: remote file name</span><span class="sc0">
</span><span class="sc2"># $7: local file name</span><span class="sc0">
</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc8">ftp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vn</span><span class="sc0"> </span><span class="sc12">&lt;&lt; END_OF_PUT</span><span class="sc13">
open $1
quote user $2
quote pass $3
bin
lcd $4
cd $5
put $6 $7
bye
END_OF_PUT</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">


</span><span class="sc8">AIX_sendnmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NMON Performance Data File"</span><span class="sc0"> </span><span class="sc9">$mailList</span><span class="sc0"> </span><span class="sc12">&lt;&lt;nmon</span><span class="sc13">
Performance data file attached.

Regards
Liru

~&lt;!uuencode $1/$2 $(basename $2)

nmon</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Linux_sendnmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Performance data file attached."</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
</span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NMON Performance Data File"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
</span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc7">/</span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc9">$mailList</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">sendnmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc2">##Find the NMON data files,</span><span class="sc0">
</span><span class="sc2">##1.Modified 60 minutes ago, but not modified in last 15 minutes , and</span><span class="sc0">
</span><span class="sc2">##2.compress and send out by email</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">num</span><span class="sc7">=</span><span class="sc10">${#nmonDirs[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">num</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${nmonDirs[i]}</span><span class="sc0">
            </span><span class="sc8">nmonFiles</span><span class="sc7">=</span><span class="sc11">$(find . \( -name '*.nmon' -o -name '*.nmon.gz' \) -a -mmin -60 -a -mmin +15)</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$nmonFiles"</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"No New NMON File collection completed in last hour under ${nmonDirs[i]}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                            </span><span class="sc9">$alertMailList</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
                    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
                    </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">

            </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">nmonFile</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$nmonFiles</span><span class="sc0">
            </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc4">file</span><span class="sc0"> </span><span class="sc9">$nmonFile</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">gzip</span><span class="sc0">
                    </span><span class="sc8">compressed</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
                    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$compressed</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                    </span><span class="sc4">then</span><span class="sc0">
                            </span><span class="sc11">$(uname)</span><span class="sc8">_sendnmon</span><span class="sc0"> </span><span class="sc10">${nmonDirs[i]}</span><span class="sc0"> </span><span class="sc9">$nmonFile</span><span class="sc0">
                    </span><span class="sc4">else</span><span class="sc0">
                            </span><span class="sc8">gzip</span><span class="sc0"> </span><span class="sc9">$nmonFile</span><span class="sc0">
                            </span><span class="sc11">$(uname)</span><span class="sc8">_sendnmon</span><span class="sc0"> </span><span class="sc10">${nmonDirs[i]}</span><span class="sc0"> </span><span class="sc9">$nmonFile</span><span class="sc7">.</span><span class="sc8">gz</span><span class="sc0">
                    </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">done</span><span class="sc0">

            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">knownetnmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">date_yesterday</span><span class="sc7">=</span><span class="sc11">$(TZ=EDT+24EDT date +%y%m%d)</span><span class="sc0">
    </span><span class="sc8">nmon_report_dir</span><span class="sc7">=/</span><span class="sc8">kewill</span><span class="sc7">/</span><span class="sc8">kc1prapal01</span><span class="sc7">/</span><span class="sc8">nmon</span><span class="sc7">/</span><span class="sc0">
    
    </span><span class="sc8">remotehost</span><span class="sc7">=</span><span class="sc6">'10.253.131.47'</span><span class="sc0">
    </span><span class="sc8">username</span><span class="sc7">=</span><span class="sc6">'lii01\\aixperf'</span><span class="sc0">
    </span><span class="sc8">password</span><span class="sc7">=</span><span class="sc6">'AixFTP1224'</span><span class="sc0">
    </span><span class="sc8">localdir</span><span class="sc7">=</span><span class="sc10">${nmon_report_dir}</span><span class="sc0">
    </span><span class="sc8">remotedir</span><span class="sc7">=</span><span class="sc11">$(hostname)</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${nmon_report_dir}</span><span class="sc0">

    </span><span class="sc8">nmon_reports</span><span class="sc7">=</span><span class="sc11">$(find . \( -name "*_$date_yesterday*.nmon" -o -name "*_$date_yesterday*.nmon.gz" \))</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"${nmon_reports}"</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NO_NMON_REPORT"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">nmon_report</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${nmon_reports}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc10">${remotehost}</span><span class="sc0"> </span><span class="sc10">${username}</span><span class="sc0"> </span><span class="sc10">${password}</span><span class="sc0"> </span><span class="sc10">${localdir}</span><span class="sc0"> </span><span class="sc10">${remotedir}</span><span class="sc0"> </span><span class="sc10">${nmon_report}</span><span class="sc0"> </span><span class="sc10">${nmon_report}</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NMON REPORT SEND"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#############################################################</span><span class="sc0">
</span><span class="sc2">#  UNIX environment Error Message Monitor</span><span class="sc0">
</span><span class="sc2">#############################################################</span><span class="sc0">
</span><span class="sc8">errors</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2">#error message collection</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    
    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"SunOS"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">dmesg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">error</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">dmesg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">error</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">errpt</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-s</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_ERROR_MESSAGE_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_errors.txt</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###############################################################</span><span class="sc0">
</span><span class="sc2">#Program name : clears.ksh     </span><span class="sc0">
</span><span class="sc2">#DESCRIPTION: Clean (or move) all LOGS, NMON, gzip files     </span><span class="sc0">
</span><span class="sc2">#               generated by LIRU CHEN's scripts               </span><span class="sc0">
</span><span class="sc2">###############################################################</span><span class="sc0">
</span><span class="sc2">#                                                              </span><span class="sc0">
</span><span class="sc2">###############################################################                                                          </span><span class="sc0">
</span><span class="sc2">#Created - 03-MAY-15              CLR Version                 </span><span class="sc0">
</span><span class="sc2">###############################################################</span><span class="sc0">
</span><span class="sc8">clears</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">clear_dirs</span><span class="sc7">=</span><span class="sc10">${CLEARDIR:="${LOG}@log,LOG@10"}</span><span class="sc0">
    </span><span class="sc8">clear_stage</span><span class="sc7">=</span><span class="sc10">${CLEARSTAGE:="${LOG}"}</span><span class="sc0">
    </span><span class="sc2">#clear_types=${CLEARTYPE:="log"}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${clear_stage}</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">clear_dir</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${clear_dirs}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">clear_location</span><span class="sc7">=</span><span class="sc11">$(echo "${clear_dir}@"|cut -f1 -d@)</span><span class="sc0">
        </span><span class="sc8">clear_types</span><span class="sc7">=</span><span class="sc11">$(echo "${clear_dir}@"|cut -f2 -d@|tr , " ")</span><span class="sc0">
        </span><span class="sc8">clear_day</span><span class="sc7">=</span><span class="sc11">$(echo "${clear_dir}@"|cut -f3 -d@)</span><span class="sc0">

        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${clear_location} NOT EXIST and/or Clear Day is 0"</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
        
        </span><span class="sc8">bkupname</span><span class="sc7">=</span><span class="sc11">$(echo ${clear_location}| sed "s/\//./g")</span><span class="sc0">

        </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">clear_type</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${clear_types}</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc10">${clear_stage}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${clear_type}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc8">ALL</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">exec</span><span class="sc0"> </span><span class="sc8">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc7">{}</span><span class="sc0"> </span><span class="sc8">\;</span><span class="sc0">
                </span><span class="sc4">else</span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*${clear_type}*"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">exec</span><span class="sc0"> </span><span class="sc8">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc7">{}</span><span class="sc0"> </span><span class="sc8">\;</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc2">#[[ ! -d ${clear_stage}/${clear_location} ]] &amp;&amp; mkdir -p ${clear_stage}/${clear_location}</span><span class="sc0">
                </span><span class="sc2">#Backup by filename</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${clear_type}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc8">ALL</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmplist</span><span class="sc0">
                
                    </span><span class="sc4">tar</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">cvf</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0"> </span><span class="sc8">tmplist</span><span class="sc0">
                    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">gzip</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0">
                
                    </span><span class="sc2">#then, delete </span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">exec</span><span class="sc0"> </span><span class="sc8">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc7">{}</span><span class="sc0"> </span><span class="sc8">\;</span><span class="sc0">
                </span><span class="sc4">else</span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*${clear_type}*"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmplist</span><span class="sc0">
                
                    </span><span class="sc4">tar</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">cvf</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0"> </span><span class="sc8">tmplist</span><span class="sc0">
                    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">gzip</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${bkupname}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0">
                
                    </span><span class="sc2">#then, delete </span><span class="sc0">
                    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${clear_location}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*${clear_type}*"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">mtime</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${clear_day}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">exec</span><span class="sc0"> </span><span class="sc8">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc7">{}</span><span class="sc0"> </span><span class="sc8">\;</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">          

            </span><span class="sc4">fi</span><span class="sc0">
            
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">mon_proc</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">

    </span><span class="sc2">#Set the execution environment status</span><span class="sc0">
    </span><span class="sc2">#. /home/rns/.profile</span><span class="sc0">
     
    </span><span class="sc2">#applications monitored</span><span class="sc0">
    </span><span class="sc2">#format example: process name, start script and stop script</span><span class="sc0">
    </span><span class="sc2">#ProcessStatUpdNB,/admsrv/local/apps/rns/startprocessStatUpdNBcron.sh,/admsrv/local/apps/rns/stopprocessStatUpdNB.sh</span><span class="sc0">

    </span><span class="sc8">proc_file</span><span class="sc7">=/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">lchen</span><span class="sc7">/</span><span class="sc8">MonitorProcess</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${proc_file}</span><span class="sc0">

    </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc10">${proc_file}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">uniq</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">process</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">proc_name</span><span class="sc7">=</span><span class="sc11">$(echo "${process},"|cut -f1 -d,)</span><span class="sc0">
        </span><span class="sc8">proc_start</span><span class="sc7">=</span><span class="sc11">$(echo "${process},"|cut -f2 -d,)</span><span class="sc0">
        </span><span class="sc8">proc_stop</span><span class="sc7">=</span><span class="sc11">$(echo "${process},"|cut -f3 -d,)</span><span class="sc0">

        </span><span class="sc8">proc_num</span><span class="sc7">=</span><span class="sc11">$(ps -ef | grep "${proc_name}" | grep -v grep | wc -l)</span><span class="sc0">
        </span><span class="sc8">proc_ids</span><span class="sc7">=(</span><span class="sc0"> </span><span class="sc11">$(ps -ef | grep "${proc_name}" | grep -v grep | awk '{print $2}')</span><span class="sc0"> </span><span class="sc7">)</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${proc_num}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Duplicated ${proc_name} detected, kill ${proc_name} immediatedly"</span><span class="sc0"> </span><span class="sc9">$Maillist</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            </span><span class="sc4">kill</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">9</span><span class="sc0"> </span><span class="sc10">${proc_ids[0]}</span><span class="sc0">
            </span><span class="sc4">kill</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">9</span><span class="sc0"> </span><span class="sc10">${proc_ids[1]}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
        
        </span><span class="sc8">proc_id</span><span class="sc7">=</span><span class="sc11">$(ps -ef | grep "${proc_name}" | grep -v grep | awk '{print $2}')</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-n</span><span class="sc0"> </span><span class="sc5">"${proc_id}"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${proc_name} Daemon is still Running ....\n"</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n ** ERROR: The ${proc_name} daemon is not Running ! **\n"</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"${proc_name} daemon is NOT Running ! "</span><span class="sc0"> </span><span class="sc9">$Maillist</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"== reStart ${proc_name} Daemon .... == \n"</span><span class="sc0">
            </span><span class="sc10">${proc_start}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">  

    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#####################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:         tape</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  The tape command gives subcommands to a streaming tape </span><span class="sc0">
</span><span class="sc2">#               device. </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Command:      tape &lt;tapedevice&gt; &lt;action&gt; &lt;count&gt;</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># &lt;tapedevice&gt; </span><span class="sc0">
</span><span class="sc2"># Device variable must specify a raw (not block) tape device. For example:</span><span class="sc0">
</span><span class="sc2">#   AIX: /dev/rmt0; /dev/rmt0.1(no rewind);...</span><span class="sc0">
</span><span class="sc2">#   SunOS: /dev/rmt/0; /dev/rmt/0n(no rewind);...</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># &lt;action&gt;</span><span class="sc0">
</span><span class="sc2"># 1. "eof" or "weof": Writes the number of end-of-file markers specified </span><span class="sc0">
</span><span class="sc2">#     by the Count parameter at the current position on the tape. </span><span class="sc0">
</span><span class="sc2">#     On an 8 mm tape drive, an end-of-file marker can be written in three places: </span><span class="sc0">
</span><span class="sc2">#      - Before blank tape </span><span class="sc0">
</span><span class="sc2">#      - Before an extended file mark </span><span class="sc0">
</span><span class="sc2">#      - At the beginning-of-tape mark</span><span class="sc0">
</span><span class="sc2">#     On a 9-track tape drive, the end-of-tape marker can be written at</span><span class="sc0">
</span><span class="sc2">#     any location on the tape. However, this subcommand does not support </span><span class="sc0">
</span><span class="sc2">#     overwriting single blocks of data.</span><span class="sc0">
</span><span class="sc2"># 2. "fsf": Moves the tape forward the number of file marks specified</span><span class="sc0">
</span><span class="sc2">#     by the Count parameter and positions it on the end-of-tape (EOT) </span><span class="sc0">
</span><span class="sc2">#     side of the file mark. </span><span class="sc0">
</span><span class="sc2"># 3. "bsf": Moves the tape backward the number of file marks specified by </span><span class="sc0">
</span><span class="sc2">#     the Count parameter and positions it on the beginning-of-tape (BOT) </span><span class="sc0">
</span><span class="sc2">#     side of the file mark. </span><span class="sc0">
</span><span class="sc2">#     If the bsf subcommand moves the tape past the beginning, the tape rewinds, </span><span class="sc0">
</span><span class="sc2">#     and the tctl command returns EIO. </span><span class="sc0">
</span><span class="sc2"># 4. "fsr": Moves the tape forward the number of records specified by the </span><span class="sc0">
</span><span class="sc2">#     Count parameter. </span><span class="sc0">
</span><span class="sc2"># 5. "bsr": Moves the tape backwards the number of records specified</span><span class="sc0">
</span><span class="sc2">#     by the Count parameter. </span><span class="sc0">
</span><span class="sc2"># 6. "rewind": Rewinds the tape. The Count parameter is ignored. </span><span class="sc0">
</span><span class="sc2"># 7. "offline" or "rewoffl": Rewinds the tape and takes the tape drive offline.</span><span class="sc0">
</span><span class="sc2">#    This will unload the tape when appropriate. The tape must be re-inserted</span><span class="sc0">
</span><span class="sc2">#    before the device can be used again. </span><span class="sc0">
</span><span class="sc2"># 8. "erase": Erases all contents on the tape and rewinds it. </span><span class="sc0">
</span><span class="sc2"># 9. "read": Reads from the specified tape device (using the specified block size)</span><span class="sc0">
</span><span class="sc2">#     until the internal buffer is full, and then writes the data to standard </span><span class="sc0">
</span><span class="sc2">#     output, continuing to read and write this way until an end-of-file (EOF) </span><span class="sc0">
</span><span class="sc2">#     mark is reached. </span><span class="sc0">
</span><span class="sc2"># 10. "reset": Sends a bus device reset (BDR) to the tape device. </span><span class="sc0">
</span><span class="sc2">#     The BDR will only be sent if the device cannot be opened and is not busy. </span><span class="sc0">
</span><span class="sc2"># 11. "retension": Moves the tape to the beginning, then to the end, </span><span class="sc0">
</span><span class="sc2">#     and then back to the beginning of the tape. </span><span class="sc0">
</span><span class="sc2">#    If you have excessive read errors during a restore operation, you should run</span><span class="sc0">
</span><span class="sc2">#    the retension subcommand. </span><span class="sc0">
</span><span class="sc2">#    If the tape has been exposed to environmental extremes, you should run the</span><span class="sc0">
</span><span class="sc2">#    retension subcommand before writing to tape. </span><span class="sc0">
</span><span class="sc2">#    The 8 mm tape drive will not respond to this command. </span><span class="sc0">
</span><span class="sc2"># 11. "status": Prints status information about the specified tape device. </span><span class="sc0">
</span><span class="sc2"># 12. "write": Opens the tape device, reads from standard input, and writes the</span><span class="sc0">
</span><span class="sc2">#     data to the tape device. </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># &lt;count&gt;</span><span class="sc0">
</span><span class="sc2"># There maybe mutiple files(or archives) on one single tape, use the Count</span><span class="sc0">
</span><span class="sc2"># parameter specifies the number of end-of-file markers, number of file marks, </span><span class="sc0">
</span><span class="sc2"># or number of records. </span><span class="sc0">
</span><span class="sc2"># If the Count parameter is not specified, the default count is 1.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Filemarks are used for logical separation and fast positioning within a media.</span><span class="sc0">
</span><span class="sc2">#####################################################################################</span><span class="sc0">
</span><span class="sc8">tape</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0"> </span><span class="sc2"># : (null command)</span><span class="sc0">

</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc2"># FIND configure IP address, change to new IP after system migration</span><span class="sc0">
</span><span class="sc2"># usage: findip &lt;directory&gt; </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># why not just simplely: grep &lt;thisword&gt; *</span><span class="sc0">
</span><span class="sc2"># All lines in all files that contain &lt;thisword&gt; are printed out</span><span class="sc0">
</span><span class="sc2">########################################################################</span><span class="sc0">
</span><span class="sc8">findip</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ipbit</span><span class="sc7">=</span><span class="sc6">'([0-9]|[1-9][0-9]|[1-2][0-9][0-9])'</span><span class="sc0">
    </span><span class="sc2">#ippattern="$ipbit\.$ipbit\.$ipbit\.$ipbit"</span><span class="sc0">
    </span><span class="sc8">ippattern</span><span class="sc7">=</span><span class="sc5">"192\.168\.$ipbit\.$ipbit"</span><span class="sc0">

    </span><span class="sc2">#Get a list of the name pattern matched files</span><span class="sc0">
    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ls</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $11}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">filename</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
      </span><span class="sc2">#Highlight the lines which contain valid ip address</span><span class="sc0">
      </span><span class="sc8">rc</span><span class="sc7">=</span><span class="sc11">$(file $filename|egrep "shell|commands|text")</span><span class="sc0">
      </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
      </span><span class="sc4">then</span><span class="sc0">
           </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"NO BINARY FILE FOUND"</span><span class="sc0">
           </span><span class="sc8">rc</span><span class="sc7">=</span><span class="sc11">$(egrep $ippattern $filename)</span><span class="sc0">
           </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
           </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"#"</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" FILE $filename WITH IP:192.168.X.X"</span><span class="sc0"> 
                </span><span class="sc2">#cat $filename</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
           </span><span class="sc4">fi</span><span class="sc0">
      </span><span class="sc4">fi</span><span class="sc0">    
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Calculate Date -- Perderabo's date calculator</span><span class="sc0">
</span><span class="sc8">lastday</span><span class="sc7">()</span><span class="sc0">  </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc8">leap</span><span class="sc0">
    </span><span class="sc2"># ja fe ma ap ma jn jl ag se oc no de</span><span class="sc0">
    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc8">-A</span><span class="sc0"> </span><span class="sc8">mlength</span><span class="sc0"> </span><span class="sc8">xx</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">28</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">30</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">30</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">30</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0"> </span><span class="sc3">30</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc0">

    </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">year</span><span class="sc7">&lt;</span><span class="sc3">1860</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc3">3999</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc8">out</span><span class="sc0"> </span><span class="sc8">of</span><span class="sc0"> </span><span class="sc8">range</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">month</span><span class="sc7">&lt;</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc3">12</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc8">out</span><span class="sc0"> </span><span class="sc8">of</span><span class="sc0"> </span><span class="sc8">range</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc10">${mlength[month]}</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">leap</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((!(</span><span class="sc8">year</span><span class="sc7">%</span><span class="sc3">100</span><span class="sc7">)))</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc7">((!(</span><span class="sc8">year</span><span class="sc7">%</span><span class="sc3">400</span><span class="sc7">)))</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">leap</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc7">((!(</span><span class="sc8">year</span><span class="sc7">%</span><span class="sc3">4</span><span class="sc7">)))</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">leap</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">feblength</span><span class="sc7">=</span><span class="sc3">28</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">leap</span><span class="sc7">))</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">feblength</span><span class="sc7">=</span><span class="sc3">29</span><span class="sc0">
    </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc9">$feblength</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">date2jd</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">ijd</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc8">mnjd</span><span class="sc0"> </span><span class="sc8">jd</span><span class="sc0"> </span><span class="sc8">lday</span><span class="sc0">

    </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    </span><span class="sc8">day</span><span class="sc7">=</span><span class="sc9">$3</span><span class="sc0">
    </span><span class="sc8">lday</span><span class="sc7">=</span><span class="sc11">$(lastday $year $month)</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">day</span><span class="sc7">&lt;</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">lday</span><span class="sc7">))</span><span class="sc0"> </span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0"> </span><span class="sc8">out</span><span class="sc0"> </span><span class="sc8">of</span><span class="sc0"> </span><span class="sc8">range</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc7">((</span><span class="sc8">standard_jd</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">32075</span><span class="sc0"> 
       </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">1461</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc8">year</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">4800</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc3">14</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc7">)/</span><span class="sc3">12</span><span class="sc7">)/</span><span class="sc3">4</span><span class="sc0"> 
       </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">367</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc3">14</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc7">)/</span><span class="sc3">12</span><span class="sc7">*</span><span class="sc3">12</span><span class="sc7">)/</span><span class="sc3">12</span><span class="sc0"> 
       </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">year</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">4900</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc3">14</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc7">)/</span><span class="sc3">12</span><span class="sc7">)/</span><span class="sc3">100</span><span class="sc7">)/</span><span class="sc3">4</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">jd</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">standard_jd-2400001</span><span class="sc7">))</span><span class="sc0">


    </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc9">$jd</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">jd2dow</span><span class="sc7">()</span><span class="sc0">
</span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">jd</span><span class="sc0"> </span><span class="sc8">dow</span><span class="sc0"> </span><span class="sc8">numeric_mode</span><span class="sc0">
    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc8">A</span><span class="sc0"> </span><span class="sc8">days</span><span class="sc0"> </span><span class="sc8">Sunday</span><span class="sc0"> </span><span class="sc8">Monday</span><span class="sc0"> </span><span class="sc8">Tuesday</span><span class="sc0"> </span><span class="sc8">Wednesday</span><span class="sc0"> </span><span class="sc8">Thursday</span><span class="sc0"> </span><span class="sc8">Friday</span><span class="sc0"> </span><span class="sc8">Saturday</span><span class="sc0">

    </span><span class="sc8">numeric_mode</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc4">-n</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">numeric_mode</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">shift</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">


    </span><span class="sc8">jd</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">jd</span><span class="sc7">&lt;</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc8">jd</span><span class="sc7">&gt;</span><span class="sc3">782028</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc8">julian</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0"> </span><span class="sc8">out</span><span class="sc0"> </span><span class="sc8">of</span><span class="sc0"> </span><span class="sc8">range</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc7">((</span><span class="sc8">dow</span><span class="sc7">=(</span><span class="sc8">jd+3</span><span class="sc7">)%</span><span class="sc3">7</span><span class="sc7">))</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">numeric_mode</span><span class="sc7">))</span><span class="sc0"> </span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc9">$dow</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc10">${days[dow]}</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">jd2date</span><span class="sc7">()</span><span class="sc0">
</span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">standard_jd</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc8">temp2</span><span class="sc0"> </span><span class="sc8">jd</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0">

    </span><span class="sc8">jd</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc8">jd</span><span class="sc7">&lt;</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc8">jd</span><span class="sc7">&gt;</span><span class="sc3">782028</span><span class="sc7">))</span><span class="sc0"> </span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc8">julian</span><span class="sc0"> </span><span class="sc8">day</span><span class="sc0"> </span><span class="sc8">out</span><span class="sc0"> </span><span class="sc8">of</span><span class="sc0"> </span><span class="sc8">range</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">standard_jd</span><span class="sc7">=</span><span class="sc8">jd+2400001</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">standard_jd</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">68569</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">temp2</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc7">*</span><span class="sc8">temp1</span><span class="sc7">/</span><span class="sc3">146097</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc3">146097</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc8">temp2</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">year</span><span class="sc0">  </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">4000</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0"> </span><span class="sc3">1461001</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">1461</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc7">/</span><span class="sc3">4</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">31</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">80</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0"> </span><span class="sc3">2447</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">day</span><span class="sc0">   </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2447</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0"> </span><span class="sc3">80</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">temp1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0"> </span><span class="sc3">11</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">12</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">year</span><span class="sc0">  </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc3">100</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc8">temp2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">49</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc8">temp1</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc9">$day</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#  datecalc -- Perderabo's date calculator   </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc8">datecalc</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">USAGE</span><span class="sc7">=</span><span class="sc5">"\
    datecalc -a year month day - year month day
    datecalc -a year month day [-|+] n
    datecalc -d year month day
    datecalc -D year month day
    datecalc -j year month day
    datecalc -j n
    datecalc -l year month
    use \"datecalc -help\" use for more documentation"</span><span class="sc0">

    </span><span class="sc8">DOCUMENTATION</span><span class="sc7">=</span><span class="sc5">"\
    datecalc  Version 1.1

    datecalc does many manipulations with dates.
    datecalc -a is for date arithmetic
    datecalc -d or -D converts a date to the day of week
    datecalc -j converts to date to or from julian day
    datecalc -l outputs the last day of a month

    All dates must be between the years 1860 and 3999.

    datecalc -a followed by 7 parameters will calculate the
    number of days between two dates.  Parameters 2-4 and 6-8
    must be dates in ymd form, and parameter 5 must be a minus
    sign.  The output is an integer.  Example:

    &gt; datecalc -a 1960 12 31 - 1922 2 2
    14212


    datecalc -a followed by 5 parameters will calculate the
    a new date offset from a given date,  Parameters 2-4 must
    be a date in ymd form, paramter 5 must be + or -, and 
    paramter 6 must be an integer.  Output is a new date.
    Example:

    &gt; datecalc -a 1960 12 31 + 7
    1961 1 7


    datecalc -d followed by 3 parameters will convert a date
    to a day-of-week.  Parameters 2-4 must be a date in ymd 
    form.  Example:

    &gt; datecalc -d 1960 12 31
    6


    datecalc -D is like -d except it displays the name of
    the day.  Example:

    &gt; datecalc -D 1960 12 31
    Saturday


    datecalc -j followed by 3 parameters will convert a date
    to Modified Julian Day number.  Example:
    &gt; datecalc -j 1960 12 31
    37299


    datecalc -j followed by a single parameter will convert
    a Modified Julian Day number to a date.  Example:
    &gt; datecalc -j 37299
    1960 12 31


    datecalc -l followed by year and month will output the last
    day of that month.  Note that by checking the last day of
    February you can test for leap year.  Example:
    &gt; datecalc -l 2002 2
    28"</span><span class="sc0">

    </span><span class="sc2">#  Parse parameters and get to work.</span><span class="sc0">
    </span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0">
    </span><span class="sc8">-a</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">8</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$5</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc8">jd1</span><span class="sc7">=</span><span class="sc11">$(date2jd $2 $3 $4)</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc8">jd2</span><span class="sc7">=</span><span class="sc11">$(date2jd $6 $7 $8)</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc7">((</span><span class="sc8">jd3</span><span class="sc7">=</span><span class="sc8">jd1-jd2</span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc9">$jd3</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">200</span><span class="sc0">
        </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">6</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">jd1</span><span class="sc7">=</span><span class="sc11">$(date2jd $2 $3 $4)</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$5</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> 
            </span><span class="sc7">-|+)</span><span class="sc0"> </span><span class="sc4">eval</span><span class="sc0"> </span><span class="sc6">'(('</span><span class="sc8">jd2</span><span class="sc7">=</span><span class="sc10">${jd1}${5}${6}</span><span class="sc6">'))'</span><span class="sc0">
                </span><span class="sc8">jd2date</span><span class="sc0"> </span><span class="sc9">$jd2</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc7">;;</span><span class="sc0">
            </span><span class="sc7">*)</span><span class="sc0">
                </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
            </span><span class="sc7">;;</span><span class="sc0">
            </span><span class="sc4">esac</span><span class="sc0">
                        
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">

    </span><span class="sc8">-d</span><span class="sc7">|-</span><span class="sc8">D</span><span class="sc7">)</span><span class="sc0">  </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc8">jd1</span><span class="sc7">=</span><span class="sc11">$(date2jd $2 $3 $4)</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc8">numeric</span><span class="sc7">=-</span><span class="sc8">n</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">D</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">numeric</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
            </span><span class="sc4">eval</span><span class="sc0"> </span><span class="sc8">jd2dow</span><span class="sc0"> </span><span class="sc9">$numeric</span><span class="sc0"> </span><span class="sc9">$jd1</span><span class="sc0"> 
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">

    </span><span class="sc7">-</span><span class="sc8">j</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">date2jd</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc9">$3</span><span class="sc0"> </span><span class="sc9">$4</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">jd2date</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc9">$3</span><span class="sc0"> </span><span class="sc9">$4</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">

    </span><span class="sc8">-l</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">lastday</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc9">$3</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">

    </span><span class="sc7">-</span><span class="sc8">help</span><span class="sc7">)</span><span class="sc0">  </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0">  </span><span class="sc5">""</span><span class="sc0">
            </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$DOCUMENTATION"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">

    </span><span class="sc7">*)</span><span class="sc0">      </span><span class="sc4">print</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">u2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc5">"$USAGE"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">


    </span><span class="sc4">esac</span><span class="sc0">

    </span><span class="sc2">#not reached</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#LoadLeveler is a job management system that allows users to run more jobs in less</span><span class="sc0">
</span><span class="sc2">#time by matching the jobs' processing needs with the available resources.</span><span class="sc0">
</span><span class="sc2">#LoadLeveler schedules jobs, and provides functions for building, submitting, and</span><span class="sc0">
</span><span class="sc2">#processing jobs quickly and efficiently in a dynamic environment.</span><span class="sc0">

</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2">#  Program name . . . . . . . . . . . . . . :   $AS400LIB/SUBMITJOB     #</span><span class="sc0">
</span><span class="sc2">#  Created by   ............................:   Sagar Goparaju          #</span><span class="sc0">
</span><span class="sc2">#  Date Created ............................:   08-MAR-2006             #</span><span class="sc0">
</span><span class="sc2">#  Text . . . :This script is simplified Submit Job function            #</span><span class="sc0">
</span><span class="sc2">#########################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  13-SEP-07 - GOP/      Exclude development variables on COPY_ALL</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">llusage</span><span class="sc7">()</span><span class="sc0">
</span><span class="sc7">{</span><span class="sc0">
  </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc12">&lt;&lt;!</span><span class="sc13">
  Usage:   SUBMITJOB [ -p PGM ] [ -j JobName ] [ -c Class ] [ -g Group ]
           [ -e ErrorLog ] [ -o OutputLog ] [ -t SubmitTime ]
!</span><span class="sc0">
  </span><span class="sc4">return</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">llsubmitjob</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc8">DATE</span><span class="sc7">=</span><span class="sc11">`date +%m%d%Y_%H%M%S`</span><span class="sc0">

</span><span class="sc2"># Check arguments</span><span class="sc0">
</span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc5">"$#"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
</span><span class="sc4">then</span><span class="sc0">
  </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc12">&lt;&lt;!</span><span class="sc13">
  Usage:   SUBMITJOB [ -p PGM ] [ -j JobName ] [ -c Class ] [ -g Group ]
           [ -e ErrorLog ] [ -o OutputLog ] [ -t SubmitTime ]
!</span><span class="sc0">
  </span><span class="sc4">return</span><span class="sc0">
</span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc2"># while getopts p:j:c:g:e:o:t: OPT</span><span class="sc0">
</span><span class="sc2"># do</span><span class="sc0">
     </span><span class="sc2"># case $OPT in</span><span class="sc0">
         </span><span class="sc2"># "p" ) PROG_ID=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "j" ) JOB_ID=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "c" ) CLASS_ID=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "g" ) GROUP_ID=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "e" ) ERROR_LOG=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "o" ) OUTPUT_LOG=$OPTARG ;;</span><span class="sc0">
         </span><span class="sc2"># "t" ) SUBMIT_TIME=$OPTARG ;;</span><span class="sc0">
          </span><span class="sc2"># *  ) llusage ;;</span><span class="sc0">
     </span><span class="sc2"># esac</span><span class="sc0">
</span><span class="sc2"># done</span><span class="sc0">

    </span><span class="sc8">PROG_ID</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">JOB_ID</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    </span><span class="sc8">ERROR_LOG</span><span class="sc7">=</span><span class="sc9">$3</span><span class="sc0">
    </span><span class="sc8">OUTPUT_LOG</span><span class="sc7">=</span><span class="sc9">$4</span><span class="sc0">
    </span><span class="sc8">CLASS_ID</span><span class="sc7">=</span><span class="sc9">$5</span><span class="sc0">
    </span><span class="sc8">GROUP_ID</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">SUBMIT_TIME</span><span class="sc7">=</span><span class="sc9">$6</span><span class="sc0">
                    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$PROG_ID"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"   Program Id is a required parameter\n"</span><span class="sc0">
        </span><span class="sc8">llusage</span><span class="sc7">;</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$JOB_ID"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">JOB_ID</span><span class="sc7">=</span><span class="sc11">`basename $PROG_ID`</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$CLASS_ID"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
       </span><span class="sc8">CLASS_ID</span><span class="sc7">=</span><span class="sc6">'uploads'</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$GROUP_ID"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
       </span><span class="sc8">GROUP_ID</span><span class="sc7">=</span><span class="sc6">'tpcdnq'</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$ERROR_LOG"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
       </span><span class="sc8">ERROR_LOG</span><span class="sc7">=</span><span class="sc11">`basename $PROG_ID`</span><span class="sc8">_</span><span class="sc9">$DATE</span><span class="sc7">.</span><span class="sc8">ERR</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-z</span><span class="sc0"> </span><span class="sc5">"$OUTPUT_LOG"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
       </span><span class="sc8">OUTPUT_LOG</span><span class="sc7">=</span><span class="sc11">`basename $PROG_ID`</span><span class="sc8">_</span><span class="sc9">$DATE</span><span class="sc7">.</span><span class="sc8">LOG</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    
    
</span><span class="sc8">llsubmit</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EXIT</span><span class="sc13">
# @job_name = $JOB_ID
# @environment = COPY_ALL ; !QZ ; !QD ; !QT ; !SF ; !QDS ; !INPT ; !LLQ ;
# @notification = NEVER
# @class = $CLASS_ID
# @group = $GROUP_ID
# @error = $ERROR_LOG
# @output = $OUTPUT_LOG
# @startdate = $SUBMIT_TIME
# @queue
$PROG_ID
EXIT</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">llcanceljob</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ll_jobs</span><span class="sc7">=</span><span class="sc10">${1-$LLJOB}</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">ll_job</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${ll_jobs}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">job_name</span><span class="sc7">=</span><span class="sc11">$(echo "${ll_job}," | cut -f1 -d, )</span><span class="sc0">
        </span><span class="sc8">stepID</span><span class="sc7">=</span><span class="sc11">$(llq -f %id %jn | grep $job_name | awk '{print $1}')</span><span class="sc0">
        </span><span class="sc8">llcancel</span><span class="sc0"> </span><span class="sc9">$stepID</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">llschedulejob</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ll_today</span><span class="sc7">=</span><span class="sc11">$(date +%m/%d/20%y)</span><span class="sc0">

    </span><span class="sc2">#Calculate ll_tomorrow=$(TZ=EDT-24EDT date +%m/%d/20%y)</span><span class="sc0">
    </span><span class="sc8">ll_date_tmp</span><span class="sc7">=</span><span class="sc11">$(date +20%y' '%m' '%d)</span><span class="sc0">
    </span><span class="sc8">ll_calc</span><span class="sc7">=</span><span class="sc11">$(datecalc -a ${ll_date_tmp} + 1)</span><span class="sc0">
    </span><span class="sc8">ll_year</span><span class="sc7">=</span><span class="sc11">$(echo $ll_calc|cut -f1 -d' ')</span><span class="sc0">
    </span><span class="sc8">ll_month</span><span class="sc7">=</span><span class="sc11">$(echo $ll_calc|cut -f2 -d' ')</span><span class="sc0">
    </span><span class="sc8">ll_day</span><span class="sc7">=</span><span class="sc11">$(echo $ll_calc|cut -f3 -d' ')</span><span class="sc0">
    </span><span class="sc8">ll_tomorrow</span><span class="sc7">=</span><span class="sc10">${ll_month}</span><span class="sc7">/</span><span class="sc10">${ll_day}</span><span class="sc7">/</span><span class="sc10">${ll_year}</span><span class="sc0">

    </span><span class="sc8">ll_jobs</span><span class="sc7">=</span><span class="sc10">${LLJOB:="${ll_start_job}"}</span><span class="sc0">
    </span><span class="sc8">ll_date</span><span class="sc7">=</span><span class="sc11">$(date +%m%d%Y%H%M%S)</span><span class="sc0">
    
    </span><span class="sc2">#directory of scripts run under loadleveler </span><span class="sc0">
    </span><span class="sc8">ll_dir</span><span class="sc7">=</span><span class="sc10">${LLDIR:=/alliance/RUNTIME/LIVOPER}</span><span class="sc0">
    </span><span class="sc8">ll_log</span><span class="sc7">=</span><span class="sc10">${LLOGDIR:=/alliance/RUNTIME/LIVOPER/usislogs}</span><span class="sc0">
    </span><span class="sc8">ll_class</span><span class="sc7">=</span><span class="sc10">${LLCLASS:="locusq"}</span><span class="sc0">
    
    </span><span class="sc2">#Schedule jobs today</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">ll_job</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${ll_jobs}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">ll_name</span><span class="sc7">=</span><span class="sc11">$(echo "${ll_job}," | cut -f1 -d, )</span><span class="sc0">
        
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">2</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">job_schedule</span><span class="sc7">=</span><span class="sc11">$(echo ${ll_job} | cut -f$i -d, )</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${job_schedule}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">break</span><span class="sc0">
            
            </span><span class="sc2">#job schedlue time before now, loadleveler will run it immediately</span><span class="sc0">
            </span><span class="sc8">job_time</span><span class="sc7">=</span><span class="sc11">$(echo ${job_schedule} | cut -f1 -d"@")</span><span class="sc0">
            </span><span class="sc8">job_day</span><span class="sc7">=</span><span class="sc11">$(echo ${job_schedule} | cut -f2 -d"@")</span><span class="sc0">
            
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${job_day}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc11">$(date +%w)</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc2"># llsubmitjob \
                    # -p"${ll_dir}/${ll_name}.ksh" \
                    # -j${ll_name}_jobs \
                    # -e${ll_log}/${ll_name}_error_${ll_date}.LOG \
                    # -o${ll_log}/${ll_name}_output_${ll_date}.LOG \
                    # -c${ll_class} \
                    # -t"${ll_today} ${job_time}"</span><span class="sc0">
                </span><span class="sc8">llsubmitjob</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_dir}/${ll_name}.ksh"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_name}_jobs "</span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_log}/${ll_name}_error_${ll_date}.LOG"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_log}/${ll_name}_output_${ll_date}.LOG"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_class}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_today} ${job_time}"</span><span class="sc0">
            
            </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${job_day}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"tomorrow"</span><span class="sc0"> </span><span class="sc7">||</span><span class="sc0"> </span><span class="sc10">${job_day}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"nextday"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">    
                </span><span class="sc2">#Initial job scheduler tomorrow</span><span class="sc0">
                </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) loadlevel ${ll_name} start"</span><span class="sc0"> </span><span class="sc10">${mail_alert}</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">  

                </span><span class="sc8">llsubmitjob</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_dir}/${ll_name}.ksh"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_name}_jobs "</span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_log}/${ll_name}_error_${ll_date}.LOG"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_log}/${ll_name}_output_${ll_date}.LOG"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_class}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${ll_tomorrow} ${job_time}"</span><span class="sc0">
            
            </span><span class="sc4">fi</span><span class="sc0">
            
        </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

            
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Schedule at minte 05 hourly on crontab</span><span class="sc0">
</span><span class="sc8">llmon</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">ll_stop_job</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${LLJOBSTOP}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">stepID_stopjobs</span><span class="sc7">=</span><span class="sc11">$(llq -f %id %jn | grep ${ll_stop_job} | awk '{print $1}')</span><span class="sc0">
        </span><span class="sc2">#IF SCHEDULJOB running, stop SCHEDULJOB</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${stepID_stopjobs}</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOADLEVEL ${ll_stop_job} RUNNING, STOP IT"</span><span class="sc0"> </span><span class="sc10">${mail_alert}</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
                
            </span><span class="sc2">#CANCEL ALL the loadleveler jobs scheduled by ${ll_stop_job}</span><span class="sc0">
            </span><span class="sc2">#/alliance/RUNTIME/LIVOPER/CANCELJOB.ksh</span><span class="sc0">
            </span><span class="sc8">ksh93</span><span class="sc0"> </span><span class="sc9">$BASE</span><span class="sc7">/</span><span class="sc8">shlib</span><span class="sc0"> </span><span class="sc8">llcanceljob</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">ll_start_job</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${LLJOBSTART}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">stepID_startjobs</span><span class="sc7">=</span><span class="sc11">$(llq -f %id %jn | grep ${ll_start_job} | awk '{print $1}')</span><span class="sc0">    
        </span><span class="sc2">#IF ${ll_start_job} NOT running, start ${ll_start_job}</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${stepID_startjobs}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) loadlevel ${ll_start_job} START"</span><span class="sc0"> </span><span class="sc10">${mail_alert}</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
                
            </span><span class="sc2">#Run today's jobs in case jobs maybe missed, and schedule ${ll_start_job} tomorrow</span><span class="sc0">
            </span><span class="sc8">ksh93</span><span class="sc0"> </span><span class="sc9">$BASE</span><span class="sc7">/</span><span class="sc8">shlib</span><span class="sc0"> </span><span class="sc8">llschedulejob</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
        
        </span><span class="sc2">#mail -s "loadlevel ${ll_start_job} running" ${mail_alert} &lt; /dev/null</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################</span><span class="sc0">
</span><span class="sc2"># KEC TOMCAT RECYCLE</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Author: Byron, Terry, Liru</span><span class="sc0">
</span><span class="sc2"># 2015-12-30</span><span class="sc0">
</span><span class="sc2">###########################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># STOP/start FG Tomcat:</span><span class="sc0">
</span><span class="sc2"># 1.    login as user alliance</span><span class="sc0">
</span><span class="sc2"># 2.    ps –ef | grep –i tom</span><span class="sc0">
</span><span class="sc2"># 3.    /kcustoms/tomcatfg/bin/shutdown.sh</span><span class="sc0">
</span><span class="sc2"># 4.    ps –ef | grep –i tom</span><span class="sc0">
</span><span class="sc2"># 5.    /kcustoms/tomcatfg/bin/startup.sh</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># START/stop FG BG Tomcat:</span><span class="sc0">
</span><span class="sc2"># 1.    login as user alliance</span><span class="sc0">
</span><span class="sc2"># 2.    ps –ef | grep –i tom</span><span class="sc0">
</span><span class="sc2"># 3.    /kcustoms/tomcatbg/bin/shutdown.sh</span><span class="sc0">
</span><span class="sc2"># 4.    ps –ef | grep –i tom</span><span class="sc0">
</span><span class="sc2"># 5.    /kcustoms/tomcatbg/bin/startup.sh</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Same for all environments.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Kill -9 “process id” if the process won’t shutdown</span><span class="sc0">
</span><span class="sc2">#########################################################</span><span class="sc0">
</span><span class="sc8">stoptomcat</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">tomcatfg</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">kcustoms</span><span class="sc7">/</span><span class="sc8">tomcatfg</span><span class="sc7">/</span><span class="sc8">bin</span><span class="sc7">/</span><span class="sc8">shutdown.sh</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc0"> </span><span class="sc2"># waiting 60 seconds</span><span class="sc0">
        
    </span><span class="sc2"># ps -ef|grep -v grep|grep tomcatbg</span><span class="sc0">
    </span><span class="sc2"># [[ $? -eq 0 ]] &amp;&amp; {</span><span class="sc0">
        </span><span class="sc2"># /kcustoms/tomcatbg/bin/shutdown.sh</span><span class="sc0">
    </span><span class="sc2"># }</span><span class="sc0">
    
    </span><span class="sc2"># sleep 60 # waiting 60 seconds</span><span class="sc0">
    
    </span><span class="sc8">tomcatfg_id</span><span class="sc7">=</span><span class="sc11">$(ps -ef|grep -v grep|grep tomcatfg|awk '{print $2}')</span><span class="sc0">
    </span><span class="sc2"># tomcatbg_id=$(ps -ef|grep -v grep|grep tomcatbg|awk '{print $2}')</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#tomcatfg_id}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Foreground tomcat shutdown failed, will kill the process"</span><span class="sc0"> </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">kill</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc3">9</span><span class="sc0"> </span><span class="sc10">${tomcatfg_id}</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc2"># [[ ${#tomcatbg_id} -ne 0 ]] &amp;&amp; {</span><span class="sc0">
        </span><span class="sc2"># mail -s "Background tomcat shutdown failed, will kill the process" aixsupport@livingstonintl.com &lt; /dev/null</span><span class="sc0">
        </span><span class="sc2"># kill -9 ${tomcatbg_id}</span><span class="sc0">
    </span><span class="sc2"># }</span><span class="sc0">

    
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">tomcatfg</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Foreground Tomcat Shutdown successfully"</span><span class="sc0"> </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Foreground Tomcat Shutdown failed"</span><span class="sc0"> </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
        
    </span><span class="sc2"># ps -ef|grep -v grep|grep tomcatbg</span><span class="sc0">
    </span><span class="sc2"># if [[ $? -ne 0 ]]</span><span class="sc0">
    </span><span class="sc2"># then</span><span class="sc0">
        </span><span class="sc2"># mail -s "Background Tomcat Shutdown successfully" aixsupport@livingstonintl.com &lt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># else</span><span class="sc0">
        </span><span class="sc2"># mail -s "Background Tomcat Shutdown failed" aixsupport@livingstonintl.com &lt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># fi</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">starttomcat</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2"># ps -ef|grep -v grep|grep tomcatbg</span><span class="sc0">
    </span><span class="sc2"># [[ $? -ne 0 ]] &amp;&amp; {</span><span class="sc0">
        </span><span class="sc2"># /kcustoms/tomcatbg/bin/startup.sh</span><span class="sc0">
    </span><span class="sc2"># }</span><span class="sc0">

    </span><span class="sc2"># sleep 60 # waiting 60 seconds</span><span class="sc0">
    
    </span><span class="sc2"># ps -ef|grep -v grep|grep tomcatbg</span><span class="sc0">
    </span><span class="sc2"># if [[ $? -eq 0 ]]</span><span class="sc0">
    </span><span class="sc2"># then</span><span class="sc0">
        </span><span class="sc2"># mail -s "Background Tomcat Startup successfully" aixsupport@livingstonintl.com &lt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># else</span><span class="sc0">
        </span><span class="sc2"># mail -s "Background Tomcat Startup failed" aixsupport@livingstonintl.com &lt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># fi</span><span class="sc0">
    
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">tomcatfg</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">kcustoms</span><span class="sc7">/</span><span class="sc8">tomcatfg</span><span class="sc7">/</span><span class="sc8">bin</span><span class="sc7">/</span><span class="sc8">startup.sh</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc0"> </span><span class="sc2"># waiting 60 seconds</span><span class="sc0">
    
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">tomcatfg</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Foreground Tomcat Startup successfully"</span><span class="sc0"> </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Foreground Tomcat Startup failed"</span><span class="sc0"> </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tomcat_alert</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">

    </span><span class="sc8">today</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">

    </span><span class="sc4">touch</span><span class="sc0"> </span><span class="sc8">tomcat_alert.log</span><span class="sc0"> 
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">fg.tmp</span><span class="sc0"> 
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">bg.tmp</span><span class="sc0"> 

    </span><span class="sc2">#find OutOfMemoryError in /kcustoms/tomcatbg/logs/catalina.out</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"OutOfMemoryError"</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">kcustoms</span><span class="sc7">/</span><span class="sc8">tomcatbg</span><span class="sc7">/</span><span class="sc8">logs</span><span class="sc7">/</span><span class="sc8">catalina.out</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">background.catalina</span><span class="sc0">
    </span><span class="sc8">line_background</span><span class="sc7">=</span><span class="sc11">$(cat background.catalina|wc -l)</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${line_background}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">  </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"OutOfMemoryError warning number in background tomcat:"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">bg.tmp</span><span class="sc0">
        </span><span class="sc4">wc</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">background.catalina</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">bg.tmp</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">


    </span><span class="sc2">#find OutOfMemoryError in /kcustoms/tomcatfg/logs/catalina.out</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"OutOfMemoryError"</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">kcustoms</span><span class="sc7">/</span><span class="sc8">tomcatfg</span><span class="sc7">/</span><span class="sc8">logs</span><span class="sc7">/</span><span class="sc8">catalina.out</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">foreground.catalina</span><span class="sc0">
    </span><span class="sc8">line_foreground</span><span class="sc7">=</span><span class="sc11">$(cat foreground.catalina|wc -l)</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${line_foreground}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">  </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"OutOfMemoryError warning number in foreground tomcat:"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">fg.tmp</span><span class="sc0">
        </span><span class="sc4">wc</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">foreground.catalina</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">fg.tmp</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc8">bg.tmp</span><span class="sc0"> </span><span class="sc8">fg.tmp</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tomcat_alert.tmp</span><span class="sc0">
    </span><span class="sc8">line_alert</span><span class="sc7">=</span><span class="sc11">$(cat tomcat_alert.tmp|wc -l)</span><span class="sc0">

    </span><span class="sc4">diff</span><span class="sc0"> </span><span class="sc8">tomcat_alert.log</span><span class="sc0"> </span><span class="sc8">tomcat_alert.tmp</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$line_alert</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$today KEC tomcat OutOfMemoryError: GC overhead limit exceeded"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">aixsupport</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">tomcat_alert.tmp</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">tomcat_alert.tmp</span><span class="sc0"> </span><span class="sc8">tomcat_alert.log</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2"># Name:         str_replace</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  This script is used to change String $origin to String $target</span><span class="sc0">
</span><span class="sc2">#               in all the files under directory $DIR</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Command:   str_replace &lt;dir_name or file_name&gt; &lt;origin_string&gt; &lt;target_string&gt; </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Approach:  change "lchen/download" to "lchen/Tools/DB/informix/download</span><span class="sc0">
</span><span class="sc2">#             in all files under directory "137970"</span><span class="sc0">
</span><span class="sc2">#  $ cd 137970</span><span class="sc0">
</span><span class="sc2">#  $ for i in `ls *`</span><span class="sc0">
</span><span class="sc2">#    do sed "s/lchen\/download/lchen\/Tools\/DB\/informix\/download/g" $i &gt; tempFile</span><span class="sc0">
</span><span class="sc2">#    mv tempFile $i</span><span class="sc0">
</span><span class="sc2">#    done</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Date            Name            Description   </span><span class="sc0">
</span><span class="sc2">#   ------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   2013-03-15      Liru Chen       </span><span class="sc0">
</span><span class="sc2">#   2013-09-20      Liru Chen       MOdified for CGI migration project</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">####################################################################################</span><span class="sc0">
</span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Parameters Not equal to three!"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
        
    </span><span class="sc8">dir_file</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">origin</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    </span><span class="sc8">target</span><span class="sc7">=</span><span class="sc9">$3</span><span class="sc0">

    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$dir_file</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ls</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $11}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">filename</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">file</span><span class="sc0"> </span><span class="sc9">$filename</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"shell|commands|text"</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc9">$origin</span><span class="sc0"> </span><span class="sc9">$filename</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$filename</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
                </span><span class="sc8">slashorigin</span><span class="sc7">=</span><span class="sc11">$(echo $origin | sed "s/\//\\\\\//g")</span><span class="sc0">
                </span><span class="sc8">slashtarget</span><span class="sc7">=</span><span class="sc11">$(echo $target | sed "s/\//\\\\\//g")</span><span class="sc0">
                </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc5">"s/$slashorigin/$slashtarget/g"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc11">$(basename $filename)</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$filename</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">   
     </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#################################################################################</span><span class="sc0">
</span><span class="sc2"># AIX MANITENAMCE</span><span class="sc0">
</span><span class="sc2">#################################################################################</span><span class="sc0">


</span><span class="sc2">#Display menus &amp; business logic actions based on your choice</span><span class="sc0">
</span><span class="sc8">productionControl_menus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">clear</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           $(hostname)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            Production Control Menu"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           1. Show User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           2. Create Alliance User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           3. Create Support User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           4. Copy User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           5. Rename User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           6. Delete User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           7. Change User(s) Full name/Branch Office"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           8. Enable/Disable User(s)"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           9. Reset User(s) Password"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           10. Unlock User(s) locked by 5 failed passwd retries"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"           x. Exit"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"                                         "</span><span class="sc0">    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${BOLD}Type 'M' to return this Menu ${NORM}"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"                                         "</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">userSupport_menus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">clear</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            $(hostname)                  "</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"             User Support Menu"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            1. Reset User(s) Password"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            2. Unlock User(s) locked by 5 failed passwd retries"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"            x. Exit"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"                                         "</span><span class="sc0">    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${BOLD}Type 'M' to return this Menu  ${NORM}"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"                                         "</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">
 
</span><span class="sc8">productionControl_options</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">choice</span><span class="sc7">?</span><span class="sc5">"Enter choice [ 1 - 10; x to Exit ]: "</span><span class="sc0">

</span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$choice</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0">
</span><span class="sc3">9</span><span class="sc7">)</span><span class="sc2">#Reset_User_Passwd</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nReset User Password"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">newPasswd</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">stty</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">echo</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Password length more than 8 characters${NORM}\n"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newPasswd</span><span class="sc7">?</span><span class="sc5">"Enter New Password for $userName :  "</span><span class="sc0">
        </span><span class="sc4">stty</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newPasswd</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">   </span><span class="sc2"># To Main Menu</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#newPasswd}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">8</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}$userName password less then 8 characters${NORM}"</span><span class="sc0"> 
            </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
            
            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">
        
        </span><span class="sc8">Reset_User_Passwd</span><span class="sc0">                           </span><span class="sc2">#yes</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">    
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">10</span><span class="sc7">)</span><span class="sc2">#Unlock_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nUnlock Users"</span><span class="sc0">               
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
    
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Unlock $userName ??? ${NORM}\n"</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">
        
        </span><span class="sc8">Unlock_User</span><span class="sc0">                                 </span><span class="sc2">#yes</span><span class="sc0">
            
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">1</span><span class="sc7">)</span><span class="sc2">#Show_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nShow Users Information"</span><span class="sc0">             
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">

        </span><span class="sc4">clear</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Detailed $userName information${NORM}\n"</span><span class="sc0">

        </span><span class="sc8">Show_User</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">2</span><span class="sc7">)</span><span class="sc2">#Create_Alliance_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nCreate Alliance Users"</span><span class="sc0">      
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Maximum 8 characters for alliance user name ${NORM}\n"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0"> </span><span class="sc8">new</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
            
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
        </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">?</span><span class="sc5">"Enter $userName full name : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$fullName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$fullName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">"defaultFullName"</span><span class="sc0">

        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">?</span><span class="sc5">"Enter $userName Branch Office : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$office</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$office</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">"defaultOffice"</span><span class="sc0">               
                
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">userType</span><span class="sc7">?</span><span class="sc5">"Enter $userName User Type[ IMPORT | PEP ] : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">^</span><span class="sc8">p</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">"PEP"</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">"IMPORT"</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
                
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nUser Name : ${BOLD}$userName${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Full Name : ${BOLD}$fullName${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Branch Office : ${BOLD}$office${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"User Type : ${BOLD}$userType${NORM} "</span><span class="sc0">
                
        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Create_Alliance_User</span><span class="sc0">                        </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
                
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">3</span><span class="sc7">)</span><span class="sc2">#Create_Support_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nCreate Support Users"</span><span class="sc0">       
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Maximum 8 characters for support user name ${NORM}\n"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0"> </span><span class="sc8">new</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
            
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
        </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">?</span><span class="sc5">"Enter $userName full name : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$fullName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$fullName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">"defaultFullName"</span><span class="sc0">

        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">?</span><span class="sc5">"Enter $userName Branch Office : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$office</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$office</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">"defaultOffice"</span><span class="sc0">               
                
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">userType</span><span class="sc7">?</span><span class="sc5">"Enter $userName User Type[ User Support | Production Control ] : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">^</span><span class="sc8">u</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">"UserSupport"</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">"ProductionControl"</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
                
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nUser Name : ${BOLD}$userName${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Full Name : ${BOLD}$fullName${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Branch Office : ${BOLD}$office${NORM} "</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"User Type : ${BOLD}$userType${NORM} "</span><span class="sc0">
                
        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Create_Support_User</span><span class="sc0">                         </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
                
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">4</span><span class="sc7">)</span><span class="sc2">#Copy_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Copy Users${NORM}\n"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0"> </span><span class="sc8">source</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
            
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
            
        </span><span class="sc8">newName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nSource User Account: ${BOLD}$userName${NORM}"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newName</span><span class="sc7">?</span><span class="sc5">"Enter Target User Account Name : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}No Target Account name input${NORM}"</span><span class="sc0">
            </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
                
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nSource User Account: ${BOLD}$userName${NORM}"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Target User Account : ${BOLD}$newName${NORM}"</span><span class="sc0">
                
        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Copy_User</span><span class="sc0">                                   </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">5</span><span class="sc7">)</span><span class="sc2">#Rename_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nRename Users"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">
    
    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
            
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
            
        </span><span class="sc8">newName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nOld User Account: ${BOLD}$userName${NORM}"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newName</span><span class="sc7">?</span><span class="sc5">"Enter New User Account Name : "</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}No New Account name input${NORM}"</span><span class="sc0">
            </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
                
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nOld User Account: ${BOLD}$userName${NORM}"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"New User Account: ${BOLD}$newName${NORM}\n"</span><span class="sc0">
                
        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Rename_User</span><span class="sc0">                                 </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
                
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">6</span><span class="sc7">)</span><span class="sc2">#Delete_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nDelete Users"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
        
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc8">getLocation</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n$userName Full Name : ${BOLD}$fullName${NORM}"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$userName office : ${BOLD}$office${NORM}\n"</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${BOLD}Delete $userName ??? ${NORM}\n"</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Delete_User</span><span class="sc0">                                 </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
            
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">7</span><span class="sc7">)</span><span class="sc2">#Change_User_Location</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nChange Users Branch Office and Users Full Name"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc8">getLocation</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n$userName Full Name : ${BOLD}$fullName${NORM}"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$userName office : ${BOLD}$office${NORM}\n"</span><span class="sc0">

        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newFullName</span><span class="sc7">?</span><span class="sc5">"Enter New Full Name ( RETURN if no change) :  "</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newOffice</span><span class="sc7">?</span><span class="sc5">"Enter New Office Name ( RETURN if no change) :  "</span><span class="sc0">

        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newFullName</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc9">$newFullName</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newOffice</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc9">$newOffice</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n$userName Full Name : ${BOLD}$fullName${NORM}"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$userName office : ${BOLD}$office${NORM}\n"</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

        </span><span class="sc8">Change_User_Location</span><span class="sc0">                        </span><span class="sc2">#yes</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">    
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">8</span><span class="sc7">)</span><span class="sc2">#Enable_Disable_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nEnable / Disable Users"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">
    
    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc8">getLockStatus</span><span class="sc0">
        
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$lockStatus</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"false"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n\n${BOLD}Disable $userName ??? ${NORM}\n"</span><span class="sc0">

            </span><span class="sc8">checkConfirm</span><span class="sc0">
            </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
                </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
                </span><span class="sc4">continue</span><span class="sc0">
                </span><span class="sc7">}</span><span class="sc0">           
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">

            </span><span class="sc8">Enable_Disable_User</span><span class="sc0">                         </span><span class="sc2">#yes</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n\n${BOLD}Enable $userName ??? ${NORM}\n"</span><span class="sc0">

            </span><span class="sc8">checkConfirm</span><span class="sc0">
            </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
                </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
                </span><span class="sc4">continue</span><span class="sc0">
                </span><span class="sc7">}</span><span class="sc0">           
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">
        
            </span><span class="sc8">Enable_Disable_User</span><span class="sc0">                         </span><span class="sc2">#yes</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">
        
        </span><span class="sc4">fi</span><span class="sc0">
            
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc8">x</span><span class="sc7">|</span><span class="sc8">X</span><span class="sc7">)</span><span class="sc2">#Exit Production Control Menu</span><span class="sc0">
    </span><span class="sc4">exit</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc7">*)</span><span class="sc0">  </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}Error choice...${NORM}"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
</span><span class="sc4">esac</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">userSupport_options</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">choice</span><span class="sc7">?</span><span class="sc5">"Enter choice [ 1 - 2; x to Exit ]: "</span><span class="sc0">
</span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$choice</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

</span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$choice</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0">
</span><span class="sc3">1</span><span class="sc7">)</span><span class="sc2">#Reset_User_Passwd</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nReset User Password"</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">

    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">newPasswd</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">stty</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">echo</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Password length more than 8 characters${NORM}\n"</span><span class="sc0">
        </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">newPasswd</span><span class="sc7">?</span><span class="sc5">"Enter New Password for $userName :  "</span><span class="sc0">
        </span><span class="sc4">stty</span><span class="sc0"> </span><span class="sc8">echo</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newPasswd</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">   </span><span class="sc2"># To Main Menu</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#newPasswd}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">8</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}$userName password less then 8 characters${NORM}"</span><span class="sc0"> 
            </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

            </span><span class="sc4">continue</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">
        
        </span><span class="sc8">Reset_User_Passwd</span><span class="sc0">                           </span><span class="sc2">#yes</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">    
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc3">2</span><span class="sc7">)</span><span class="sc2">#Unlock_User</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nUnlock Users"</span><span class="sc0">               
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">sc</span><span class="sc0">
    
    </span><span class="sc8">checkInputs</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">       </span><span class="sc2"># To Main Menu</span><span class="sc0">
        
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userNames[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
    </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
    
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userNames[i]}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Unlock $userName ??? ${NORM}\n"</span><span class="sc0">

        </span><span class="sc8">checkConfirm</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">              </span><span class="sc2">#no</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
            </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">           
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">       </span><span class="sc2">#Not(yes/no)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">          </span><span class="sc2">#RETURN to Main Menu</span><span class="sc0">
        
        </span><span class="sc8">Unlock_User</span><span class="sc0">                                 </span><span class="sc2">#yes</span><span class="sc0">
            
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc8">x</span><span class="sc7">|</span><span class="sc8">X</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0">
    </span><span class="sc7">;;</span><span class="sc0">
</span><span class="sc7">*)</span><span class="sc0">  </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}Error choice...${NORM}"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
</span><span class="sc4">esac</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#######################################################################################</span><span class="sc0">
</span><span class="sc2">#  File name    : muser.ksh</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Author      : Liru Chen</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Description : New AIX Alliance User Management</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  USAGE       : muser.ksh case_choice #parameters</span><span class="sc0">
</span><span class="sc2">#  Date        : 2015-04-30</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#           #include &lt;stdio.h&gt;</span><span class="sc0">
</span><span class="sc2">#           #include &lt;stdlib.h&gt;</span><span class="sc0">
</span><span class="sc2">#           #include &lt;sys/types.h&gt;</span><span class="sc0">
</span><span class="sc2">#           #include &lt;unistd.h&gt;</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#           int main()</span><span class="sc0">
</span><span class="sc2">#           {</span><span class="sc0">
</span><span class="sc2">#              setuid( 0 );</span><span class="sc0">
</span><span class="sc2">#              system( "/alliance/RUNTIME/LIVOPER/menu.ksh" );</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#              return 0;</span><span class="sc0">
</span><span class="sc2">#           }</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">########################################################################################</span><span class="sc0">
</span><span class="sc8">aix_muser</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2"># TEXT Colours  </span><span class="sc0">
    </span><span class="sc2">## Reset to normal: \033[0m</span><span class="sc0">
    </span><span class="sc8">NORM</span><span class="sc7">=</span><span class="sc5">"\033[0m"</span><span class="sc0">

    </span><span class="sc2">## Colors:</span><span class="sc0">
    </span><span class="sc8">BLACK</span><span class="sc7">=</span><span class="sc5">"\033[0;30m"</span><span class="sc0">
    </span><span class="sc8">GRAY</span><span class="sc7">=</span><span class="sc5">"\033[1;30m"</span><span class="sc0">
    </span><span class="sc8">RED</span><span class="sc7">=</span><span class="sc5">"\033[0;31m"</span><span class="sc0">
    </span><span class="sc8">LRED</span><span class="sc7">=</span><span class="sc5">"\033[1;31m"</span><span class="sc0">
    </span><span class="sc8">GREEN</span><span class="sc7">=</span><span class="sc5">"\033[0;32m"</span><span class="sc0">
    </span><span class="sc8">LGREEN</span><span class="sc7">=</span><span class="sc5">"\033[1;32m"</span><span class="sc0">
    </span><span class="sc8">YELLOW</span><span class="sc7">=</span><span class="sc5">"\033[0;33m"</span><span class="sc0">
    </span><span class="sc8">LYELLOW</span><span class="sc7">=</span><span class="sc5">"\033[1;33m"</span><span class="sc0">
    </span><span class="sc8">BLUE</span><span class="sc7">=</span><span class="sc5">"\033[0;34m"</span><span class="sc0">
    </span><span class="sc8">LBLUE</span><span class="sc7">=</span><span class="sc5">"\033[1;34m"</span><span class="sc0">
    </span><span class="sc8">PURPLE</span><span class="sc7">=</span><span class="sc5">"\033[0;35m"</span><span class="sc0">
    </span><span class="sc8">PINK</span><span class="sc7">=</span><span class="sc5">"\033[1;35m"</span><span class="sc0">
    </span><span class="sc8">CYAN</span><span class="sc7">=</span><span class="sc5">"\033[0;36m"</span><span class="sc0">
    </span><span class="sc8">LCYAN</span><span class="sc7">=</span><span class="sc5">"\033[1;36m"</span><span class="sc0">
    </span><span class="sc8">LGRAY</span><span class="sc7">=</span><span class="sc5">"\033[0;37m"</span><span class="sc0">
    </span><span class="sc8">WHITE</span><span class="sc7">=</span><span class="sc5">"\033[1;37m"</span><span class="sc0">

    </span><span class="sc2">## Backgrounds</span><span class="sc0">
    </span><span class="sc8">BLACKB</span><span class="sc7">=</span><span class="sc5">"\033[0;40m"</span><span class="sc0">
    </span><span class="sc8">REDB</span><span class="sc7">=</span><span class="sc5">"\033[0;41m"</span><span class="sc0">
    </span><span class="sc8">GREENB</span><span class="sc7">=</span><span class="sc5">"\033[0;42m"</span><span class="sc0">
    </span><span class="sc8">YELLOWB</span><span class="sc7">=</span><span class="sc5">"\033[0;43m"</span><span class="sc0">
    </span><span class="sc8">BLUEB</span><span class="sc7">=</span><span class="sc5">"\033[0;44m"</span><span class="sc0">
    </span><span class="sc8">PURPLEB</span><span class="sc7">=</span><span class="sc5">"\033[0;45m"</span><span class="sc0">
    </span><span class="sc8">CYANB</span><span class="sc7">=</span><span class="sc5">"\033[0;46m"</span><span class="sc0">
    </span><span class="sc8">GREYB</span><span class="sc7">=</span><span class="sc5">"\033[0;47m"</span><span class="sc0">

    </span><span class="sc2">## Attributes:</span><span class="sc0">
    </span><span class="sc8">UNDERLINE</span><span class="sc7">=</span><span class="sc5">"\033[4m"</span><span class="sc0">
    </span><span class="sc8">BOLD</span><span class="sc7">=</span><span class="sc5">"\033[1m"</span><span class="sc0">
    </span><span class="sc8">INVERT</span><span class="sc7">=</span><span class="sc5">"\033[7m"</span><span class="sc0">

    </span><span class="sc2">## Cursor movements</span><span class="sc0">
    </span><span class="sc8">CUR_UP</span><span class="sc7">=</span><span class="sc5">"\033[1A"</span><span class="sc0">
    </span><span class="sc8">CUR_DN</span><span class="sc7">=</span><span class="sc5">"\033[1B"</span><span class="sc0">
    </span><span class="sc8">CUR_LEFT</span><span class="sc7">=</span><span class="sc5">"\033[1D"</span><span class="sc0">
    </span><span class="sc8">CUR_RIGHT</span><span class="sc7">=</span><span class="sc5">"\033[1C"</span><span class="sc0">

    </span><span class="sc2">## Start of display (top left)</span><span class="sc0">
    </span><span class="sc8">SOD</span><span class="sc7">=</span><span class="sc5">"\033[1;1f"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#PART I: Basic Function</span><span class="sc0">
</span><span class="sc8">resetAll</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">clear</span><span class="sc0">
    </span><span class="sc8">inputs</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">wildCardUserName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">userNames</span><span class="sc7">=(</span><span class="sc5">""</span><span class="sc7">)</span><span class="sc0">
    </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">newName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">newPasswd</span><span class="sc7">=</span><span class="sc5">"welcome"</span><span class="sc0">
    </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">lockStatus</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">keyReturn</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">pause</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">keyReturn</span><span class="sc7">?</span><span class="sc5">"Press [Enter] to continue... "</span><span class="sc0"> 
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$keyReturn</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">    </span><span class="sc2"># Type "M" at any pause to Return to Main Menu</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#display messages needed by Production Control and User Support team</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#exit codes 1 - 2, 126 - 165, and 255 [1] have special meanings, </span><span class="sc0">
</span><span class="sc2">#and should therefore be avoided for user-specified exit parameters</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#Code 1-50: OS/SHELL massages</span><span class="sc0">
</span><span class="sc2">#Code 51-100: Program flow control</span><span class="sc0">
</span><span class="sc2">#              51/52 to Main Menu </span><span class="sc0">
</span><span class="sc2">#              80 to Production Control team menu</span><span class="sc0">
</span><span class="sc2">#              81 to User Support menu</span><span class="sc0">
</span><span class="sc2">#              100 confirmation "yes"</span><span class="sc0">
</span><span class="sc2">#              101 confirmation "no"</span><span class="sc0">
</span><span class="sc2">#              102 confirmation no answer</span><span class="sc0">
</span><span class="sc2"># Code 201-254: Program massages</span><span class="sc0">
</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${BOLD}Task on $2 completed ${NORM}\n"</span><span class="sc0">
        </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">200</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">207</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">     </span><span class="sc2">#Code defined in this script</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${RED} failure return code $1 ${NORM}"</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} $2 Already Exist ${NORM}"</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} $2 Not Exist ${NORM}"</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">203</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} $2 Exist, Action Not Authorized ${NORM}"</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">204</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} $2 Exist, Action Not Authorized ${NORM}"</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} UserID Full, Contact System Admin ${NORM}"</span><span class="sc0"> 
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">206</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} UserName Too Long ${NORM}"</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">        </span><span class="sc2"># system return Code</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n${RED} Operation System return code $1 ${NORM}"</span><span class="sc0">
        </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># Check the user accounts and get userID, return codes defined by business logic</span><span class="sc0">
</span><span class="sc8">checkName</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">name</span><span class="sc7">=</span><span class="sc10">${1-$userName}</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc5">"^$name:"</span><span class="sc0"> </span><span class="sc9">$passwordFile</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc2"># user account name exist</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"root"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">231</span><span class="sc0">    </span><span class="sc2"># Never work on root</span><span class="sc0">
        
        </span><span class="sc8">userID</span><span class="sc7">=</span><span class="sc11">$(grep "^$name:" $passwordFile | cut -f3 -d:)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">2400</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">203</span><span class="sc0">  </span><span class="sc2"># lower than userID range</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">5000</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">204</span><span class="sc0">  </span><span class="sc2"># higher than userID range</span><span class="sc0">

        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">      </span><span class="sc2"># user account authorized for management with this script</span><span class="sc0">

    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc2"># user account name NOT exist in system</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#name}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">gt</span><span class="sc0"> </span><span class="sc3">8</span><span class="sc0"> </span><span class="sc7">]]&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">206</span><span class="sc0">   </span><span class="sc2"># new user account name so long</span><span class="sc0">

        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">      </span><span class="sc2"># new user account name is good</span><span class="sc0">

    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Check wild card "*" in input names, names will be added from /etc/passwd if matched</span><span class="sc0">
</span><span class="sc2">#Only "*alphabetic" and "alphabetic*" is accepted here</span><span class="sc0">
</span><span class="sc8">checkWildCardName</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">cut</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">f1</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc7">:</span><span class="sc0"> </span><span class="sc9">$passwordFile</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0">

    </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc10">${inputs//'*'/'*'/}</span><span class="sc0">
    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc9">$users</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">scount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">icount</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">icount</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">scount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">wildCard</span><span class="sc7">=</span><span class="sc11">$(echo "$1" | grep '*')</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$wildCard</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc11">$(echo $users $1)</span><span class="sc0">

            </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc8">icount</span><span class="sc7">=</span><span class="sc8">icount+1</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc8">wildCardUserName</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
        
            </span><span class="sc8">patternStart</span><span class="sc7">=</span><span class="sc11">$(echo "$wildCardUserName" | cut -f1 -d"*")</span><span class="sc0">
            </span><span class="sc8">patternEnd</span><span class="sc7">=</span><span class="sc11">$(echo "$wildCardUserName" | cut -f2 -d"/")</span><span class="sc0">
        
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$patternStart</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">patternUserNames</span><span class="sc7">=</span><span class="sc11">$(grep -i "${patternEnd}$" $userFile)</span><span class="sc0">      
                </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc11">$(echo $users $patternUserNames)</span><span class="sc0">
            </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$patternEnd</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">patternUserNames</span><span class="sc7">=</span><span class="sc11">$(grep -i "^${patternStart}" $userFile)</span><span class="sc0">        
                </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc11">$(echo $users $patternUserNames)</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc8">patternUserNames</span><span class="sc7">=</span><span class="sc11">$(grep "^${patternStart}$" $userFile)</span><span class="sc0">      
                </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc11">$(echo $users $patternUserNames)</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">  
            
            </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc8">icount</span><span class="sc7">=</span><span class="sc8">icount+1</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Get and verify userNames from key-in &lt;inputs&gt; string for further processing</span><span class="sc0">
</span><span class="sc8">checkInputs</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">inputs</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">       </span><span class="sc2">#Empty inputs string</span><span class="sc0">
    </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">userNames</span><span class="sc7">=(</span><span class="sc5">""</span><span class="sc7">)</span><span class="sc0">  </span><span class="sc2">#Empty userNames array</span><span class="sc0">
    
    </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">inputs</span><span class="sc7">?</span><span class="sc5">"Enter $1 user account name(s) : "</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$inputs</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"M"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">   </span><span class="sc2"># return to Main Menu</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$inputs</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">52</span><span class="sc0">    </span><span class="sc2"># No input available, return to Main Menu</span><span class="sc0">
    
    </span><span class="sc2">#Rebuild &lt;inputs&gt; to &lt;users&gt; if wild card * in account name</span><span class="sc0">
    </span><span class="sc8">checkWildCardName</span><span class="sc0">

    </span><span class="sc2">#Check each user name, make sure this user account is authorized for this script    </span><span class="sc0">
    </span><span class="sc8">userArray</span><span class="sc7">=(</span><span class="sc11">$(echo $users|tr A-Z a-z)</span><span class="sc7">)</span><span class="sc0">       </span><span class="sc2">#lower case and assign inputs to array</span><span class="sc0">

    </span><span class="sc2"># echo "\nVerify Your Input: " ${BOLD}${userArray[@]}${NORM} "\n"</span><span class="sc0">
    </span><span class="sc2"># pause; [[ $? -eq 51 ]] &amp;&amp; return 51</span><span class="sc0">

    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$newUserFile</span><span class="sc0">
    
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc10">${#userArray[@]}</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc10">${userArray[i]}</span><span class="sc0">
        
        </span><span class="sc8">checkName</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
        </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"new"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">      </span><span class="sc2"># Code 202 userName Not Exist</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${userArray[i]}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0">
                </span><span class="sc8">userArray</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]=</span><span class="sc5">""</span><span class="sc0">     </span><span class="sc2">#delete user name in &lt;users&gt; string which cannot be processed</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">      </span><span class="sc2"># Code 201 userName Already Exist </span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${userArray[i]}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$newUserFile</span><span class="sc0">
                </span><span class="sc8">userArray</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]=</span><span class="sc5">""</span><span class="sc0">     </span><span class="sc2">#delete user name in &lt;users&gt; string which cannot be processed</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc2">#notify </span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-s</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}Following User name(s) is too long, and/or already exist: "</span><span class="sc0"> 
        </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${NORM}\n"</span><span class="sc0">
        </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-s</span><span class="sc0"> </span><span class="sc9">$newUserFile</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED}Following User name(s) not exist, and/or not authorized: "</span><span class="sc0"> 
        </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$newUserFile</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${NORM}\n"</span><span class="sc0">
        </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc8">userNames</span><span class="sc7">=(</span><span class="sc11">$(echo ${userArray[@]})</span><span class="sc7">)</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#userNames[@]}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">   </span><span class="sc2"># no User Account available</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nStart processing: "</span><span class="sc0"> </span><span class="sc10">${BOLD}${userNames[@]}${NORM}</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
    </span><span class="sc8">pause</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">50</span><span class="sc0"> </span><span class="sc2"># get User Account names for further processing</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Get confirmation from inputs</span><span class="sc0">
</span><span class="sc8">checkConfirm</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">confirmation</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
    </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">confirmation</span><span class="sc7">?</span><span class="sc5">"Please confirm (yes/no)? "</span><span class="sc0">

    </span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$confirmation</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0">
    </span><span class="sc4">yes</span><span class="sc7">|</span><span class="sc8">y</span><span class="sc7">)</span><span class="sc2"># confirmed "yes"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">100</span><span class="sc0">
        </span><span class="sc7">;;</span><span class="sc0">
    </span><span class="sc8">no</span><span class="sc7">|</span><span class="sc8">n</span><span class="sc7">)</span><span class="sc2"># confirmed "no"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">101</span><span class="sc0">
        </span><span class="sc7">;;</span><span class="sc0">
    </span><span class="sc8">M</span><span class="sc7">)</span><span class="sc2"># Return to Main Menu</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">51</span><span class="sc0">
        </span><span class="sc7">;;</span><span class="sc0">
    </span><span class="sc7">*)</span><span class="sc0">  </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${RED} Please confirm the information you input... ${NORM}"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
            </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">rc</span><span class="sc0">
            </span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc8">ed</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">102</span><span class="sc0">
    </span><span class="sc4">esac</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Get more detailed information by userName</span><span class="sc0">
</span><span class="sc8">getLocation</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">gecos</span><span class="sc7">=</span><span class="sc11">$(grep "^$userName:" $passwordFile | cut -d ':' -f5)</span><span class="sc0">
    </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc11">$(echo $gecos | cut -d '(' -f1)</span><span class="sc0">
    </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc11">$(echo $gecos |cut -d '(' -f2 | cut -d ')' -f1)</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">getLockStatus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">lockStatus</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep account_locked | cut -d '=' -f2)</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Get free OS userID for new user account</span><span class="sc0">
</span><span class="sc8">setID</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">id</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc9">$idStart</span><span class="sc7">..</span><span class="sc9">$idEnd</span><span class="sc7">}</span><span class="sc0">
</span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc8">userID</span><span class="sc7">=</span><span class="sc9">$id</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc5">":$userID:"</span><span class="sc0"> </span><span class="sc9">$passwordFile</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">break</span><span class="sc0">
</span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Set some attributions for new user account</span><span class="sc0">
</span><span class="sc8">setAttr</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">chuser</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">loginretries</span><span class="sc7">=</span><span class="sc9">$loginRetryTime</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">maxage</span><span class="sc7">=</span><span class="sc9">$passwdAge</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">histexpire</span><span class="sc7">=</span><span class="sc9">$noPasswdReuseTime</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">histsize</span><span class="sc7">=</span><span class="sc9">$noPasswdReuseNum</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">minlen</span><span class="sc7">=</span><span class="sc9">$passwdLength</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">pwdwarntime</span><span class="sc7">=</span><span class="sc9">$passwdWarnDays</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">setPasswd</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"echo $userName:$newPasswd | chpasswd"</span><span class="sc0">

</span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">getexpireDate</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc11">$(date +%m)</span><span class="sc0">
    </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc11">$(date +%y)</span><span class="sc0">

    </span><span class="sc8">month</span><span class="sc7">=$((</span><span class="sc8">month+1</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">13</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc3">01</span><span class="sc0">
    </span><span class="sc8">year</span><span class="sc7">=$((</span><span class="sc8">year+1</span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#month}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc9">$month</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#year}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc9">$year</span><span class="sc0">
    
    </span><span class="sc8">expireDate</span><span class="sc7">=</span><span class="sc9">$month$</span><span class="sc7">(</span><span class="sc4">date</span><span class="sc0"> </span><span class="sc7">+%</span><span class="sc8">d</span><span class="sc7">%</span><span class="sc8">H</span><span class="sc7">%</span><span class="sc8">M</span><span class="sc7">)</span><span class="sc9">$year</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Part II: Option Function   </span><span class="sc0">
</span><span class="sc8">Show_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">lsuser</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$userFile</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Primary Group: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "pgrp=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Groups: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "groups=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Home Directory: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "home=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"OFFICE: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "gecos=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Can Login to System: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "login=" $userFile | grep -v "_login" | grep -v "rlogin" | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Number of weeks password is valid: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "maxage=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Number of weeks must wait before changing password: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "minage=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Minimum number of characters in password: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "minlen=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Account Expire Date: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "expires=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Number of unsuccessful login attempts allowed: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "loginretries" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Unsuccessful Login Count: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "unsuccessful_login_count=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Account Locked: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}</span><span class="sc11">$(grep "account_locked=" $userFile | cut -f2 -d"=")</span><span class="sc10">${NORM}</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n"</span><span class="sc0">
    </span><span class="sc8">time_tmp</span><span class="sc7">=</span><span class="sc11">$(grep "time_last_login=" $userFile | cut -f2 -d"=")</span><span class="sc0">
    </span><span class="sc8">timeLastLogin</span><span class="sc7">=</span><span class="sc11">$(perl -le 'print scalar localtime(shift)' $time_tmp)</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Time Last Login: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}${timeLastLogin}${NORM}</span><span class="sc0">

    </span><span class="sc8">time_tmp</span><span class="sc7">=</span><span class="sc11">$(grep "time_last_unsuccessful_login=" $userFile | cut -f2 -d"=")</span><span class="sc0">
    </span><span class="sc8">timeUnsuccessfulLogin</span><span class="sc7">=</span><span class="sc11">$(perl -le 'print scalar localtime(shift)' $time_tmp)</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Time Last Unsuccessful Login: "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
          </span><span class="sc10">${BOLD}${timeUnsuccessfulLogin}${NORM}</span><span class="sc0">
    
    </span><span class="sc2">#more $userFile</span><span class="sc0">
    
</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Create_Alliance_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">"/appuser"</span><span class="sc0">
    </span><span class="sc8">primaryGroup</span><span class="sc7">=</span><span class="sc5">"staff"</span><span class="sc0">
    </span><span class="sc8">groups</span><span class="sc7">=</span><span class="sc5">"oinstall,loadl"</span><span class="sc0">
    </span><span class="sc8">shell</span><span class="sc7">=</span><span class="sc5">"/usr/bin/ksh"</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"PEP"</span><span class="sc0"> </span><span class="sc7">];</span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">2501</span><span class="sc0">
        </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">2600</span><span class="sc0">
        </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">"/appuser/pep/alluser_pep.profile"</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">3001</span><span class="sc0">
        </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">5000</span><span class="sc0">
        </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">"/appuser/alliance/alluser.profile"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">setID</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$idEnd</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">208</span><span class="sc0">          </span><span class="sc2"># No Free User ID </span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
        
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"USERNAME $userName is good"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"USERID $userID is good"</span><span class="sc0">
    
    </span><span class="sc8">lowercase_Comment</span><span class="sc7">=</span><span class="sc5">"${office//"</span><span class="sc0"> </span><span class="sc5">"/,}\(${fullName//"</span><span class="sc0"> </span><span class="sc5">"/,}\)"</span><span class="sc0">
    </span><span class="sc8">comment</span><span class="sc7">=</span><span class="sc11">$(echo $lowercase_Comment|tr a-z A-Z)</span><span class="sc0">
    </span><span class="sc8">homeDir</span><span class="sc7">=</span><span class="sc9">$appDir</span><span class="sc7">/</span><span class="sc9">$userName</span><span class="sc0">

    </span><span class="sc2"># Create user and set user's attributions</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">mv</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc7">.</span><span class="sc11">$(date +%y%m%d%M%S)</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">useradd</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$comment"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc9">$primaryGroup</span><span class="sc0"> </span><span class="sc8">-G</span><span class="sc0"> </span><span class="sc9">$groups</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$shell</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">-u</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
     
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc7">/.</span><span class="sc8">profile</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc7">/.</span><span class="sc8">profile.ori</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">ln</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">sf</span><span class="sc0"> </span><span class="sc9">$Profile</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc7">/.</span><span class="sc8">profile</span><span class="sc0">

    </span><span class="sc8">setAttr</span><span class="sc0">
    </span><span class="sc8">setPasswd</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Create_Support_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">"/appuser"</span><span class="sc0">
    </span><span class="sc8">primaryGroup</span><span class="sc7">=</span><span class="sc5">"usersupport"</span><span class="sc0">
    </span><span class="sc8">groups</span><span class="sc7">=</span><span class="sc5">"staff"</span><span class="sc0">
    </span><span class="sc8">shell</span><span class="sc7">=</span><span class="sc5">"/alliance/RUNTIME/LIVOPER/menu"</span><span class="sc0">
    </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">2401</span><span class="sc0">
    </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">2500</span><span class="sc0">

    </span><span class="sc8">lowercase_Comment</span><span class="sc7">=</span><span class="sc5">"${office//"</span><span class="sc0"> </span><span class="sc5">"/,}\(${fullName//"</span><span class="sc0"> </span><span class="sc5">"/,}\)"</span><span class="sc0">
    </span><span class="sc8">comment_location</span><span class="sc7">=</span><span class="sc11">$(echo $lowercase_Comment|tr a-z A-Z)</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc9">$userType</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"UserSupport"</span><span class="sc0"> </span><span class="sc7">];</span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">comment</span><span class="sc7">=</span><span class="sc5">"AllianceUserSupport$comment_location"</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">comment</span><span class="sc7">=</span><span class="sc5">"AllianceProductionControl$comment_location"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">setID</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$idEnd</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">208</span><span class="sc0">          </span><span class="sc2"># No Free User ID </span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
        
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"USERNAME $userName is good"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"USERID $userID is good"</span><span class="sc0">
    
    </span><span class="sc8">homeDir</span><span class="sc7">=</span><span class="sc9">$appDir</span><span class="sc7">/</span><span class="sc9">$userName</span><span class="sc0">

    </span><span class="sc2"># Create user and set user's attributions</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">mv</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc7">.</span><span class="sc11">$(date +%y%m%d%M%S)</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">useradd</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$comment"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc9">$homeDir</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc9">$primaryGroup</span><span class="sc0"> </span><span class="sc8">-G</span><span class="sc0"> </span><span class="sc9">$groups</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$shell</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">-u</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">

    </span><span class="sc8">setAttr</span><span class="sc0">
    </span><span class="sc8">setPasswd</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Copy_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">checkName</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
    </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc8">id_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep id= )</span><span class="sc0">
    </span><span class="sc8">pgrp_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep pgrp= )</span><span class="sc0">
    </span><span class="sc8">groups_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep groups= )</span><span class="sc0">
    </span><span class="sc8">home_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep home= )</span><span class="sc0">
    </span><span class="sc8">shell_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep shell= )</span><span class="sc0">
    </span><span class="sc8">gecos_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep gecos= )</span><span class="sc0">
    </span><span class="sc8">login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep login= )</span><span class="sc0">
    </span><span class="sc8">su_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep su= )</span><span class="sc0">
    </span><span class="sc8">rlogin_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep rlogin= )</span><span class="sc0">
    </span><span class="sc8">daemon_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep daemon= )</span><span class="sc0">
    </span><span class="sc8">admin_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep admin= )</span><span class="sc0">
    </span><span class="sc8">sugroups_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep sugroups= )</span><span class="sc0">
    </span><span class="sc8">admgroups_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep admgroups= )</span><span class="sc0">
    </span><span class="sc8">tpath_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep tpath= )</span><span class="sc0">
    </span><span class="sc8">ttys_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep ttys= )</span><span class="sc0">
    </span><span class="sc8">expires_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep expires= )</span><span class="sc0">
    </span><span class="sc8">auth1_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep auth1= )</span><span class="sc0">
    </span><span class="sc8">auth2_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep auth2= )</span><span class="sc0">
    </span><span class="sc8">umask_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep umask= )</span><span class="sc0">
    </span><span class="sc8">registry_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep registry= )</span><span class="sc0">
    </span><span class="sc8">SYSTEM_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep SYSTEM= )</span><span class="sc0">
    </span><span class="sc8">logintimes_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep logintimes= )</span><span class="sc0">
    </span><span class="sc8">loginretries_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep loginretries= )</span><span class="sc0">
    </span><span class="sc8">pwdwarntime_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep pwdwarntime= )</span><span class="sc0">
    </span><span class="sc8">account_locked_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep account_locked= )</span><span class="sc0">
    </span><span class="sc8">minage_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minage= )</span><span class="sc0">
    </span><span class="sc8">maxage_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep maxage= )</span><span class="sc0">
    </span><span class="sc8">maxexpired_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep maxexpired= )</span><span class="sc0">
    </span><span class="sc8">minalpha_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minalpha= )</span><span class="sc0">
    </span><span class="sc8">minloweralpha_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minloweralpha= )</span><span class="sc0">
    </span><span class="sc8">minupperalpha_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minupperalpha= )</span><span class="sc0">
    </span><span class="sc8">minother_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minother= )</span><span class="sc0">
    </span><span class="sc8">mindigit_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep mindigit= )</span><span class="sc0">
    </span><span class="sc8">minspecialchar_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minspecialchar= )</span><span class="sc0">
    </span><span class="sc8">mindiff_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep mindiff= )</span><span class="sc0">
    </span><span class="sc8">maxrepeats_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep maxrepeats= )</span><span class="sc0">
    </span><span class="sc8">minlen_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep minlen= )</span><span class="sc0">
    </span><span class="sc8">histexpire_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep histexpire= )</span><span class="sc0">
    </span><span class="sc8">histsize_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep histsize= )</span><span class="sc0">
    </span><span class="sc8">pwdchecks_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep pwdchecks= )</span><span class="sc0">
    </span><span class="sc8">dictionlist_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep dictionlist= )</span><span class="sc0">
    </span><span class="sc8">default_roles_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep default_roles= )</span><span class="sc0">
    </span><span class="sc8">fsize_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep fsize= )</span><span class="sc0">
    </span><span class="sc8">cpu_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep cpu= )</span><span class="sc0">
    </span><span class="sc8">data_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep data= )</span><span class="sc0">
    </span><span class="sc8">stack_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep stack= )</span><span class="sc0">
    </span><span class="sc8">core_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep core= )</span><span class="sc0">
    </span><span class="sc8">rss_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep rss= )</span><span class="sc0">
    </span><span class="sc8">nofiles_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep nofiles= )</span><span class="sc0">
    </span><span class="sc8">time_last_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep time_last_login= )</span><span class="sc0">
    </span><span class="sc8">time_last_unsuccessful_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep time_last_unsuccessful_login= )</span><span class="sc0">
    </span><span class="sc8">tty_last_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep tty_last_login= )</span><span class="sc0">
    </span><span class="sc8">tty_last_unsuccessful_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep tty_last_unsuccessful_login= )</span><span class="sc0">
    </span><span class="sc8">host_last_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep host_last_login= )</span><span class="sc0">
    </span><span class="sc8">host_last_unsuccessful_login_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep host_last_unsuccessful_login= )</span><span class="sc0">
    </span><span class="sc8">unsuccessful_login_count_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep unsuccessful_login_count= )</span><span class="sc0">
    </span><span class="sc8">roles_value</span><span class="sc7">=</span><span class="sc11">$(sudo su -c lsuser -f $userName | grep roles= )</span><span class="sc0">

    </span><span class="sc8">userID</span><span class="sc7">=</span><span class="sc11">$(echo $id_value | cut -f2 -d"=")</span><span class="sc0">
    </span><span class="sc8">pgrp</span><span class="sc7">=</span><span class="sc11">$(echo $pgrp_value | cut -f2 -d"=")</span><span class="sc0">
    </span><span class="sc8">oldHomeDir</span><span class="sc7">=</span><span class="sc11">$(echo $home_value | cut -f2 -d"=")</span><span class="sc0">
    
    </span><span class="sc8">gecos_modify</span><span class="sc7">=</span><span class="sc10">${gecos_value//' '/,}</span><span class="sc0">              </span><span class="sc2"># erase space</span><span class="sc0">
    </span><span class="sc8">gecos_modify_left</span><span class="sc7">=</span><span class="sc10">${gecos_modify//'('/'\\('}</span><span class="sc0">            </span><span class="sc2"># modify brace</span><span class="sc0">
    </span><span class="sc8">gecos_modify_right</span><span class="sc7">=</span><span class="sc10">${gecos_modify_left//')'/'\\)'}</span><span class="sc0">
        
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ge</span><span class="sc0"> </span><span class="sc3">3001</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">3001</span><span class="sc0">
        </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">5000</span><span class="sc0">
        </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">"/appuser"</span><span class="sc0">
        </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">"/appuser/alliance/alluser.profile"</span><span class="sc0">
    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$userID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ge</span><span class="sc0"> </span><span class="sc3">2501</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">2501</span><span class="sc0">
        </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">2600</span><span class="sc0">
        </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">"/appuser"</span><span class="sc0">
        </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">"/appuser/pep/alluser_pep.profile"</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">2401</span><span class="sc0">
        </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">2500</span><span class="sc0">
        </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">"/appuser"</span><span class="sc0">
        </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
        
    </span><span class="sc8">setID</span><span class="sc0">
    </span><span class="sc8">newID</span><span class="sc7">=</span><span class="sc9">$userID</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$newID</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$idEnd</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">208</span><span class="sc0">          </span><span class="sc2"># No Free User ID       </span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc8">newHomeDir</span><span class="sc7">=</span><span class="sc9">$appDir</span><span class="sc7">/</span><span class="sc9">$newName</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$newHomeDir</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">mv</span><span class="sc0"> </span><span class="sc9">$newHomeDir</span><span class="sc0"> </span><span class="sc9">$newHomeDir</span><span class="sc7">.</span><span class="sc11">$(date +%y%m%d%M%S)</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">cp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Rh</span><span class="sc0"> </span><span class="sc9">$oldHomeDir</span><span class="sc0"> </span><span class="sc9">$newHomeDir</span><span class="sc0">
    
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">mkuser</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">id</span><span class="sc7">=</span><span class="sc9">$newID</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$pgrp_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$groups_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc8">home</span><span class="sc7">=</span><span class="sc9">$newHomeDir</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$shell_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$gecos_modify_right</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$su_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$rlogin_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$daemon_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$admin_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$sugroups_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$admgroups_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$tpath_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$ttys_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$expires_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$auth1_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$auth2_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$umask_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$registry_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$SYSTEM_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$logintimes_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$loginretries_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$pwdwarntime_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$account_locked_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minage_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$maxage_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$maxexpired_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minalpha_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minloweralpha_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minupperalpha_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minother_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$mindigit_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minspecialchar_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$mindiff_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$maxrepeats_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$minlen_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$histexpire_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$histsize_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$pwdchecks_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$dictionlist_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$default_roles_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$fsize_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$cpu_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$data_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$stack_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$core_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$rss_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$nofiles_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$time_last_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$time_last_unsuccessful_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$tty_last_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$tty_last_unsuccessful_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$host_last_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$host_last_unsuccessful_login_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$unsuccessful_login_count_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$roles_value</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc9">$newName</span><span class="sc0">

    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">chown</span><span class="sc0"> </span><span class="sc8">-R</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc7">:</span><span class="sc9">$pgrp</span><span class="sc0"> </span><span class="sc9">$newHomeDir</span><span class="sc0">
    
    </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc9">$newName</span><span class="sc0">
    </span><span class="sc8">setPasswd</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Rename_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">checkName</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
    </span><span class="sc8">returnCode</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$returnCode</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc2"># rename user name</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">usermod</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$newName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Delete_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">rmuser</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> 

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Enable_Disable_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$lockStatus</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"false"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">chuser</span><span class="sc0"> </span><span class="sc8">account_locked</span><span class="sc7">=</span><span class="sc8">true</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> 
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">chuser</span><span class="sc0"> </span><span class="sc8">account_locked</span><span class="sc7">=</span><span class="sc8">false</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0"> 
    </span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">  
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Change_User_Location</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">lowercase_Comment</span><span class="sc7">=</span><span class="sc5">"${office//"</span><span class="sc0"> </span><span class="sc5">"/,}\(${fullName//"</span><span class="sc0"> </span><span class="sc5">"/,}\)"</span><span class="sc0">
    </span><span class="sc8">comment</span><span class="sc7">=</span><span class="sc11">$(echo $lowercase_Comment|tr a-z A-Z)</span><span class="sc0">
    
    </span><span class="sc2"># Change User Location</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">usermod</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc9">$comment</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Reset_User_Passwd</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"echo $userName:$newPasswd | chpasswd"</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">Unlock_User</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">sudo</span><span class="sc0"> </span><span class="sc8">su</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">chuser</span><span class="sc0"> </span><span class="sc8">unsuccessful_login_count</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">

</span><span class="sc8">returnCodeMessage</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc9">$userName</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">displayMenu</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc9">$passwordFile</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">:</span><span class="sc8">AllianceProductionControl</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">80</span><span class="sc0">   </span><span class="sc2">#Production Control Menu</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">81</span><span class="sc0">   </span><span class="sc2">#User Support Menu</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#######################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  File name   : menu.ksh</span><span class="sc0">
</span><span class="sc2">#  Author      : Terry Ward, Liru Chen</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Description : A menu driven shell script </span><span class="sc0">
</span><span class="sc2">#  USAGE       : </span><span class="sc0">
</span><span class="sc2">#  Date        : 2015-04-10</span><span class="sc0">
</span><span class="sc2">#                </span><span class="sc0">
</span><span class="sc2">########################################################################################</span><span class="sc0">
</span><span class="sc8">aix_menu</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc2"># ----------------------------------</span><span class="sc0">
</span><span class="sc2"># Step #1: Define variables</span><span class="sc0">
</span><span class="sc2"># ----------------------------------</span><span class="sc0">
</span><span class="sc2">#Set environment</span><span class="sc0">
</span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">profile</span><span class="sc0"> 
</span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">~/.</span><span class="sc8">profile</span><span class="sc0">
</span><span class="sc8">userDate</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">

</span><span class="sc4">stty</span><span class="sc0"> </span><span class="sc8">erase</span><span class="sc0"> </span><span class="sc7">^</span><span class="sc8">H</span><span class="sc0">

</span><span class="sc8">PATH</span><span class="sc7">=</span><span class="sc9">$PATH</span><span class="sc7">:/</span><span class="sc8">alliance</span><span class="sc7">/</span><span class="sc8">RUNTIME</span><span class="sc7">/</span><span class="sc8">LIVOPER</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">PATH</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">TERM</span><span class="sc7">=</span><span class="sc8">vt100</span><span class="sc0">

</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">passwordFile</span><span class="sc7">=</span><span class="sc5">"/etc/passwd"</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">logPath</span><span class="sc7">=</span><span class="sc5">"/alliance/RUNTIME/LIVOPER/usislogs"</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">logFile</span><span class="sc7">=</span><span class="sc5">"$logPath/menu_${USER}_$userDate.LOG"</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">userFile</span><span class="sc7">=</span><span class="sc5">"$logPath/userFile_${USER}_$userDate.LOG"</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">newUserFile</span><span class="sc7">=</span><span class="sc5">"$logPath/newUserFile_${USER}_$userDate.LOG"</span><span class="sc0">

</span><span class="sc2">#Common User definition parameters</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">inputs</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">users</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">userName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">userNames</span><span class="sc7">=</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">wildCardUserName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">itemNumber</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">userType</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">newName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">newPasswd</span><span class="sc7">=</span><span class="sc5">"welcome"</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">idStart</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">idEnd</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">userID</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">office</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">fullName</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">appDir</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">primaryGroup</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">groups</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">shell</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">Profile</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">loginRetryTime</span><span class="sc7">=</span><span class="sc3">5</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">expireDate</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">passwdAge</span><span class="sc7">=</span><span class="sc3">4</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">passwdLength</span><span class="sc7">=</span><span class="sc3">8</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">passwdWarnDays</span><span class="sc7">=</span><span class="sc3">5</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">noPasswdReuseTime</span><span class="sc7">=</span><span class="sc3">12</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">noPasswdReuseNum</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">lockStatus</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">

</span><span class="sc2"># ----------------------------------</span><span class="sc0">
</span><span class="sc2"># Step #2: User defined function</span><span class="sc0">
</span><span class="sc2"># ----------------------------------</span><span class="sc0">
</span><span class="sc8">aix_muser</span><span class="sc0">

</span><span class="sc8">displayMenu</span><span class="sc0">
</span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">80</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
</span><span class="sc4">then</span><span class="sc0">
  </span><span class="sc8">productionControl</span><span class="sc0">
</span><span class="sc4">else</span><span class="sc0">
  </span><span class="sc8">userSupport</span><span class="sc0">
</span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc2"># ----------------------------------------------</span><span class="sc0">
</span><span class="sc2"># Step #3: Trap CTRL+C, CTRL+Z and quit singles</span><span class="sc0">
</span><span class="sc2"># ----------------------------------------------</span><span class="sc0">
</span><span class="sc4">trap</span><span class="sc0"> </span><span class="sc6">''</span><span class="sc0"> </span><span class="sc8">SIGINT</span><span class="sc0"> </span><span class="sc8">SIGQUIT</span><span class="sc0"> </span><span class="sc8">SIGTSTP</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># ------------------------------------</span><span class="sc0">
</span><span class="sc2"># Step #4: Main logic - infinite loop</span><span class="sc0">
</span><span class="sc2"># ------------------------------------</span><span class="sc0">
</span><span class="sc8">productionControl</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
</span><span class="sc4">do</span><span class="sc0">
 </span><span class="sc2">#reset everything whenever recycle</span><span class="sc0">
 </span><span class="sc8">resetAll</span><span class="sc0">

 </span><span class="sc8">productionControl_menus</span><span class="sc0">
 </span><span class="sc8">productionControl_options</span><span class="sc0">
</span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">
 
</span><span class="sc8">userSupport</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
</span><span class="sc4">do</span><span class="sc0">
 </span><span class="sc2">#reset everything whenever recycle</span><span class="sc0">
 </span><span class="sc8">resetAll</span><span class="sc0">

 </span><span class="sc8">userSupport_menus</span><span class="sc0">
 </span><span class="sc8">userSupport_options</span><span class="sc0">
</span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># #include &lt;stdio.h&gt;</span><span class="sc0">
</span><span class="sc2"># #include &lt;stdlib.h&gt;</span><span class="sc0">
</span><span class="sc2"># #include &lt;sys/types.h&gt;</span><span class="sc0">
</span><span class="sc2"># #include &lt;unistd.h&gt;</span><span class="sc0">

</span><span class="sc2"># int main()</span><span class="sc0">
</span><span class="sc2"># {</span><span class="sc0">
   </span><span class="sc2"># setuid( 0 );</span><span class="sc0">
   </span><span class="sc2"># system( "/alliance/RUNTIME/LIVOPER/menu.ksh" );</span><span class="sc0">

   </span><span class="sc2"># return 0;</span><span class="sc0">
</span><span class="sc2"># }</span><span class="sc0">

</span><span class="sc2">#Cfg2html is a UNIX shell script similar to supportconfig, getsysinfo or get_config, </span><span class="sc0">
</span><span class="sc2">#except that it creates a HTML (and plain ASCII) system documentation for </span><span class="sc0">
</span><span class="sc2">#HP-UX 10.xx/11.xx, Integrity Virtual Machine, SCO-UNIX, AIX, Sun OS and Linux systems. </span><span class="sc0">
</span><span class="sc2">#Plug-ins for SAP, Oracle, Informix, Serviceguard, Fiber Channel/SAN, TIP/ix, </span><span class="sc0">
</span><span class="sc2">#OpenText (IXOS/LEA), SAN Mass Storage like MAS, EMC, EVA, XPs, Network Node Manager</span><span class="sc0">
</span><span class="sc2">#and HP DataProtector etc. are included. </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#The first versions of cfg2html were written for HP-UX. Meanwhile the cfg2html </span><span class="sc0">
</span><span class="sc2">#HP-UX stream was ported to all major *NIX platforms, LINUX and small embedded systems. </span><span class="sc0">
</span><span class="sc2">#Some consider it to be the Swiss army knife for the Account Support Engineer, </span><span class="sc0">
</span><span class="sc2">#Customer Engineer, System Admin, Solution Architect etc. Originally developed to </span><span class="sc0">
</span><span class="sc2">#plan a system update, it was also found useful to perform basic troubleshooting </span><span class="sc0">
</span><span class="sc2">#or performance analysis. The production of nice HTML and plain ASCII documentation</span><span class="sc0">
</span><span class="sc2">#is part of its utility</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#download http://www.cfg2html.com/</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc8">aix_conf</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-f</span><span class="sc0"> </span><span class="sc9">$BIN</span><span class="sc7">/</span><span class="sc8">cfg2html_aix.sh</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc9">$BIN</span><span class="sc7">/</span><span class="sc8">cfg2html_aix.sh</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">uptime</span><span class="sc0">          </span><span class="sc2">#Shows how long the system has been up</span><span class="sc0">

    </span><span class="sc8">lparstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0">     </span><span class="sc2">#Display of current LPAR related parameters and Hypervisor information,</span><span class="sc0">
                    </span><span class="sc2">#as well as utilization statistics for the LPAR</span><span class="sc0">
    
    </span><span class="sc8">lsconf</span><span class="sc0">          </span><span class="sc2">#shows basic hardware and configuration details</span><span class="sc0">
    
    </span><span class="sc8">lscfg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vp</span><span class="sc0">       </span><span class="sc2">#Displays the name, location and description of each device found in the</span><span class="sc0">
                    </span><span class="sc2">#current Customized VPD object class that is a child device of the sys0 object</span><span class="sc0">

    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc2">#Displays attribute characteristics and possible values of attributes for devices in the system</span><span class="sc0">

    </span><span class="sc8">oslevel</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0">      </span><span class="sc2">#Reports the latest installed level (technology level, maintenance level and service pack) of the system</span><span class="sc0">

    </span><span class="sc8">lssrc</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0">        </span><span class="sc2">#Gets the status of a subsystem, a group of subsystems, or a subserver</span><span class="sc0">

    </span><span class="sc8">no</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0">           </span><span class="sc2">#Manages network tuning parameters</span><span class="sc0">

    </span><span class="sc8">netstat</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0">
    
    </span><span class="sc8">vmo</span><span class="sc0">             </span><span class="sc2">#Manages Virtual Memory Manager tunable parameters</span><span class="sc0">

    </span><span class="sc8">ioo</span><span class="sc0">             </span><span class="sc2">#Manages Input/Output tunable parameters</span><span class="sc0">

    </span><span class="sc8">ipcs</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0">         </span><span class="sc2">#Reports interprocess communication facility status</span><span class="sc0">

    </span><span class="sc8">vmstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0">       </span><span class="sc2">#Reports statistics about kernel threads, virtual memory, disks, </span><span class="sc0">
                    </span><span class="sc2">#hypervisor pages, traps and processor activity</span><span class="sc0">

    </span><span class="sc8">emgr</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">         </span><span class="sc2">#Starts the interim fix manager, which installs, removes, lists, </span><span class="sc0">
                    </span><span class="sc2">#and checks system interim fixes</span><span class="sc0">

    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">aix_lvm</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2">#Commands for LVM recovery and problem determination is very large,</span><span class="sc0">
    </span><span class="sc2">#including (in an approximate attempt to order the commands by depth of</span><span class="sc0">
    </span><span class="sc2">#enquiry into the internal structures of AIX):</span><span class="sc0">
    </span><span class="sc2"># errpt                     #Checking the errorlog</span><span class="sc0">
    </span><span class="sc2"># df                        #Checking free file system space</span><span class="sc0">
    
    </span><span class="sc2">#When the system is booted, the disk configurator looks at the PVID residing on</span><span class="sc0">
    </span><span class="sc2">#the disk and compares it with an entry in the ODM. If an entry is found, </span><span class="sc0">
    </span><span class="sc2">#then the disk is given the hdiskx number in the ODM that is associated with the PVID. </span><span class="sc0">
    </span><span class="sc2">#If there is no matching entry, then the next name in the pool of ’free’ hdisk names</span><span class="sc0">
    </span><span class="sc2">#is allocated to the physical volume.</span><span class="sc0">
    </span><span class="sc2"># /usr/sbin/lquerypv -H /dev/hdiskx</span><span class="sc0">
    </span><span class="sc2"># rmdev -dl &lt;hdiskx&gt;</span><span class="sc0">
    
    </span><span class="sc2">#The basic objects that will be created as part of the configuration or creation</span><span class="sc0">
    </span><span class="sc2"># cfgmgr                                                #Physical volume</span><span class="sc0">
    </span><span class="sc2"># mkvg -ft2 -y odmvg hdisk6 hdisk7 hdisk8 hdisk9        #Volume group</span><span class="sc0">
    </span><span class="sc2"># mklv -y simplelv odmvg 1                          #Simple logical volume</span><span class="sc0">
    </span><span class="sc2"># mklv -y mirrorlv -c 2 odmvg 1                     #Mirrored logical volume</span><span class="sc0">
    </span><span class="sc2"># mklv -y stripelv -S64k -u2 odmvg 2                    #triped logical volume</span><span class="sc0">
    </span><span class="sc2"># mklv -y mirrorstripelv -S64K -u2 -c2 odmvg 2      #Mirrored and striped logical volume </span><span class="sc0">
    
    </span><span class="sc2">#The high-level commands</span><span class="sc0">
    </span><span class="sc2"># lspv      #It will go to the physical volume with the VGDA containing the latest timestamp</span><span class="sc0">
    </span><span class="sc2"># lslv</span><span class="sc0">
    </span><span class="sc2"># lsvg      #show if the ODM knows about a volume group </span><span class="sc0">
    
    </span><span class="sc2"># lslpp                 #Checking fileset levels</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">bos.rte.lvm</span><span class="sc0">    </span><span class="sc2">#Check lvm fileset levels   </span><span class="sc0">
    
    </span><span class="sc2"># lsdev, lsattr -El     #Checking device availability</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Cc</span><span class="sc0"> </span><span class="sc8">disk</span><span class="sc0">          </span><span class="sc2">#if an hdisk is known and usable to the system</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Cc</span><span class="sc0"> </span><span class="sc8">pdisk</span><span class="sc0">         </span><span class="sc2">#or SSA pdisk   </span><span class="sc0">
    
    </span><span class="sc8">lspath</span><span class="sc0">                  </span><span class="sc2">#disks and adapter path</span><span class="sc0">
    </span><span class="sc8">mpio_get_config</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Av</span><span class="sc0">     </span><span class="sc2">#SAN disks</span><span class="sc0">
    
    </span><span class="sc2"># odmget                    #Checking the ODM </span><span class="sc0">
    </span><span class="sc2"># sh -xv, trclvm            #korn shell debug</span><span class="sc0">

    </span><span class="sc2">#The low-level VGDA interrogation commands</span><span class="sc0">
    </span><span class="sc2"># lqueryvg</span><span class="sc0">
    </span><span class="sc2"># lquerypv</span><span class="sc0">
    </span><span class="sc2"># lquerylv  </span><span class="sc0">
    
    </span><span class="sc2">#LVCB holds information such as the creation date of the logical volume, information </span><span class="sc0">
    </span><span class="sc2">#about mirrored copies, and possible mount points in a journaled file system, </span><span class="sc0">
    </span><span class="sc2">#if its overwritten, mostly by Database raw device, these values become undefined. </span><span class="sc0">
    </span><span class="sc2">#With the introduction of the big VGDA, a copy of the LVCB is now kept in the VGDA</span><span class="sc0">
    </span><span class="sc2">#</span><span class="sc0">
    </span><span class="sc2"># getlvcb, </span><span class="sc0">
    </span><span class="sc2"># getlvcb -AT &lt;lvname&gt;  </span><span class="sc0">
    </span><span class="sc2"># getlvodm</span><span class="sc0">
    
    </span><span class="sc2"># dd                        #Examining raw physical volumes, VGDAs, and logical volumes</span><span class="sc0">
    </span><span class="sc2"># crash, kdb                #Examining in-kernel memory structures: </span><span class="sc0">

    </span><span class="sc2">#VGDAs and VGSAs on the disk surfaces are correct while the ODM becomes incorrect</span><span class="sc0">
    </span><span class="sc2"># redefinevg                #To regain this basic ODM information</span><span class="sc0">
    </span><span class="sc2"># chvg -u &lt;vgname&gt;          #</span><span class="sc0">
    </span><span class="sc2"># chdev -a pv=clear  &lt;disk&gt; #reset hdisk’s PVID</span><span class="sc0">
    </span><span class="sc2"># exportvg</span><span class="sc0">
    </span><span class="sc2"># importvg </span><span class="sc0">
    </span><span class="sc2"># synclvodm     #restore the LVCB control information to the ODM</span><span class="sc0">
    
    </span><span class="sc2"># savebase      #update the mini-ODM that resides on the same disk as /dev/ipldevice</span><span class="sc0">
                    </span><span class="sc2">#Saves information about base-customized devices in the Device </span><span class="sc0">
                    </span><span class="sc2">#Configuration database onto the boot device, The savebase takes a </span><span class="sc0">
                    </span><span class="sc2">#snapshot of the main ODM and compresses it and picks out only </span><span class="sc0">
                    </span><span class="sc2">#what is needed for boot, such as LVM information concerning logical</span><span class="sc0">
                    </span><span class="sc2">#volumes in rootvg, and so on. It takes this compressed boot image </span><span class="sc0">
                    </span><span class="sc2">#and looks at /dev/ipldevice and finds out what disk this represents. </span><span class="sc0">
                    </span><span class="sc2">#Typically on most systems, /dev/ipldevice is a hard link to /dev/hdisk0</span><span class="sc0">

    </span><span class="sc2">#fuser -cx</span><span class="sc0">
    
    
    </span><span class="sc2">#Replaces a physical volume in a volume group with another physical volume.</span><span class="sc0">
    </span><span class="sc2">#Remove any LV on the failed disk, including any copies LV)</span><span class="sc0">
    </span><span class="sc2"># rmlv &lt;lvname&gt;</span><span class="sc0">
    </span><span class="sc2"># rmlvcopy &lt;lvname&gt; 1 &lt;faileddisk&gt;</span><span class="sc0">
    </span><span class="sc2"># reducevg</span><span class="sc0">
    </span><span class="sc2"># rmdev -dl &lt;faileddisk&gt;</span><span class="sc0">
    </span><span class="sc2"># cfgmgr</span><span class="sc0">
    </span><span class="sc2"># extendvg</span><span class="sc0">
    </span><span class="sc2"># mklv</span><span class="sc0">
    </span><span class="sc2"># mklvcopy</span><span class="sc0">
    </span><span class="sc2"># syncvg        #Synchronizes logical volume copies that are not current</span><span class="sc0">
    </span><span class="sc2">#   </span><span class="sc0">
    </span><span class="sc2">#The best way:</span><span class="sc0">
    </span><span class="sc2"># migratepv &lt;sourcedisk&gt; &lt;targetdisk&gt;       #if &lt;sourcedisk&gt; is readable</span><span class="sc0">
    </span><span class="sc2"># replacepv &lt;faileddisk&gt; &lt;newdisk&gt;</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#trclvm makes a temporary copy of an lvm high-level command and</span><span class="sc0">
</span><span class="sc2">#instruments it with set -xv lines so that all functions within the script produce</span><span class="sc0">
</span><span class="sc2">#debug output.</span><span class="sc0">
</span><span class="sc8">trclvm</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc7">--</span><span class="sc0"> </span><span class="sc11">`getopt tl: $*`</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc8">Usage</span><span class="sc7">:</span><span class="sc0"> </span><span class="sc8">trclvm</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">logfile</span><span class="sc0"> </span><span class="sc8">command</span><span class="sc0"> </span><span class="sc8">options</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">tFLAG</span><span class="sc7">=</span><span class="sc0">
    
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc7">--</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">case</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0">
            </span><span class="sc8">-t</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc8">tFLAG</span><span class="sc7">=</span><span class="sc6">'-t'</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">shift</span><span class="sc7">;;</span><span class="sc0">
            </span><span class="sc8">-l</span><span class="sc7">)</span><span class="sc0"> </span><span class="sc8">lFLAG</span><span class="sc7">=</span><span class="sc6">'-l'</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc8">lFILE</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">shift</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">shift</span><span class="sc7">;;</span><span class="sc0">
        </span><span class="sc4">esac</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc4">shift</span><span class="sc0">
    </span><span class="sc8">file</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">shift</span><span class="sc0">
    </span><span class="sc8">parms</span><span class="sc7">=</span><span class="sc9">$*</span><span class="sc0">

    </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc7">/</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc11">`whence $file`</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc7">/</span><span class="sc10">${file}</span><span class="sc8">_orig</span><span class="sc0">
    </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">tFLAG</span><span class="sc7">=</span><span class="sc9">$tFLAG</span><span class="sc0"> </span><span class="sc6">'{
        if ( tFLAG == "-t" ) {
            if ( $1 ~ /[Cc]leanup()/ ) {                    #we have entered cleanup
                cFLAG = "-c"
            }
        
            if ( cFLAG &amp;&amp; (($1=="rm")||(multi=="y")) ) {    #comment out rms, handle
            printf ("#")                                    #extended lines
            slash=substr($0, length($0))
                if (slash == "\\") {
                    multi = "y"
                } else {
                    multi = ""
                }
            }
            
            if ( $1 == "}" ) {                              # we have left cleanup
                cFLAG = ""
            }
        }
        
        print $0;
        if ( LP=="\(\)" &amp;&amp; $0 == "\{" ) {print "set -xv"}   #add debug line
        LP=substr($0,length($0)-1)
    
    }'</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc7">/</span><span class="sc10">${file}</span><span class="sc8">_orig</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc7">/</span><span class="sc9">$file</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc4">-n</span><span class="sc0"> </span><span class="sc5">"$lFLAG"</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">exec</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$lFILE</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">sh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xv</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc7">/</span><span class="sc9">$file</span><span class="sc0"> </span><span class="sc9">$parms</span><span class="sc0">
    </span><span class="sc8">rc</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">rf</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">lvmtrace</span><span class="sc9">$$</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$rc</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#checks the basic ODM classes relevant to the LVM for a particular string</span><span class="sc0">
</span><span class="sc8">findlvm</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">class</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc8">CuAt</span><span class="sc0"> </span><span class="sc8">CuDv</span><span class="sc0"> </span><span class="sc8">CuDep</span><span class="sc0"> </span><span class="sc8">CuDvDr</span><span class="sc0"> </span><span class="sc8">PdAt</span><span class="sc0"> </span><span class="sc8">PdDv</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc9">$class</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ip</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#&lt;Cluster&gt;: A logical grouping of servers running PowerHA.</span><span class="sc0">
</span><span class="sc2">#&lt;Node&gt;: An individual server within a cluster.</span><span class="sc0">
</span><span class="sc2">#&lt;Network&gt;: Although normally this term would refer to a larger area of computer-to-computer</span><span class="sc0">
</span><span class="sc2"># communication (such as a WAN), in PowerHA network refers to a logical definition of an </span><span class="sc0">
</span><span class="sc2"># area for communication between two servers. Within PowerHA, even SAN resources can be</span><span class="sc0">
</span><span class="sc2"># defined as a network.</span><span class="sc0">
</span><span class="sc2">#&lt;Boot IP&gt;: This is a default IP address a node uses when it is first activated and becomes</span><span class="sc0">
</span><span class="sc2"># available. Typically—and as used in this article—the boot IP is a non-routable IP</span><span class="sc0">
</span><span class="sc2"># address set up on an isolated VLAN accessible to all nodes in the cluster.</span><span class="sc0">
</span><span class="sc2">#&lt;Persistent IP&gt;: This is an IP address a node uses as its regular means of communication.</span><span class="sc0">
</span><span class="sc2"># Typically, this is the IP through which systems administrators access a node.</span><span class="sc0">
</span><span class="sc2">#&lt;Service IP&gt;: This is an IP address that can "float" between the nodes. Typically, this</span><span class="sc0">
</span><span class="sc2"># is the IP address through which users access resources in the cluster.</span><span class="sc0">
</span><span class="sc2">#&lt;Application server&gt;: This is a logical configuration to tell PowerHA how to manage</span><span class="sc0">
</span><span class="sc2"># applications, including starting and stopping applications, application monitoring,</span><span class="sc0">
</span><span class="sc2"># and application tunables. </span><span class="sc0">
</span><span class="sc2">#&lt;Shared volume group&gt;: This is a PowerHA-managed volume group. Instead of configuring</span><span class="sc0">
</span><span class="sc2"># LVM structures like volume groups, logical volumes, and file systems through the</span><span class="sc0">
</span><span class="sc2"># operating system, you must use PowerHA for disk resources that will be shared between</span><span class="sc0">
</span><span class="sc2"># the servers.</span><span class="sc0">
</span><span class="sc2">#&lt;Resource group&gt;: This is a logical grouping of service IP addresses, application servers,</span><span class="sc0">
</span><span class="sc2"># and shared volume groups that the nodes in the cluster can manage.</span><span class="sc0">
</span><span class="sc2">#&lt;Failover&gt;: This is a condition in which resource groups are moved from one node to another.</span><span class="sc0">
</span><span class="sc2"># Failover can occur when a systems administrator instructs the nodes in the cluster to</span><span class="sc0">
</span><span class="sc2"># do so or when circumstances like a catastrophic application or server failure forces</span><span class="sc0">
</span><span class="sc2"># the resource groups to move.</span><span class="sc0">
</span><span class="sc2">#&lt;Failback/fallback&gt;: This is the action of moving back resource groups to the nodes on</span><span class="sc0">
</span><span class="sc2"># which they were originally running after a failover has occurred.</span><span class="sc0">
</span><span class="sc2">#&lt;Heartbeat&gt;: This is a signal transmitted over PowerHA networks to check and confirm</span><span class="sc0">
</span><span class="sc2"># resource availability. If the heartbeat is interrupted, the cluster may initiate a</span><span class="sc0">
</span><span class="sc2"># failover depending on the configuration</span><span class="sc0">

</span><span class="sc2">##########################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Datagather.sh     Version 1.3</span><span class="sc0">
</span><span class="sc2"># Last Modified - March, 2010 - S. Bodily</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">##########################################################################</span><span class="sc0">
</span><span class="sc8">aix_hacmp</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">

    </span><span class="sc8">PATH</span><span class="sc7">=/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">bin</span><span class="sc7">:/</span><span class="sc8">etc</span><span class="sc7">:/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">:/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">utilities</span><span class="sc7">:/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">diag</span><span class="sc7">:/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc0">

    </span><span class="sc8">node</span><span class="sc7">=</span><span class="sc11">$(hostname)</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Gathering requested AIX info..."</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.*</span><span class="sc0">

    </span><span class="sc2"># Set Variables</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">dumpreq</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">ppsize</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">var1</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">var2</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">var3</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">var4</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Report Created on:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">date</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"**********GENERAL INFORMATION*******************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">cllscf</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">Cluster</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Node Names: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">clnodename</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Local Machine Type:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">model</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Running AIX Version:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">oslevel</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Running HACMP Version:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">cluster.es.server.rte</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"**********CPUGUARD*******************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">cpuguard</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"**********Restart after Crash***********"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">autorestart</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************ROOTVG SECTION*****************************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">rootvg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc8">rootvg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Location of Boot Logical Volume: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslv</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc8">hd5</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Normal Bootlist"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">bootlist</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc8">normal</span><span class="sc0"> </span><span class="sc8">-o</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Check for Bootable Devices: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">ipl_varyon</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************Dump Info****************************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">sysdumpdev</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">ppsize</span><span class="sc7">=</span><span class="sc11">`lsvg rootvg | grep 'PP SIZE' | awk '{print $6}'`</span><span class="sc0">
    </span><span class="sc8">pps1</span><span class="sc7">=</span><span class="sc11">`sysdumpdev -l | grep 'primary' | awk '{print $2}'`</span><span class="sc0">
    </span><span class="sc8">dumplv1</span><span class="sc7">=</span><span class="sc10">${pps1##*/}</span><span class="sc0">

    </span><span class="sc2"># echo "dumplv1=" $dumplv1  # Display Primary Dump Device</span><span class="sc0">
    </span><span class="sc2">#size1=`odmget -q "name=$dumplv1 and attribute=size" CuAt | grep value | awk '{print $3}' | cut -d "\"" -f 2`</span><span class="sc0">
    </span><span class="sc8">size1</span><span class="sc7">=</span><span class="sc11">`lsvg -l rootvg|grep ${dumplv1}|awk '{print $4}'`</span><span class="sc0">
    </span><span class="sc2"># echo "size1=" $size1  # Display Size of Primary Dump Device </span><span class="sc0">
    </span><span class="sc2"># echo $dumplv2</span><span class="sc0">
    </span><span class="sc8">pps2</span><span class="sc7">=</span><span class="sc11">`sysdumpdev -l | grep 'secondary' | awk '{print $2}'`</span><span class="sc0">

    </span><span class="sc8">dumplv2</span><span class="sc7">=</span><span class="sc10">${pps2##*/}</span><span class="sc0">
    </span><span class="sc8">size2</span><span class="sc7">=</span><span class="sc11">`lsvg -l rootvg|grep ${dumplv2}|awk '{print $4}'`</span><span class="sc0">
    </span><span class="sc2"># echo "dumplv2=" $dumplv2   # Display Secondary Dump Device</span><span class="sc0">
    </span><span class="sc2"># size2=`odmget -q "name$dumplv2 and attribute=size" CuAt | grep value | awk '{print $3}' | cut -d "\"" -f 2`</span><span class="sc0">
    </span><span class="sc2"># echo "size2=" $size2   # Display Size of Secondary Dump Device</span><span class="sc0">
    </span><span class="sc2"># echo "pps1=" $pps1</span><span class="sc0">
    </span><span class="sc2"># echo "pps2=" $pps2</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$ppsize</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$size1</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$size2</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">var3</span><span class="sc7">=$((</span><span class="sc9">$ppsize</span><span class="sc7">*</span><span class="sc9">$size1</span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc8">var4</span><span class="sc7">=$((</span><span class="sc9">$ppsize</span><span class="sc7">*</span><span class="sc9">$size2</span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc2">#if [[ $dumplv2 != sysdumpnull ]];then</span><span class="sc0">
    </span><span class="sc2">#     var4=$(($ppsize*$size2))  # Calculate Secondary Dump Device Name</span><span class="sc0">
    </span><span class="sc2">#else</span><span class="sc0">
    </span><span class="sc2">#    echo "Note: Secondary Dump Device is not Configured!"</span><span class="sc0">
    </span><span class="sc2">#fi</span><span class="sc0">
    </span><span class="sc2"># echo "var3=" $var3   # Primary Dump PPs x PP Size</span><span class="sc0">
    </span><span class="sc2"># echo "var4=" $var4   # Secondary Dump PPs x PP Size</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc2"># echo "Physical Partition Size:"  $ppsize | tee -a ${TMP}/$node.aixinfo </span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">sysdumpdev</span><span class="sc0"> </span><span class="sc8">-e</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">dumpreq</span><span class="sc7">=</span><span class="sc11">`sysdumpdev -e | awk '{print $7}'`</span><span class="sc0">

    </span><span class="sc4">let</span><span class="sc0"> </span><span class="sc8">var1</span><span class="sc7">=</span><span class="sc9">$dumpreq</span><span class="sc7">/</span><span class="sc3">1024</span><span class="sc0">
    </span><span class="sc4">let</span><span class="sc0"> </span><span class="sc8">var2</span><span class="sc7">=</span><span class="sc9">$var1</span><span class="sc7">/</span><span class="sc3">1024</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Estimated Dump Size in MB:"</span><span class="sc0"> </span><span class="sc9">$var2</span><span class="sc0"> </span><span class="sc5">"Primary Size:"</span><span class="sc0"> </span><span class="sc9">$var3</span><span class="sc0"> </span><span class="sc5">"Secondary Size:"</span><span class="sc0"> </span><span class="sc9">$var4</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************SYSTEM TUNABLES*****************************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">syncd</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">rc.boot</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"High &amp; Low Watermark Settings"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">maxpout</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">minpout</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">lsattr</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">El</span><span class="sc0"> </span><span class="sc8">sys0</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">cpuguard</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Check for FC Tunable Attributes:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">CuAt</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">dyntrk</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">CuAt</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">fc_err_recov</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"HACMP Custom Events Configured: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPcustom</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Application Monitors Configured:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPmonitor</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************SYSTEM STORAGE***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"List of Disks: (lsdev -Cc disk)"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Cc</span><span class="sc0"> </span><span class="sc8">disk</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"LUN PVIDs on system: (lspv)"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lspv</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"List of HBAs Configured: (lsdev -Cc adapter)"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Cc</span><span class="sc0"> </span><span class="sc8">adapter</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">fcs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lscfg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vl</span><span class="sc0"> </span><span class="sc8">fcs0</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lscfg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vl</span><span class="sc0"> </span><span class="sc8">fcs1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lscfg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vl</span><span class="sc0"> </span><span class="sc8">fcs2</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lscfg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vl</span><span class="sc0"> </span><span class="sc8">fcs3</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"System Filesystem List: (lsfs)"</span><span class="sc0">
    </span><span class="sc8">lsfs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"List of configured Virtual Devices: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc8">-C</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">virtual</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"List of ECM Requirements:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">bos.clvm.enh</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">bos.rte.lvm</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Multipathing Driver/s Configured:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc8">sdd</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc8">ibm2105</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">devices.fcp.disk.ibm.mpio</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc8">power</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc8">devices.fcp.disk.array</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************CLUSTER TOPOLOGY***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">cllsif</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">cllsif</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Captured cllsif file... "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Network Failure Detection Rates:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc7">=</span><span class="sc8">ether</span><span class="sc0"> </span><span class="sc8">HACMPnim</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc7">=</span><span class="sc8">rs232</span><span class="sc0"> </span><span class="sc8">HACMPnim</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">q</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc7">=</span><span class="sc8">diskhb</span><span class="sc0"> </span><span class="sc8">HACMPnim</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"RSCT Status of HACMP Networks:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"lssrc -ls topsvcs"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lssrc</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ls</span><span class="sc0"> </span><span class="sc8">topsvcs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Network Interfaces on System:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lsdev</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Cc</span><span class="sc0"> </span><span class="sc8">adapter</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">tty</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">netstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">in</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Adapter Media Speed &amp; Link Status Settings: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">netstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">Media</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">netstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">Link</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">netstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">rn</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">routetable</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Routing Table file captured ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Netmask &amp; Interface Status: "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">ifconfig</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************CLUSTER RESOURCE GROUPS***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">clgetgrp</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">clshowres</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">clshowres</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Clshowres Ouput file captured ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Application Servers Configured:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPserver</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Resource Group Processing Order:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPgroup</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"RG Dependencies Configured::"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPrgdependency</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPrg_loc_dependency</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"RG Delayed Fallback Timer Configured:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPtimer</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"HACMP File Collections Configured:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPfilecollection</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************CLUSTER STATUS***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">cltopinfo</span><span class="sc0">
    </span><span class="sc8">clshowsrv</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">clRGinfo</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************ADDITIONAL TROUBLESHOOTING***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">emgr</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">errpt</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">errpt</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Detailed errpt file written to .errpt file ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">wamu</span><span class="sc7">/</span><span class="sc8">var</span><span class="sc7">/</span><span class="sc8">log</span><span class="sc7">/</span><span class="sc8">hacmp</span><span class="sc7">/</span><span class="sc8">clverify.log</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">clverify</span><span class="sc0">
    </span><span class="sc2">#cp /var/hacmp/clverify/clverify.log ${TMP}/$node.clverify</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"clverify.log file captured ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"*************HACMP &amp; RSCT Fileset Levels***********************"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-h</span><span class="sc0"> </span><span class="sc5">"cluster.*"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">hafileset</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"HACMP fileset levels written to *.hafileset file ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-h</span><span class="sc0"> </span><span class="sc5">"rsct.*"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">hafileset</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"RSCT fileset levels written to *.hafileset file ..."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc2"># Capture of HACMP Object Classes</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPadapter</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPcluster</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPcustom</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPdaemons</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPdisksubsys</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPdisktype</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPevent</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPfcfile</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPgroup</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPlogs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPmonitor</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPnetwork</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPnim</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPnode</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPpprc</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPresource</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPrgdependency</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPrules</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPserver</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPsite</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPsvc</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPsvcpprc</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPsvcrelationship</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPtimersvc</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc8">odmget</span><span class="sc0"> </span><span class="sc8">HACMPtopsvcs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Capturing AIX filesets"</span><span class="sc0">
    </span><span class="sc8">lslpp</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixfilesets</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Capturing hosts files"</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">hosts</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">hosts</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">rhosts</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">rhosts</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Creating Cluster Snapshot...."</span><span class="sc0"> 
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">snapshots</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">info</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">snapshots</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">odm</span><span class="sc0">
    </span><span class="sc8">clsnapshot</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc9">$node</span><span class="sc0"> 
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">6</span><span class="sc0">

    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">es</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">cluster</span><span class="sc7">/</span><span class="sc8">snapshots</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">info</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">snapshot</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Gathering LVM Snap Information...."</span><span class="sc0"> 
    </span><span class="sc8">snap</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0">
    </span><span class="sc2">#cp ${TMP}/ibmsupt/lvm/lvm.snap ${TMP}/$node.lvm.snap</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">ibmsupt</span><span class="sc7">/</span><span class="sc8">lvm</span><span class="sc7">/*.</span><span class="sc8">snap</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">ibmsupt</span><span class="sc7">/</span><span class="sc8">lvm</span><span class="sc7">/</span><span class="sc8">allvgs.snap</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">ibmsupt</span><span class="sc7">/</span><span class="sc8">lvm</span><span class="sc7">/</span><span class="sc8">allvgs.snap</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">lvm.snap</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Creating tar file of requested data..."</span><span class="sc0">
    </span><span class="sc4">tar</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">cvf</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.*</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Creating compressed file"</span><span class="sc0">
    </span><span class="sc4">compress</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">tar</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Cleaning up temporary files created from snap data..."</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixfilesets</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">hafileset</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">cllsif</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">routetable</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">clshowres</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">clverify</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">errpt</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">aixinfo</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">haodm</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">hosts</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">rhosts</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">lvm.snap</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc8">ibmsupt</span><span class="sc7">/</span><span class="sc8">lvm</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">snapshot</span><span class="sc0">
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Cleanup Done..."</span><span class="sc0">
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc9">$node</span><span class="sc5">".tar.gz created ...."</span><span class="sc0">
    
    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0">  </span><span class="sc5">"$(hostname)_HACMP_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc9">$node</span><span class="sc7">.</span><span class="sc8">tar.Z</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:     aix_mksysbk</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  AIX Operation system backup using mksysb.</span><span class="sc0">
</span><span class="sc2"># The tape format includes a boot image, a bosinstall image, and an empty table</span><span class="sc0">
</span><span class="sc2"># of contents followed by the system backup (root volume group) image. </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># The root volume group image is in backup-file format, starting with the data </span><span class="sc0">
</span><span class="sc2"># files and then any optional map files</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Date            Name            Description   </span><span class="sc0">
</span><span class="sc2">#   -------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   2012-12-13  Liru Chen   Modified due to cm07 quarterly backup</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">####################################################################################</span><span class="sc0">
</span><span class="sc8">aix_mksysb</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc8">root</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">aix_conf</span><span class="sc0">

    </span><span class="sc2">#mksysb Backup operating system (that is, the root volume group)</span><span class="sc0">
    </span><span class="sc2"># -e: Excludes files listed in the /etc/exclude.rootvg file from being backed up</span><span class="sc0">
    </span><span class="sc2"># -i: Generates the /image.data file,which contains details about volume groups,</span><span class="sc0">
    </span><span class="sc2">#     logical volumes, file systems, paging space, and physical volumes</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Backup Operation System (rootvg)..."</span><span class="sc0">

    </span><span class="sc8">mksysb_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">mksysb_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_MKSYSB_</span><span class="sc10">${mksysb_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">mksysb_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">mksysb_excludefs</span><span class="sc7">=</span><span class="sc10">${mksysb_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc7">.</span><span class="sc8">mksysb_excludefs</span><span class="sc0">
    
    </span><span class="sc8">mksysb_image</span><span class="sc7">=</span><span class="sc10">${BKUPOSIMG:="/dev/rmt0"}</span><span class="sc0">

    </span><span class="sc2"># If backup device is tape driver, load/rewind tape volume</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${mksysb_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${mksysb_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
        </span><span class="sc8">mksysb_target</span><span class="sc7">=</span><span class="sc10">${mksysb_image}</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">    </span><span class="sc2">#if backup to local disk, keep only one copy of mksysb</span><span class="sc0">
        </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${mksysb_dir}</span><span class="sc7">/</span><span class="sc10">${mksysb_image}</span><span class="sc8">_</span><span class="sc7">*</span><span class="sc0">
        </span><span class="sc8">mksysb_target</span><span class="sc7">=</span><span class="sc10">${mksysb_dir}</span><span class="sc7">/</span><span class="sc10">${mksysb_image}</span><span class="sc8">_</span><span class="sc10">${mksysb_date}</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc2">#-e Excludes files listed in the /etc/exclude.rootvg file from being backed up. </span><span class="sc0">
    </span><span class="sc2">#   The rules for exclusion follow the pattern matching rules of the grep command</span><span class="sc0">

    </span><span class="sc2">#-i Calls the mkszfile command, which generates the /image.data file. </span><span class="sc0">
    </span><span class="sc2">#   The /image.data file contains details about volume groups, logical volumes, </span><span class="sc0">
    </span><span class="sc2">#   file systems, paging space, and physical volumes. This information is included</span><span class="sc0">
    </span><span class="sc2">#   in the backup for future use by the installation process.</span><span class="sc0">

    </span><span class="sc2">#-x file Excludes the file systems that are listed in the file from the system backup.</span><span class="sc0">
    </span><span class="sc2">#   File system mount points must be listed one per line.</span><span class="sc0">
            
    </span><span class="sc8">mksysb</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">-x</span><span class="sc0"> </span><span class="sc10">${mksysb_excludefs}</span><span class="sc0"> </span><span class="sc8">-e</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0">  </span><span class="sc5">"&lt;error = $?&gt; error on mksysb command:"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) mksysb failed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
        
        </span><span class="sc2">#offline tape if backup device is tape driver</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#list all the files if medium is tape</span><span class="sc0">
    </span><span class="sc8">mksysb_content</span><span class="sc7">=</span><span class="sc10">${mksysb_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_mksysb_content</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Listing of the root volume group "</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_content}</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Error in rewinding the tape on $os_image "</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t &lt;error code = $? &gt; "</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Tape Rewind on $os_image failed after System backup"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

        </span><span class="sc2">#The tape format includes a boot image, a bosinstall image, and an empty </span><span class="sc0">
        </span><span class="sc2">#table of contents followed by the system backup (root volume group) image, </span><span class="sc0">
        </span><span class="sc2">#use "-Tqs4" to get mksysb content on tape</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Tvqs4</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc7">.</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_content}</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"&lt;error = $? &gt; error on reading mksysb content on tape"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"List System Backup failed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">209</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc2">#The file-system image is in backup-file format. </span><span class="sc0">
        </span><span class="sc2">#This file will not be bootable and can only be installed</span><span class="sc0">
        </span><span class="sc2">#using Network Installation Management (NIM).</span><span class="sc0">
         </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Tvq</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${mksysb_target}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_content}</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">
         </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
         </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"&lt;error = $? &gt; error on reading filesystem image"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"LIST SYSTEM BACKUP FAILED"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${mksysb_log}</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">210</span><span class="sc0">
         </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_MKSYSB_COMPLETED"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${mksysb_dir}</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc8">_mksysb_content</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:         aix_backup</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  Backup AIX file systems on specific Volume Group(s) </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># AIX command used to backup entire file system backed up by i-node </span><span class="sc0">
</span><span class="sc2"># using the Level and FileSystem parameters:</span><span class="sc0">
</span><span class="sc2"># backup -0 -uf /dev/rmt0.1 filesystem </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># 1. All file systems on listed volume groups will be backup on one single tape</span><span class="sc0">
</span><span class="sc2"># 2. Exclude the file systems which need not backup in file:</span><span class="sc0">
</span><span class="sc2">#    ${TMP}/$(hostname)_backup_exclude</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Date        Name        Description </span><span class="sc0">
</span><span class="sc2">#   ---------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   2013-3-30   Liru Chen   Original, prepared for cm07</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc8">aix_backup</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc8">root</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">backup_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">backup_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_BACKUP_</span><span class="sc10">${backup_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">backup_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">backup_image</span><span class="sc7">=</span><span class="sc10">${BKUPFSIMG:="/dev/rmt0"}</span><span class="sc0">
    
    </span><span class="sc8">backup_doc</span><span class="sc7">=</span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_STORAGE_DOC</span><span class="sc0">
    </span><span class="sc8">backup_exclude</span><span class="sc7">=</span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_backup_exclude</span><span class="sc0">
    </span><span class="sc8">backup_content</span><span class="sc7">=</span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_backup_content</span><span class="sc0">

    </span><span class="sc2">#backup level</span><span class="sc0">
    </span><span class="sc8">backup_level</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
    
    </span><span class="sc2">#Collect Filesystem information on specific volume group</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"BACKUP DEVICE:\t${backup_image}"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc10">${backup_doc}</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">backup_vg</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$VG</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">backup_vgname</span><span class="sc7">=</span><span class="sc11">$(echo "${backup_vg}@"|cut -f1 -d"@")</span><span class="sc0">
        
        </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc10">${backup_vgname}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${backup_doc}</span><span class="sc7">.</span><span class="sc10">${backup_vgname}</span><span class="sc0">
        </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc10">${backup_vgname}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${backup_doc}</span><span class="sc7">.</span><span class="sc10">${backup_vgname}</span><span class="sc0">
        </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${backup_vgname}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${backup_doc}</span><span class="sc7">.</span><span class="sc10">${backup_vgname}</span><span class="sc0">
        
        </span><span class="sc2">#Get filesystems needed to be backed up listed in this VG</span><span class="sc0">
        </span><span class="sc8">backup_filesystem</span><span class="sc7">=</span><span class="sc11">$(grep jfs ${backup_doc}.${backup_vgname} |
        grep -v -f ${backup_exclude} | grep -v 'N/A' | awk '{print $7}')</span><span class="sc0">

        </span><span class="sc2">#log the archive backup_filesystems</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"BACKUP FILESYSTEM LISTING: ${backup_filesystem}"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
         
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------------"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"BACKUP LEVEL: ${backup_level} "</span><span class="sc0">         </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"BACKUP DATE : $(date)"</span><span class="sc0">                  </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------------------------"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

        </span><span class="sc2">#Get number of backup_filesystem in the string "backup_filesystem"</span><span class="sc0">
        </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc10">${backup_filesystem}</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">fsCount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">

        </span><span class="sc2">#Backup the backup_filesystems sequentially</span><span class="sc0">
        
        </span><span class="sc2">#For Tape device: the &lt;iCount&gt; number identify file marks specified</span><span class="sc0">
        </span><span class="sc2">#Count parameter and positions it on the end-of-tape (EOT) side of the file mark.</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">iCount</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">

        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc9">$iCount</span><span class="sc0"> </span><span class="sc7">&lt;=</span><span class="sc0"> </span><span class="sc9">$fsCount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Backing up backup_filesystem: $1 $iCount"</span><span class="sc0">   </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_doc}</span><span class="sc0">
            </span><span class="sc4">sync</span><span class="sc0">
            </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">backup_target</span><span class="sc7">=</span><span class="sc10">${backup_image}</span><span class="sc7">.</span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc8">ext</span><span class="sc7">=</span><span class="sc11">$( echo $1 | tr / _ )</span><span class="sc0">
                </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc10">${backup_image}</span><span class="sc9">$ext</span><span class="sc7">.</span><span class="sc9">$iCount</span><span class="sc0">
                </span><span class="sc8">backup_target</span><span class="sc7">=</span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc10">${backup_image}</span><span class="sc9">$ext</span><span class="sc7">.</span><span class="sc9">$iCount</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc8">backup</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc10">${backup_level}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">uf</span><span class="sc0"> </span><span class="sc10">${backup_target}</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">    
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"&lt; error = $? &gt;error on backing up backup_filesystem: $1"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0">  </span><span class="sc10">${backup_log}</span><span class="sc0">
                
                </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"File system $1 backup failed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
                </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">209</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$1\tBACKUP SeqNumber\t$iCount"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

            </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc8">iCount</span><span class="sc7">=</span><span class="sc8">iCount+1</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

        </span><span class="sc2">#List all the backup contents</span><span class="sc0">
        </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc10">${backup_filesystem}</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">fsCount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">xCount</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">

        </span><span class="sc2"># Rewind tape if use tape drive to backup</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t Error in rewinding the tape on ${backup_image}  "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
                
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t &lt;error code = $? &gt; "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

                </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Tape Rewind on ${backup_image}  failed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                         </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
                </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc9">$xCount</span><span class="sc0"> </span><span class="sc7">&lt;=</span><span class="sc0"> </span><span class="sc9">$fsCount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n-----------------------------------------"</span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Filesystem: $1 Backup_Sequence: $xCount"</span><span class="sc0">    </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"-----------------------------------------"</span><span class="sc0">  </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">s1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Tqvf</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc7">.</span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_content}</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">    
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"&lt;error = $? &gt; error on reading backup_filesystem: $1"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">  

                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Dumping the contents of error file:"</span><span class="sc7">|</span><span class="sc0">
                    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

                    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"List File System $1 backup failed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc10">${backup_log}</span><span class="sc0"> 
                    </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">
                    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">209</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc8">ext</span><span class="sc7">=</span><span class="sc11">$( echo $1 | tr / _ )</span><span class="sc0">
                </span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Tqvf</span><span class="sc0"> </span><span class="sc10">${backup_dir}</span><span class="sc7">/</span><span class="sc10">${backup_image}</span><span class="sc9">$ext</span><span class="sc7">.</span><span class="sc9">$xCount</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_content}</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"&lt;error = $?&gt; error on reading backup_filesystem: $1"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Dumping the contents of error file"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
                    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">

                    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"List File System $1 backup failed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${backup_log}</span><span class="sc0">
                    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">209</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">

            </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc8">xCount</span><span class="sc7">=</span><span class="sc8">xCount+1</span><span class="sc0">

        </span><span class="sc4">done</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"/etc/dumpdates at the close of this backup:"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_content}</span><span class="sc0">

    </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">dumpdates</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_content}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"BACKUP task has been completed"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${backup_content}</span><span class="sc0">

    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0">

    </span><span class="sc2"># dismount the tape</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${backup_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${backup_image}</span><span class="sc0"> </span><span class="sc8">offline</span><span class="sc0">

    </span><span class="sc2">#Mail to Administrator</span><span class="sc0">
    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"FILE_SYSTEMS_BACKUP_COMPLETED"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${backup_dir}</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc8">_backup_content</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Provide the vg name, and hdisks which will be included, the vg parameters</span><span class="sc0">
</span><span class="sc2">#will be read from vg document $(hostname)_STORAGE_DOC.$vgname</span><span class="sc0">
</span><span class="sc8">aix_crvg</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">crvg_vgname</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">crvg_hdisks</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    
    </span><span class="sc8">crvg_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">crvg_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_CRVG_</span><span class="sc10">${crvg_vgname}</span><span class="sc8">_</span><span class="sc10">${crvg_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">crvg_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">crvg_doc</span><span class="sc7">=</span><span class="sc10">${crvg_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_STORAGE_DOC</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${crvg_doc}</span><span class="sc7">.</span><span class="sc10">${crvg_vgname}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"VG $vgname BACKUP not Document"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc8">ppsize</span><span class="sc7">=</span><span class="sc11">$(grep "PP SIZE" ${crvg_doc}.${crvg_vgname} | awk '{print $6}')</span><span class="sc0">

    </span><span class="sc2">#Create Volume Group dbvg if no there</span><span class="sc0">
    </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">mkvg</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc9">$ppsize</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0"> </span><span class="sc10">${crvg_vgname}</span><span class="sc0"> </span><span class="sc10">${crvg_hdisks}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${crvg_log}</span><span class="sc0">

    </span><span class="sc2">#Create log Logic Volume</span><span class="sc0">
    </span><span class="sc8">jfs2loglv</span><span class="sc7">=</span><span class="sc11">$(grep jfs2log ${crvg_doc}.$vgname | awk '{print $1}')</span><span class="sc0">
    </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">mklv</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">jfs2log</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0"> </span><span class="sc9">$jfs2loglv</span><span class="sc0"> </span><span class="sc10">${crvg_vgname}</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${crvg_log}</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Create File System $fsname completed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${crvg_log}</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#provide the fs name and vg name on which this fs will be created,</span><span class="sc0">
</span><span class="sc2">#a logic volume of this fs will be created firstly, and size and other parameter</span><span class="sc0">
</span><span class="sc2">#of this logical volume is read from $(hostname)_STORAGE_DOC.$vgname</span><span class="sc0">
</span><span class="sc8">aix_crfs</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">crfs_fsname</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">crfs_vgname</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    
    </span><span class="sc8">crfs_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">crfs_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_CRFS_</span><span class="sc10">${crfs_fsname}</span><span class="sc8">_</span><span class="sc10">${crfs_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">crfs_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">crfs_doc</span><span class="sc7">=</span><span class="sc10">${crfs_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_STORAGE_DOC</span><span class="sc0">
    
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${crfs_fsname}</span><span class="sc0"> </span><span class="sc10">${crfs_doc}</span><span class="sc7">.</span><span class="sc10">${crfs_vgname}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">  </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"File System ${crfs_fsname} BACKUP not Document"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n Start to create filesystem...."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${crfs_log}</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">filesystems</span><span class="sc0"> </span><span class="sc9">$ETC</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_filesystems</span><span class="sc0">

    </span><span class="sc2">#removes file system if may still have record in /etc/filesystems. </span><span class="sc0">
    </span><span class="sc2">#remove its entry in the /etc/filesystems file,and the underlying logical volume.</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${crfs_fsname}</span><span class="sc0"> </span><span class="sc9">$ETC</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_filesystems</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" !!! WARNING: WE ARE GOING TO DELETE CURRENT ${crfs_fsname} !!!"</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"CONTROL+C to STOP if you DONOT want to DELETE current ${crfs_fsname}....."</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You have ONE munite ...."</span><span class="sc0">
        </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"DELETING ${crfs_fsname} ...."</span><span class="sc0">
        </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc0">
        </span><span class="sc4">umount</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${crfs_fsname}</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">rmfs</span><span class="sc0"> </span><span class="sc10">${crfs_fsname}</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#jfs2Log Volume on the new Volume Group</span><span class="sc0">
    </span><span class="sc8">jfs2loglv</span><span class="sc7">=</span><span class="sc11">$(lsvg -l ${crfs_vgname}|grep jfs2log|awk '{print $1}')</span><span class="sc0">
     
    </span><span class="sc2">#Parameters of logic volume(old) created</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${crfs_fsname}</span><span class="sc0">  </span><span class="sc10">${crfs_doc}</span><span class="sc7">.</span><span class="sc10">${crfs_vgname}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">LV_NAME</span><span class="sc0"> </span><span class="sc8">TYPE</span><span class="sc0"> </span><span class="sc8">LPs</span><span class="sc0"> </span><span class="sc8">PPs</span><span class="sc0"> </span><span class="sc8">PVs</span><span class="sc0"> </span><span class="sc8">LV_STATE</span><span class="sc0"> </span><span class="sc8">MOUNT_POINT</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc2">#Create Logic Volumes on new Volume Group</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">mklv</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">jfs2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0"> </span><span class="sc9">$LV_NAME</span><span class="sc0"> </span><span class="sc10">${crfs_vgname}</span><span class="sc0"> </span><span class="sc9">$LPs</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${crfs_log}</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">

        </span><span class="sc2">#Create FileSystems</span><span class="sc0">
        </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">sbin</span><span class="sc7">/</span><span class="sc8">crfs</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">jfs2</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc9">$LV_NAME</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc9">$MOUNT_POINT</span><span class="sc0"> </span><span class="sc8">-A</span><span class="sc0"> </span><span class="sc8">yes</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc8">rw</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">logname</span><span class="sc7">=</span><span class="sc9">$jfs2loglv</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${crfs_log}</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">

        </span><span class="sc4">mount</span><span class="sc0"> </span><span class="sc9">$MOUNT_POINT</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Create File System ${crfs_fsname} completed"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${crfs_log}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">aix_rfs</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">rfs_fsname</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    
    </span><span class="sc8">rfs_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">rfs_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_RFS_</span><span class="sc10">${rfs_fsname}</span><span class="sc8">_</span><span class="sc10">${rfs_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">rfs_image</span><span class="sc7">=</span><span class="sc10">${BKUPFSIMG:="/dev/rmt0"}</span><span class="sc0">
    </span><span class="sc8">rfs_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">rfs_doc</span><span class="sc7">=</span><span class="sc10">${rfs_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_STORAGE_DOC</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${rfs_fsname}</span><span class="sc0"> </span><span class="sc10">${rfs_doc}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"File System ${rfs_fsname} BACKUP not Document"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
        
    </span><span class="sc8">fsnumber</span><span class="sc7">=</span><span class="sc11">$(grep ${rfs_fsname} ${rfs_doc} | awk '{print $5}')</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${rfs_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">rfs_target</span><span class="sc7">=</span><span class="sc10">${rfs_image}</span><span class="sc7">.</span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">ext</span><span class="sc7">=</span><span class="sc11">$(echo ${rfs_fsname} | tr / _ )</span><span class="sc0">
        </span><span class="sc8">rfs_target</span><span class="sc7">=</span><span class="sc10">${rfs_dir}</span><span class="sc7">/</span><span class="sc10">${rfs_image}</span><span class="sc9">$ext</span><span class="sc7">.</span><span class="sc9">$fsnumber</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${rfs_fsname}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${rfs_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${rfs_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">

</span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xvqys</span><span class="sc0"> </span><span class="sc9">$fsnumber</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${rfs_target}</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
1
no
EOF</span><span class="sc0">
</span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Restore ${rfs_fsname} Failed."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${rfs_log}</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">else</span><span class="sc0">

</span><span class="sc8">restore</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xvqy</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${rfs_target}</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
1
no
EOF</span><span class="sc0">
</span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Restore ${rfs_fsname} Failed."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${rfs_log}</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Restore ${rfs_fsname} completed successfully."</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${rfs_log}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:         aix_restore</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  Restore AIX system file system(s)backup by aix_restore_backup </span><span class="sc0">
</span><span class="sc2">#               on a new volume group.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#1. File systems on old volume groups which backup by aix_restore_backup</span><span class="sc0">
</span><span class="sc2">#   will be created on new volume group if not exit.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#2. All file systems in FS[@] parameters and backuped will be restored</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Tips: If tape is used, there maybe mutiple filesystem(s) on one </span><span class="sc0">
</span><span class="sc2">#   single tape volume, the tape device name is /dev/rmt0.1, </span><span class="sc0">
</span><span class="sc2">#   which indicate no-retention and no-rewind after tape operation.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   All the backup information is store in a mateFile:</span><span class="sc0">
</span><span class="sc2">#   - Backup device ( for example: /dev/rmt0)</span><span class="sc0">
</span><span class="sc2">#   - Backup Medium lable ( for example: CM07-C02)</span><span class="sc0">
</span><span class="sc2">#   - Detailed volume group information </span><span class="sc0">
</span><span class="sc2">#   - File systems backuped in the volume group (#lsvg -l $vgname)</span><span class="sc0">
</span><span class="sc2">#   - The sequential number of backup filesystem if mutiple</span><span class="sc0">
</span><span class="sc2">#       filesystems is stored on one single tape volume</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Date            Name            Description</span><span class="sc0">
</span><span class="sc2">#  --------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#  2012-12-13      Liru Chen       Created due to cm07 quarterly </span><span class="sc0">
</span><span class="sc2">#                                  backup&amp;restore</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">####################################################################################</span><span class="sc0">
</span><span class="sc8">aix_restore</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc8">root</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">restore_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">restore_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_RESTORE_</span><span class="sc10">${restore_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    
    </span><span class="sc8">restore_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">restore_image</span><span class="sc7">=</span><span class="sc10">${BKUPFSIMG:="/dev/rmt0"}</span><span class="sc0">
    
    </span><span class="sc8">restore_doc</span><span class="sc7">=</span><span class="sc10">${restore_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_STORAGE_DOC</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${restore_doc}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"No File System BACKUP Document on $(hostname)"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">restore_fs</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${FS}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
        </span><span class="sc8">restore_fsname</span><span class="sc7">=</span><span class="sc11">$(echo "${restore_fs}@"|cut -f1 -d"@")</span><span class="sc0">
        </span><span class="sc8">restore_vgname</span><span class="sc7">=</span><span class="sc11">$(echo "${restore_fs}@"|cut -f2 -d"@")</span><span class="sc0">

        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${restore_vgname}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Please select VG for your file system"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        
        </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">restore_vg</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${VG}</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">restore_vgname_vg</span><span class="sc7">=</span><span class="sc11">$(echo "${restore_vg}@"|cut -f1 -d"@")</span><span class="sc0">
            </span><span class="sc8">restore_disks</span><span class="sc7">=</span><span class="sc11">$(echo "${restore_vg}@"|cut -f2 -d"@")</span><span class="sc0">
            
            </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${restore_vg}</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">${restore_vgname}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc10">${restore_vgname_vg}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc8">aix_crvg</span><span class="sc0"> </span><span class="sc10">${restore_vgname}</span><span class="sc0"> </span><span class="sc10">${restore_disks}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">
                </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
        
        </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc10">${restore_fsname}</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">filesystems</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">aix_crfs</span><span class="sc0"> </span><span class="sc10">${restore_fsname}</span><span class="sc0"> </span><span class="sc10">${restore_vgname}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">
        
        </span><span class="sc8">aix_rfs</span><span class="sc0"> </span><span class="sc10">${restore_fsname}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">

        </span><span class="sc2">#Mail to Administrator;</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"File System $fsname restored on Volume Group $vgname"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:         aix_vg_backup</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  Finds and backs up all files belonging to a specified volume group</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Command:      aix.vg.bkup backup_device vgName backup_medium_lable</span><span class="sc0">
</span><span class="sc2"># default backup device: /dev/rmt0</span><span class="sc0">
</span><span class="sc2"># default backup medium lable: `hostname`.`date +%Y%m%d%H%M`</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2"># Date      Name        Description </span><span class="sc0">
</span><span class="sc2"># -------------------------------------</span><span class="sc0">
</span><span class="sc2"># 2013-3-30 Liru Chen   Original</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc8">aix_vg_backup</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc8">root</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">vgb_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">vgb_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_VGB_</span><span class="sc10">${vgb_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    </span><span class="sc8">vgb_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">vgb_image</span><span class="sc7">=</span><span class="sc10">${BKUPVGIMG:="/dev/rmt0"}</span><span class="sc0">
    </span><span class="sc8">vgb_content</span><span class="sc7">=</span><span class="sc10">${vgb_dir}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_vgb_content</span><span class="sc0">

    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">summ</span><span class="sc7">=</span><span class="sc10">${#VG[@]}</span><span class="sc0">
    
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">summ</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
        </span><span class="sc8">vgname</span><span class="sc7">=</span><span class="sc11">$(echo ${VG[i]}|cut -f1 -d"|")</span><span class="sc0">
        </span><span class="sc8">disks</span><span class="sc7">=</span><span class="sc11">$(echo ${VG[i]}|cut -f2 -d"|"|tr "," " ")</span><span class="sc0">

        </span><span class="sc8">lsvg</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc9">$vgname</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">

        </span><span class="sc2">#The savevg command finds and backs up all files belonging to a specified </span><span class="sc0">
        </span><span class="sc2">#volume group. The volume group must be varied-on, and the file systems </span><span class="sc0">
        </span><span class="sc2">#must be mounted. To back up the user volume group and excluding the files</span><span class="sc0">
        </span><span class="sc2">#listed in the /etc/exclude.vgname file, and then verify the readability </span><span class="sc0">
        </span><span class="sc2">#of file headers</span><span class="sc0">

        </span><span class="sc2"># If backup device is tape drive, load/rewind tape volume</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${vgb_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Please load Tape for $vgname in 2 minues...."</span><span class="sc0">
            </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">120</span><span class="sc0">
            </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${vgb_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
            </span><span class="sc8">vgb_target</span><span class="sc7">=</span><span class="sc10">${vgb_image}</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">    </span><span class="sc2">#if backup to local disk, keep only one copy of vg image on current directory</span><span class="sc0">
            </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${vgb_dir}</span><span class="sc7">/</span><span class="sc10">${vgb_image}</span><span class="sc8">_</span><span class="sc10">${vgname}</span><span class="sc0">
            </span><span class="sc8">vgb_target</span><span class="sc7">=</span><span class="sc10">${vgb_dir}</span><span class="sc7">/</span><span class="sc10">${vgb_image}</span><span class="sc8">_</span><span class="sc10">${vgname}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
            
        </span><span class="sc8">savevg</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ief</span><span class="sc0"> </span><span class="sc10">${vgb_target}</span><span class="sc0"> </span><span class="sc9">$vgname</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t Volume Group $vgname backup failed "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${vgb_log}</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t &lt;error code = $? &gt; "</span><span class="sc0">                 </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${vgb_log}</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
        
        </span><span class="sc2">#List backup content</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${vgb_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc8">restvg</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${vgb_target}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${vgb_content}</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t Volume Group $vgname backup failed "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${vgb_log}</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\t &lt;error code = $? &gt; "</span><span class="sc0">                 </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${vgb_log}</span><span class="sc0">
                </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">  
        </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Volume Group $vgname backup completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${vgb_log}</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Name:         aix_vg_restore</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Reference:    n/a</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Description:  Restores the user volume group and all its containers and files, </span><span class="sc0">
</span><span class="sc2">#               as specified in the ${TMP}/vgdata/vgname/vgname.data file </span><span class="sc0">
</span><span class="sc2">#               (where vgname is the name of the volume group) contained within</span><span class="sc0">
</span><span class="sc2">#               the backup image created by the savevg command</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Command:      aix_vg_restore "hd1 hd2 ..." backup_medium_lable</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#               if no disks specified, disks in the /etc/vgname.data file contained </span><span class="sc0">
</span><span class="sc2">#               within the backup image will be used</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Modification History:</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Date      Name        Description </span><span class="sc0">
</span><span class="sc2"># --------------------------------------</span><span class="sc0">
</span><span class="sc2"># 2013-3-30 Liru Chen   Original</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">################################################################################</span><span class="sc0">
</span><span class="sc8">aix_vg_restore</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc8">root</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">vgr_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">vgr_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc11">$(hostname)</span><span class="sc8">_VGRS_</span><span class="sc10">${vgr_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">
    </span><span class="sc8">vgr_dir</span><span class="sc7">=</span><span class="sc10">${BKUPDIR:="${TMP}"}</span><span class="sc0">
    </span><span class="sc8">vgr_image</span><span class="sc7">=</span><span class="sc10">${BKUPVGIMG:="/dev/rmt0"}</span><span class="sc0">
    
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">summ</span><span class="sc7">=</span><span class="sc10">${#VG[@]}</span><span class="sc0">
    
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">summ</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">  
        </span><span class="sc8">vgname</span><span class="sc7">=</span><span class="sc11">$(echo ${VG[i]}|cut -f1 -d"|")</span><span class="sc0">
        </span><span class="sc8">disks</span><span class="sc7">=</span><span class="sc11">$(echo ${VG[i]}|cut -f2 -d"|"|tr "," " ")</span><span class="sc0">
        
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-c</span><span class="sc0"> </span><span class="sc10">${vgr_image}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Please load Tape for $vgname in 2 minues...."</span><span class="sc0">
            </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">120</span><span class="sc0">
            </span><span class="sc9">$TAPE</span><span class="sc0"> </span><span class="sc10">${vgr_image}</span><span class="sc0"> </span><span class="sc8">rewind</span><span class="sc0">
            </span><span class="sc8">vgr_target</span><span class="sc7">=</span><span class="sc10">${vgr_image}</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">    </span><span class="sc2">#if backup to local disk, keep only one copy of vg image on current directory</span><span class="sc0">
            </span><span class="sc8">vgr_target</span><span class="sc7">=</span><span class="sc10">${vgr_dir}</span><span class="sc7">/</span><span class="sc10">${vgr_image}</span><span class="sc8">_</span><span class="sc10">${vgname}</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
        
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${vgr_target}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"VG BACKUP RESUORCE NOT FOUND"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc8">restvg</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${vgr_target}</span><span class="sc0"> </span><span class="sc9">$disks</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${vgr_log}</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"restore $vgname failed "</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

        </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0">

    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc2">#Mail to Administrator;</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Volume Group $vgname RESTORE COMPLETED"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${vgr_log}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># The lsmksysb command lists the contents of a volume group backup from tape, </span><span class="sc0">
</span><span class="sc2"># file, CD-ROM, or other source and can be used to restore files from a</span><span class="sc0">
</span><span class="sc2"># valid backup source. The lsmksysb command also works for multi-volume backups</span><span class="sc0">
</span><span class="sc2"># such as multiple CDs, DVDs, USB disks, or tapes.</span><span class="sc0">

</span><span class="sc2"># The lsmksysb -r and restorevgfiles commands perform identical operations and</span><span class="sc0">
</span><span class="sc2"># should be considered</span><span class="sc0">
</span><span class="sc8">aix_file_restore</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">bckup_source</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">restore_file</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    
    </span><span class="sc2">#restore file</span><span class="sc0">
    </span><span class="sc8">lsmksysb</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${bckup_source}</span><span class="sc0"> </span><span class="sc10">${restore_file}</span><span class="sc0">
    
    </span><span class="sc2">#list file</span><span class="sc0">
    </span><span class="sc8">lsmksysb</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${bckup_source}</span><span class="sc0"> </span><span class="sc10">${restore_file}</span><span class="sc0">
    
    </span><span class="sc2">##Other options</span><span class="sc0">
    </span><span class="sc2">#/usr/sbin/restore -xvq -f ${bckup_source} ${restore_file}</span><span class="sc0">
    </span><span class="sc2">#/usr/sbin/restore -Tvqs4 -f /dev/rmt0.1 ${restore_file}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#################################################################################</span><span class="sc0">
</span><span class="sc2"># INFORMIX SERVER MANITENAMCE</span><span class="sc0">
</span><span class="sc2">#################################################################################</span><span class="sc0">
</span><span class="sc2">#At the start of a session, the client groups all the environment variables that the </span><span class="sc0">
</span><span class="sc2">#server will use and sends the environment variables to the server as single block. </span><span class="sc0">
</span><span class="sc2">#The maximum size of this block is 32K. If the block of environment variables is </span><span class="sc0">
</span><span class="sc2">#greater than 32K, the error -1832 is returned to the application. The text of </span><span class="sc0">
</span><span class="sc2">#this error is "Environment block is greater than 32K." </span><span class="sc0">

</span><span class="sc2">#To resolve this error, you can either unset one or more environment variables </span><span class="sc0">
</span><span class="sc2">#or reduce the size of some of the environment variables</span><span class="sc0">


</span><span class="sc2">############################################################################################</span><span class="sc0">
</span><span class="sc2">#Description    : INITIAL/DUPLICATE INFORMIX DATABASE SERVER: artestdb</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#Server and Storage:IPDEV</span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2">#1.INSTALL INFORMIX SERVER SOFTWARE</span><span class="sc0">
</span><span class="sc2">#   IDS Server Software: /usr/apps/inf/ver115UC3</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#2.ENVIRONMENT PARAMETERS FILE: ids115.env</span><span class="sc0">
</span><span class="sc2">#   Usage: . ids115.env $IDSSERVER</span><span class="sc0">
</span><span class="sc2">#   -----------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   SRVR=$1</span><span class="sc0">
</span><span class="sc2">#   echo ""</span><span class="sc0">
</span><span class="sc2">#   echo " Server $SRVR environment ..."</span><span class="sc0">
</span><span class="sc2">#   echo ""</span><span class="sc0">
</span><span class="sc2">#   INFVERSION=ver115UC3</span><span class="sc0">
</span><span class="sc2">#   INFORMIXDIR=/usr/apps/inf/$INFVERSION</span><span class="sc0">
</span><span class="sc2">#   INFORMIXSERVER=$SRVR</span><span class="sc0">
</span><span class="sc2">#   ONCONFIG=onconfig_$INFORMIXSERVER</span><span class="sc0">
</span><span class="sc2">#   ARC_CONFIG=onarconfig_$INFORMIXSERVER</span><span class="sc0">
</span><span class="sc2">#   PATH=$INFORMIXDIR/bin:$PATH</span><span class="sc0">
</span><span class="sc2">#   INFORMIXTERM=termcap</span><span class="sc0">
</span><span class="sc2">#   TERMCAP=$INFORMIXDIR/etc/termcap</span><span class="sc0">
</span><span class="sc2">#   SYSROOT=/usr/apps</span><span class="sc0">
</span><span class="sc2">#   INFROOT=$SYSROOT/inf</span><span class="sc0">
</span><span class="sc2">#   INFBIN=$INFORMIXDIR/bin</span><span class="sc0">
</span><span class="sc2">#   INFLIB=$INFORMIXDIR/lib</span><span class="sc0">
</span><span class="sc2">#   INFINC=$INFORMIXDIR/incl</span><span class="sc0">
</span><span class="sc2">#   INFPLATFORM=IBMAIX</span><span class="sc0">
</span><span class="sc2">#   INFLOGDIR=/home/informix/log</span><span class="sc0">
</span><span class="sc2">#   INFBKUP=/home/informix/bkup</span><span class="sc0">
</span><span class="sc2">#   #DBSPACETEMP=tempdbs1:tempdbs2:tempdbs3S</span><span class="sc0">
</span><span class="sc2">#   export INFVERSION INFORMIXDIR INFORMIXSERVER ONCONFIG ARC_CONFIG PATH</span><span class="sc0">
</span><span class="sc2">#   export INFORMIXTERM TERMCAP SYSROOT INFROOT INFBIN INFLIB INFINC INFPLATFORM</span><span class="sc0">
</span><span class="sc2">#   export INFLOGDIR INFBKUP</span><span class="sc0">
</span><span class="sc2">#   #export DBSPACETEMP</span><span class="sc0">
</span><span class="sc2">#   export INFXCPUVPPRIORITY=90</span><span class="sc0">
</span><span class="sc2">#   export INFXNETVPPRIORITY=90</span><span class="sc0">
</span><span class="sc2">#   export INFXMSCVPPRIORITY=90</span><span class="sc0">
</span><span class="sc2">#   export INFXIOVPPRIORITY=90</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#3.CONFIGURATION FILES</span><span class="sc0">
</span><span class="sc2">#   $ONCONFIG=$INFORMIXDIR/etc/onconfig_artestdb:</span><span class="sc0">
</span><span class="sc2">#   cp -p $INFORMIXDIR/etc/onconfig_systestdb $INFORMIXDIR/etc/onconfig_artestdb</span><span class="sc0">
</span><span class="sc2">#   modify  $INFORMIXDIR/etc/onconfig_artestdb according to DB storage definition</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # Root Dbspace Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # ROOTNAME     - The root dbspace name to contain reserved pages and</span><span class="sc0">
</span><span class="sc2">#   #                internal tracking tables.</span><span class="sc0">
</span><span class="sc2">#   # ROOTPATH     - The path for the device containing the root dbspace</span><span class="sc0">
</span><span class="sc2">#   # ROOTOFFSET   - The offset, in KB, of the root dbspace into the </span><span class="sc0">
</span><span class="sc2">#   #                device. The offset is required for some raw devices. </span><span class="sc0">
</span><span class="sc2">#   # ROOTSIZE     - The size of the root dbspace, in KB.  The value of </span><span class="sc0">
</span><span class="sc2">#   #                200000 allows for a default user space of about </span><span class="sc0">
</span><span class="sc2">#   #                100 MB and the default system space requirements.</span><span class="sc0">
</span><span class="sc2">#   ####################################################################</span><span class="sc0">
</span><span class="sc2">#   ROOTNAME rootdbs</span><span class="sc0">
</span><span class="sc2">#   ROOTPATH /ar_root/ar_root.1</span><span class="sc0">
</span><span class="sc2">#   ROOTOFFSET 0</span><span class="sc0">
</span><span class="sc2">#   ROOTSIZE 2048000</span><span class="sc0">
</span><span class="sc2">#   MIRROR 0</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # Physical Log Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # PHYSFILE           - The size, in KB, of the physical log on disk.</span><span class="sc0">
</span><span class="sc2">#   #                      If RTO_SERVER_RESTART is enabled, the </span><span class="sc0">
</span><span class="sc2">#   #                      suggested formula for the size of PHSYFILE </span><span class="sc0">
</span><span class="sc2">#   #                      (up to about 1 GB) is:</span><span class="sc0">
</span><span class="sc2">#   #                      PHYSFILE = Size of BUFFERS * 1.1</span><span class="sc0">
</span><span class="sc2">#   # onstat -g ckp  display configuration </span><span class="sc0">
</span><span class="sc2">#   # recommendations if a suboptimal configuration is detected</span><span class="sc0">
</span><span class="sc2">#   # PLOG_OVERFLOW_PATH - The directory for extra physical log files</span><span class="sc0">
</span><span class="sc2">#   #                      if the physical log overflows during recovery</span><span class="sc0">
</span><span class="sc2">#   #                      or long transaction rollback</span><span class="sc0">
</span><span class="sc2">#   # PHYSBUFF           - The size of the physical log buffer, in KB</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   PHYSFILE 110000</span><span class="sc0">
</span><span class="sc2">#   #PLOG_OVERFLOW_PATH  $INFORMIXDIR/tmp</span><span class="sc0">
</span><span class="sc2">#   PLOG_OVERFLOW_PATH </span><span class="sc0">
</span><span class="sc2">#   PHYSBUFF 100000</span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2">#   # Logical Log Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # LOGFILES     - The number of logical log files</span><span class="sc0">
</span><span class="sc2">#   # LOGSIZE      - The size of each logical log, in KB</span><span class="sc0">
</span><span class="sc2">#   # DYNAMIC_LOGS - The type of dynamic log allocation.</span><span class="sc0">
</span><span class="sc2">#   #                Acceptable values are:</span><span class="sc0">
</span><span class="sc2">#   #                2 Automatic. IDS adds a new logical log to the</span><span class="sc0">
</span><span class="sc2">#   #                  root dbspace when necessary.</span><span class="sc0">
</span><span class="sc2">#   #                1 Manual. IDS notifies the DBA to add new logical</span><span class="sc0">
</span><span class="sc2">#   #                  logs when necessary.</span><span class="sc0">
</span><span class="sc2">#   #                0 Disabled</span><span class="sc0">
</span><span class="sc2">#   # LOGBUFF      - The size of the logical log buffer, in KB</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   LOGFILES        6</span><span class="sc0">
</span><span class="sc2">#   LOGSIZE 100000</span><span class="sc0">
</span><span class="sc2">#   DYNAMIC_LOGS 1</span><span class="sc0">
</span><span class="sc2">#   LOGBUFF 64</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # MSGPATH      - The path of the IDS message log file</span><span class="sc0">
</span><span class="sc2">#   # CONSOLE      - The path of the IDS console message file</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   MSGPATH /login/infown/log/artestdb/online.log</span><span class="sc0">
</span><span class="sc2">#   MSG_DATE 1</span><span class="sc0">
</span><span class="sc2">#   CONSOLE /login/infown/log/artestdb/online.con</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # Temporary dbspace and sbspace Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # DBSPACETEMP  - The list of dbspaces used to store temporary</span><span class="sc0">
</span><span class="sc2">#   #                tables and other objects. Specify a colon</span><span class="sc0">
</span><span class="sc2">#   #                separated list of dbspaces that exist when the</span><span class="sc0">
</span><span class="sc2">#   #                server is started. If no dbspaces are specified, </span><span class="sc0">
</span><span class="sc2">#   #                or if all specified dbspaces  are not valid, </span><span class="sc0">
</span><span class="sc2">#   #                temporary files are created in the /tmp directory</span><span class="sc0">
</span><span class="sc2">#   #                instead.</span><span class="sc0">
</span><span class="sc2">#   # SBSPACETEMP  - The list of sbspaces used to store temporary </span><span class="sc0">
</span><span class="sc2">#   #                tables for smart large objects. If no sbspace</span><span class="sc0">
</span><span class="sc2">#   #                is specified, temporary files are created in</span><span class="sc0">
</span><span class="sc2">#   #                a standard sbspace.</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   DBSPACETEMP  tempdbs1,tempdbs2</span><span class="sc0">
</span><span class="sc2">#   SBSPACETEMP</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # System Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # SERVERNUM       - The unique ID for the IDS instance. Acceptable </span><span class="sc0">
</span><span class="sc2">#   #                   values are 0 through 255, inclusive.</span><span class="sc0">
</span><span class="sc2">#   # DBSERVERNAME    - The name of the default database server</span><span class="sc0">
</span><span class="sc2">#   # DBSERVERALIASES - The list of up to 32 alternative dbservernames, </span><span class="sc0">
</span><span class="sc2">#   #                   separated by commas</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   SERVERNUM 80</span><span class="sc0">
</span><span class="sc2">#   DBSERVERNAME    artestdb</span><span class="sc0">
</span><span class="sc2">#   DBSERVERALIASES</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # Diagnostic Dump Configuration Parameters</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   # DUMPDIR      - The location Assertion Failure (AF) diagnostic </span><span class="sc0">
</span><span class="sc2">#   #                files</span><span class="sc0">
</span><span class="sc2">#   # DUMPSHMEM    - Controls shared memory dumps. Acceptable values </span><span class="sc0">
</span><span class="sc2">#   #                are:</span><span class="sc0">
</span><span class="sc2">#   #                0 Disabled</span><span class="sc0">
</span><span class="sc2">#   #                1 Dump all shared memory</span><span class="sc0">
</span><span class="sc2">#   #                2 Exclude the buffer pool from the dump</span><span class="sc0">
</span><span class="sc2">#   # DUMPGCORE    - Enables (1) or disables (0) whether IDS dumps a </span><span class="sc0">
</span><span class="sc2">#   #                core using gcore</span><span class="sc0">
</span><span class="sc2">#   # DUMPCORE     - Enables (1) or disables (0) whether IDS dumps a </span><span class="sc0">
</span><span class="sc2">#   #                core after an AF</span><span class="sc0">
</span><span class="sc2">#   # DUMPCNT      - The maximum number of shared memory dumps or </span><span class="sc0">
</span><span class="sc2">#   #                core files for a single session</span><span class="sc0">
</span><span class="sc2">#   ###################################################################</span><span class="sc0">
</span><span class="sc2">#   DUMPDIR /recyclebox/inf/dump/artestdb</span><span class="sc0">
</span><span class="sc2">#   DUMPSHMEM 1</span><span class="sc0">
</span><span class="sc2">#   DUMPGCORE 0</span><span class="sc0">
</span><span class="sc2">#   DUMPCORE 0</span><span class="sc0">
</span><span class="sc2">#   DUMPCNT 1</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#$INFROMIXDIR/etc/$SQLHOSTS, </span><span class="sc0">
</span><span class="sc2">#   #**************************************************************************</span><span class="sc0">
</span><span class="sc2">#   #</span><span class="sc0">
</span><span class="sc2">#   #  Licensed Material - Property Of IBM</span><span class="sc0">
</span><span class="sc2">#   #</span><span class="sc0">
</span><span class="sc2">#   #  "Restricted Materials of IBM"</span><span class="sc0">
</span><span class="sc2">#   #</span><span class="sc0">
</span><span class="sc2">#   #  IBM Informix Dynamic Server</span><span class="sc0">
</span><span class="sc2">#   #  (c) Copyright IBM Corporation 1996, 2004 All rights reserved.</span><span class="sc0">
</span><span class="sc2">#   #</span><span class="sc0">
</span><span class="sc2">#   #   Title:      sqlhosts.demo</span><span class="sc0">
</span><span class="sc2">#   #   Description:</span><span class="sc0">
</span><span class="sc2">#   #               Default sqlhosts file for running demos.</span><span class="sc0">
</span><span class="sc2">#   #</span><span class="sc0">
</span><span class="sc2">#   #**************************************************************************</span><span class="sc0">
</span><span class="sc2">#   # IANA (www.iana.org) assigned port number/service names for Informix:</span><span class="sc0">
</span><span class="sc2">#   # sqlexec 9088/tcp</span><span class="sc0">
</span><span class="sc2">#   # sqlexec-ssl 9089/tcp</span><span class="sc0">
</span><span class="sc2">#   #demo_on        onipcshm        on_hostname     on_servername</span><span class="sc0">
</span><span class="sc2">#   #demo_se        seipcpip        se_hostname     sqlexec</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   #Systest database;</span><span class="sc0">
</span><span class="sc2">#   systestdb   onsoctcp    ipdev   systestdbsvc    k=1</span><span class="sc0">
</span><span class="sc2">#   artestdb    onsoctcp    ipdev   artestsvc</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#/etc/SERVICES</span><span class="sc0">
</span><span class="sc2">#------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   ipdbsvc         6800/tcp                        #For restore database instance</span><span class="sc0">
</span><span class="sc2">#   systestdbsvc    6600/tcp                        #system dev test database</span><span class="sc0">
</span><span class="sc2">#   artestdbsvc     6900/tcp                        #system arch test database</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#4.IDS STORAGE </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># filesystem, ensure size to meet chunk size requirement: </span><span class="sc0">
</span><span class="sc2">#----------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   /dev/arrootlv      2.50      2.48    1%        5     1% /ar_root</span><span class="sc0">
</span><span class="sc2">#   /dev/arploglv      0.50      0.50    1%        4     1% /ar_plog</span><span class="sc0">
</span><span class="sc2">#   /dev/arlloglv      2.00      2.00    1%        4     1% /ar_llog</span><span class="sc0">
</span><span class="sc2">#   /dev/ardat1lv     10.00     10.00    1%        4     1% /ar_dat1</span><span class="sc0">
</span><span class="sc2">#   /dev/ardat2lv      8.00      8.00    1%        4     1% /ar_dat2</span><span class="sc0">
</span><span class="sc2">#   /dev/aridx1lv      2.00      2.00    1%        4     1% /ar_idx1</span><span class="sc0">
</span><span class="sc2">#   /dev/aridx2lv      1.00      1.00    1%        4     1% /ar_idx2</span><span class="sc0">
</span><span class="sc2">#   /dev/artemplv      2.00      2.00    1%        4     1% /ar_temp</span><span class="sc0">
</span><span class="sc2">#   on AIX: chfs -a size=10G /ar_dat1</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#generate information about chunks in each storage space on Production Server ipdb,</span><span class="sc0">
</span><span class="sc2">#used by tchunk and tdbspace to create chunk files and dbsapace automatically</span><span class="sc0">
</span><span class="sc2">#   onstat -d  &gt; $ETC/IDSSTORAGE.artestdb.ipdev</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   modigy/replace all /ix_ with /ar_,Format Sample:</span><span class="sc0">
</span><span class="sc2">#   --------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc2">#   IBM Informix Dynamic Server Version 11.50.UC3W2   -- On-Line -- Up 00:13:21 -- 2252128 Kbytes</span><span class="sc0">
</span><span class="sc2">#   Dbspaces</span><span class="sc0">
</span><span class="sc2">#   address  number   flags      fchunk   nchunks  pgsize   flags    owner    name</span><span class="sc0">
</span><span class="sc2">#   b0431810 1        0x60001    1        1        4096     N  B     informix rootdbs</span><span class="sc0">
</span><span class="sc2">#   b1839b58 2        0x60001    2        10       4096     N  B     informix datadbs1</span><span class="sc0">
</span><span class="sc2">#   b182c6c8 3        0x60001    12       8        4096     N  B     informix datadbs2</span><span class="sc0">
</span><span class="sc2">#   b182db48 4        0x60001    20       1        4096     N  B     informix indxdbs2</span><span class="sc0">
</span><span class="sc2">#   b182e348 5        0x60001    21       2        4096     N  B     informix indxdbs1</span><span class="sc0">
</span><span class="sc2">#   b182ed18 6        0x60001    23       1        4096     N  B     informix llogdbs</span><span class="sc0">
</span><span class="sc2">#   b182f518 7        0x42001    24       1        4096     N TB     informix tempdbs1</span><span class="sc0">
</span><span class="sc2">#   b182fde0 8        0x42001    25       1        4096     N TB     informix tempdbs2</span><span class="sc0">
</span><span class="sc2">#   8 active, 2047 maximum</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Chunks</span><span class="sc0">
</span><span class="sc2">#   address  chunk/dbs offset     size       free    bpages     flags pathname</span><span class="sc0">
</span><span class="sc2">#   b0431970 1      1  0          512000     480301             PO-B  /ar_root/ar_root.1</span><span class="sc0">
</span><span class="sc2">#   b1839cb8 2      2  0          250000     246682             PO-B  /ar_dat1/ar_dat1.1</span><span class="sc0">
</span><span class="sc2">#   b17ff9f0 3      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.2</span><span class="sc0">
</span><span class="sc2">#   b17ffbc0 4      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.3</span><span class="sc0">
</span><span class="sc2">#   b188a4e8 5      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.4</span><span class="sc0">
</span><span class="sc2">#   b188a6b8 6      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.5</span><span class="sc0">
</span><span class="sc2">#   b188a888 7      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.6</span><span class="sc0">
</span><span class="sc2">#   b188aa58 8      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.7</span><span class="sc0">
</span><span class="sc2">#   b188ac28 9      2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.8</span><span class="sc0">
</span><span class="sc2">#   b188adf8 10     2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.9</span><span class="sc0">
</span><span class="sc2">#   b182c4f8 11     2  0          250000     249997             PO-B  /ar_dat1/ar_dat1.10</span><span class="sc0">
</span><span class="sc2">#   b182c828 12     3  0          250000     249947             PO-B  /ar_dat2/ar_dat2.1</span><span class="sc0">
</span><span class="sc2">#   b182ce98 13     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.2</span><span class="sc0">
</span><span class="sc2">#   b182d068 14     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.3</span><span class="sc0">
</span><span class="sc2">#   b182d238 15     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.4</span><span class="sc0">
</span><span class="sc2">#   b182d408 16     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.5</span><span class="sc0">
</span><span class="sc2">#   b182d5d8 17     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.6</span><span class="sc0">
</span><span class="sc2">#   b182d7a8 18     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.7</span><span class="sc0">
</span><span class="sc2">#   b182d978 19     3  0          250000     249997             PO-B  /ar_dat2/ar_dat2.8</span><span class="sc0">
</span><span class="sc2">#   b182dca8 20     4  0          250000     249947             PO-B  /ar_idx2/ar_idx2.1</span><span class="sc0">
</span><span class="sc2">#   b182e4a8 21     5  0          250000     249947             PO-B  /ar_idx1/ar_idx1.1</span><span class="sc0">
</span><span class="sc2">#   b182eb48 22     5  0          250000     249997             PO-B  /ar_idx1/ar_idx1.2</span><span class="sc0">
</span><span class="sc2">#   b182ee78 23     6  0          250000     99947              PO-B  /ar_llog/ar_llog.1</span><span class="sc0">
</span><span class="sc2">#   b182f678 24     7  0          250000     249947             PO-B  /ar_temp/ar_temp.1</span><span class="sc0">
</span><span class="sc2">#   b188c440 25     8  0          250000     249947             PO-B  /ar_temp/ar_temp.2</span><span class="sc0">
</span><span class="sc2">#   25 active, 32766 mamum</span><span class="sc0">
</span><span class="sc2">#   NOTE: The values in the "size" and "free" columns for DBspace chunks are</span><span class="sc0">
</span><span class="sc2">#   displayed in terms of "pgsize" of the DBspace to which they belong.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   Expanded chunk capacity mode: always</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#5.IDS DATABASE SQL</span><span class="sc0">
</span><span class="sc2">#   a) dbschema -d ip_0p &gt; artestdb.ip_artest.ipdev.sql</span><span class="sc0">
</span><span class="sc2">#       You can also use the -ss option to generate server-specific information:</span><span class="sc0">
</span><span class="sc2">#       dbschema -d ip_0p -ss &gt; artestdb.ip_artest.ipdev.sql</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#SQL generated from dbschema -d ip_0p -ss, modify SQL file into following INFORMIX</span><span class="sc0">
</span><span class="sc2">#objects creating SQL files, so we can load create tables and load data for each table,</span><span class="sc0">
</span><span class="sc2">#then build other objects like procedures, views, indexes, constraints and triggers if needed</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   b) Remove the header information about dbschema, if any, from the output file:</span><span class="sc0">
</span><span class="sc2">#           DBSCHEMA Schema Utility       INFORMIX-SQL Version 11.50.UC3W2</span><span class="sc0">
</span><span class="sc2">#       Add a CREATE DATABASE statement at the beginning of the output file </span><span class="sc0">
</span><span class="sc2">#           CREATE DATABASE ip_artest IN datadbs1 WITH LOG;</span><span class="sc0">
</span><span class="sc2">#           CONNECT TO 'ip_artest@artestdb' USER 'informix' USING 'infdev';#</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   c) string replace:  ip_0p --&gt; ip_artest</span><span class="sc0">
</span><span class="sc2">#                       @ipdb --&gt; @artestdb</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#       No "in datadbs1/2/3;indxdbs1/2/3", all tables/indexes are created in </span><span class="sc0">
</span><span class="sc2">#       default dbspace: datadbs1</span><span class="sc0">
</span><span class="sc2">#   There are Error when run this SQL generated by dbschema on production server,</span><span class="sc0">
</span><span class="sc2">#   you need to modify db sql:</span><span class="sc0">
</span><span class="sc2">#   grant select|update|delete|insert on "informix".vw_tarifftrtmnt to "public" as "informix";</span><span class="sc0">
</span><span class="sc2">#   before create view "ipgown".trk_srb3sub</span><span class="sc0">
</span><span class="sc2">#6.use DB-Access to create a new database without log mode, it's good for a new </span><span class="sc0">
</span><span class="sc2">#  database which need to load large data to tables, then use ontape and/or ondblog to</span><span class="sc0">
</span><span class="sc2">#  change database log mode to regular logging</span><span class="sc0">
</span><span class="sc2">################################################################################################</span><span class="sc0">

</span><span class="sc2">#Read full chunk path names with status PO|PD|MO|MD from $ETC/IDSSTORAGE</span><span class="sc0">
</span><span class="sc2">#and create chunk files for INFORMIX database server if not exist</span><span class="sc0">
</span><span class="sc8">tchunk</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2"># if [[ $USER != 'root' ]]</span><span class="sc0">
    </span><span class="sc2"># then</span><span class="sc0">
        </span><span class="sc2"># echo "You should be root user"</span><span class="sc0">
        </span><span class="sc2"># return 201</span><span class="sc0">
    </span><span class="sc2"># fi</span><span class="sc0">
    
    </span><span class="sc8">tchunk_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tchunk_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tchunk_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tchunk_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">tchunk_doc</span><span class="sc7">=</span><span class="sc9">$ETC</span><span class="sc7">/</span><span class="sc8">IDSSTORAGE.</span><span class="sc10">${tchunk_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tchunk_doc}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"IDS Storage Document not available"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc6">'[PM][OD]'</span><span class="sc0"> </span><span class="sc10">${tchunk_doc}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $8}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">chunkpath</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc9">$chunkpath</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc11">$(dirname $chunkpath)</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc11">$(dirname $chunkpath)</span><span class="sc0">
            </span><span class="sc4">touch</span><span class="sc0"> </span><span class="sc9">$chunkpath</span><span class="sc0">

            </span><span class="sc4">chown</span><span class="sc0"> </span><span class="sc8">-R</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc7">:</span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc11">$(dirname $chunkpath)</span><span class="sc0">
            </span><span class="sc4">chmod</span><span class="sc0"> </span><span class="sc3">660</span><span class="sc0"> </span><span class="sc9">$chunkpath</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Read full chunk path names with status PO|PD|MO|MD from $ETC/IDSSTORAGE</span><span class="sc0">
</span><span class="sc2">#and create dbspace for INFORMIX database server if not exist</span><span class="sc0">
</span><span class="sc8">tdbspace</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2"># if [[ $USER != 'root' ]]</span><span class="sc0">
    </span><span class="sc2"># then</span><span class="sc0">
        </span><span class="sc2"># echo "You should be root user"</span><span class="sc0">
        </span><span class="sc2"># return 201</span><span class="sc0">
    </span><span class="sc2"># fi</span><span class="sc0">
    
    </span><span class="sc8">tdbspace_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tdbspace_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tdbspace_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tdbspace_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tdbspace_server}</span><span class="sc0">
    
    </span><span class="sc8">tdbspace_doc</span><span class="sc7">=</span><span class="sc9">$ETC</span><span class="sc7">/</span><span class="sc8">IDSSTORAGE.</span><span class="sc10">${tdbspace_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tdbspace_doc}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"IDS Storage Document not available"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc10">${tdbspace_doc}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">address</span><span class="sc0"> </span><span class="sc8">number</span><span class="sc0"> </span><span class="sc8">flags</span><span class="sc0"> </span><span class="sc8">fchunk</span><span class="sc0"> </span><span class="sc8">nchunks</span><span class="sc0"> </span><span class="sc8">pgsize</span><span class="sc0"> </span><span class="sc8">flagsF</span><span class="sc0"> </span><span class="sc8">flagsT</span><span class="sc0"> </span><span class="sc8">owner</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">chunk_first</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc6">'[PM][OD]'</span><span class="sc0"> </span><span class="sc10">${tdbspace_doc}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">address</span><span class="sc0"> </span><span class="sc8">chunk</span><span class="sc0"> </span><span class="sc8">dbs</span><span class="sc0"> </span><span class="sc8">offset</span><span class="sc0"> </span><span class="sc8">size</span><span class="sc0"> </span><span class="sc8">free</span><span class="sc0"> </span><span class="sc8">flags</span><span class="sc0"> </span><span class="sc8">pathname</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$flagsT</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"TB"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$dbs</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc9">$number</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc2">#one chunk for one temp dbspace</span><span class="sc0">
                </span><span class="sc8">onspaces</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$pathname</span><span class="sc0"> </span><span class="sc8">-o</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">1000000</span><span class="sc0">
                </span><span class="sc4">continue</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$flagsT</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"B"</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc9">$dbs</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc9">$number</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[</span><span class="sc0"> </span><span class="sc10">${chunk_first}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc8">onspaces</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$pathname</span><span class="sc0"> </span><span class="sc8">-o</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">1000000</span><span class="sc0">
                    </span><span class="sc8">chunk_first</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">   </span><span class="sc2">#first chunk used to create dbspace</span><span class="sc0">
                </span><span class="sc4">else</span><span class="sc0">
                    </span><span class="sc2">#other chunks added to created dbspace</span><span class="sc0">
                    </span><span class="sc8">onspaces</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$pathname</span><span class="sc0"> </span><span class="sc8">-o</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">1000000</span><span class="sc0">
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tlog</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tlog_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tlog_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tlog_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tlog_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tlog_server}</span><span class="sc0">
    
</span><span class="sc2">#Physical Log stores a before-image of any page that Informix is going to modify,</span><span class="sc0">
</span><span class="sc2">#the before-images in the Physical Log are used by fast recovery and database restores</span><span class="sc0">
</span><span class="sc2">#to give an accurate snapshot of your data at the time of the last checkpoint.</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># There is absolutely no performance penalty for having a big physical log, but</span><span class="sc0">
</span><span class="sc2"># there are drawbacks to having an undersized physical log.</span><span class="sc0">
</span><span class="sc2"># - Checkpoints firing too frequently due to small physical log hitting 75% full mark often</span><span class="sc0">
</span><span class="sc2"># - Checkpoint blocking due to physical log filling during a checkpoint</span><span class="sc0">
</span><span class="sc2"># - Fast Recovery can take longer if physical log is not large enough </span><span class="sc0">
</span><span class="sc2"># use onstat -g ckp to find IDS recommendations on the size of physical log</span><span class="sc0">

</span><span class="sc2"># onstat -l     #Print logging (physical + logical)</span><span class="sc0">
</span><span class="sc2"># onstat -g ckp #Print checkpoint statistics</span><span class="sc0">
</span><span class="sc2"># onstat -rm    #Print message log, Repeat options every &lt;seconds&gt; seconds (default: 5)</span><span class="sc0">

</span><span class="sc2"># The server is blocking transactions because the physical log is too small.</span><span class="sc0">
</span><span class="sc2"># Based on the current workload, to prevent the server from blocking future</span><span class="sc0">
</span><span class="sc2"># transactions,increase the size of the physical log to 1,202,696 KB</span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2"># Based on the current workload, the logical log space might be too small</span><span class="sc0">
</span><span class="sc2"># to accommodate the time it takes to flush the buffer pool.  The server might</span><span class="sc0">
</span><span class="sc2"># block transactions during checkpoints.  If the server blocks transactions,</span><span class="sc0">
</span><span class="sc2"># increase the size of the logical log space to at least 1,963,624 KB</span><span class="sc0">

</span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">300000</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">rootdbs</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0"> </span><span class="sc2"># this will modify ONCONFIG also</span><span class="sc0">

</span><span class="sc2">#Logical log records:</span><span class="sc0">
</span><span class="sc2"># - Transaction Rollback</span><span class="sc0">
</span><span class="sc2"># - Recovery from Engine Failure (Data Restore and Fast Recovery)</span><span class="sc0">
</span><span class="sc2"># - Deferred Constraint Checking</span><span class="sc0">
</span><span class="sc2"># - Cascading Deletes</span><span class="sc0">
</span><span class="sc2"># - Distributed Transactions (Two Phase Commit)</span><span class="sc0">
</span><span class="sc2"># - Enterprise Replication</span><span class="sc0">
</span><span class="sc2"># - High Availability Data Replication</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#The logical logs are used in a circular fashion, when a new logical log is needed, </span><span class="sc0">
</span><span class="sc2">#Informix starts overwriting the data in the logical log that contains the oldest data</span><span class="sc0">
</span><span class="sc2">#as long as it is:</span><span class="sc0">
</span><span class="sc2"># 1) marked as backed up and, </span><span class="sc0">
</span><span class="sc2"># 2) does not contain any open transactions.</span><span class="sc0">
</span><span class="sc2">#If either 1 or 2 are met, the engine will block and Informix DB hung</span><span class="sc0">

</span><span class="sc2">#By default, oninit -iy created logical logs based on </span><span class="sc0">
</span><span class="sc2"># LOGFILES     - The number of logical log files (6, default 6)</span><span class="sc0">
</span><span class="sc2"># LOGSIZE      - The size of each logical log, in KB (100000, default 10,000 KB)</span><span class="sc0">

</span><span class="sc2">#use the onparams command to drop the first 3 (leaving me with 3 total) </span><span class="sc0">
</span><span class="sc2">#then create 3 logical logs of the new size and in the new dbspace to take their place</span><span class="sc0">
</span><span class="sc2">#I can then drop the remaining 3 logical logs and create the remaining 3 logical logs</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">      </span><span class="sc2">#Switches the current logical-log file to the next logical-log file</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0">      </span><span class="sc2">#Forces a checkpoint that flushes the buffers to disk</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0"> </span><span class="sc2"># 25000 pages = 100000 KB</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">      </span><span class="sc2">#Switches the current logical-log file to the next logical-log file</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0">      </span><span class="sc2">#Forces a checkpoint that flushes the buffers to disk</span><span class="sc0">
</span><span class="sc2"># - To free a logical-log file that contains the most recent checkpoint record </span><span class="sc0">
</span><span class="sc2">#   and that is backed up but not yet released (onstat -l status of U-B-L or U-B)</span><span class="sc0">
</span><span class="sc2"># - Before you issue onmode -sy to place the database server in quiescent mode</span><span class="sc0">
</span><span class="sc2"># - After building a large index, if the database server terminates before the </span><span class="sc0">
</span><span class="sc2">#   next checkpoint. The index build restarts the next time that you restart the database server.</span><span class="sc0">
</span><span class="sc2"># - If a checkpoint has not occurred for a long time and you are about to attempt </span><span class="sc0">
</span><span class="sc2">#   a system operation that might interrupt the database server</span><span class="sc0">
</span><span class="sc2"># - If foreground writes are taking more resources than you want (force a checkpoint</span><span class="sc0">
</span><span class="sc2">#   to bring this down to zero temporarily)</span><span class="sc0">
</span><span class="sc2"># - Before you run dbexport or unload a table, to ensure physical consistency of all </span><span class="sc0">
</span><span class="sc2">#   data before you export or unload it</span><span class="sc0">
</span><span class="sc2"># - After you perform a large load of tables using PUT or INSERT statements (Because </span><span class="sc0">
</span><span class="sc2">#   table loads use the buffer cache, forcing a checkpoint cleans the buffer cache.)</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc3">6</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0">
 </span><span class="sc8">onparams</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc8">llogdbs</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc3">100000</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tdb</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tdb_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tdb_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tdb_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tdb_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tdb_server}</span><span class="sc0">
    
    </span><span class="sc8">tdb_doc</span><span class="sc7">=</span><span class="sc9">$ETC</span><span class="sc7">/</span><span class="sc10">${tdb_server}</span><span class="sc7">.</span><span class="sc10">${tdb_db}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tdb_doc}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"IDS DBS SQL DOCUMENT NOT AVAILABLE"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc10">${tdb_doc}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tinit</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'root'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">tinit_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tinit_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tinit_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tinit_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc2">#Make sure IDS STORAGE document $ETC/IDSSTORAGE.artestdb.ipdev is ready; </span><span class="sc0">
    </span><span class="sc8">tchunk</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">    
    </span><span class="sc2"># #. $ids_env ${tinit_server}</span><span class="sc0">
    
    </span><span class="sc2">#Initializes disk space for the root dbspace, destroys all existing data managed by $ids_server</span><span class="sc0">
    </span><span class="sc2">#The database server must be offline if already exist and running: onmode -ky</span><span class="sc0">
    </span><span class="sc2">#</span><span class="sc0">
    </span><span class="sc2">#To monitor all the process during IDS server creation, Please open a new session: onstat -rm; </span><span class="sc0">
    </span><span class="sc8">oninit</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ivy</span><span class="sc0">
    </span><span class="sc8">oninit_rc</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${oninit_rc}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">tdbspace</span><span class="sc0">            </span><span class="sc2">#Create DBspace when db server created successfully</span><span class="sc0">
        </span><span class="sc8">tlog</span><span class="sc0">    </span><span class="sc2">#modify physical log and logical logs size and location</span><span class="sc0">

        </span><span class="sc2">#Create DB (No data) with $ETC/${ids_server}.${ids_database}.$(hostname).sql</span><span class="sc0">
        </span><span class="sc2">#run by USER informix</span><span class="sc0">
        </span><span class="sc4">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc9">$BASE</span><span class="sc7">/</span><span class="sc8">shlib</span><span class="sc0"> </span><span class="sc8">tdb</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"IDS INIT FAILED"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc10">${oninit_rc}</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#SET TABLE TRIGGERS, INDEXES, CONSTRAINTS DISABLED</span><span class="sc0">
</span><span class="sc8">ticdisabled</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ticdisabled_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">ticdisabled_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${ticdisabled_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${ticdisabled_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${ticdisabled_server}</span><span class="sc0">

    </span><span class="sc8">tic_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
    SET CONSTRAINTS,INDEXES,TRIGGERS FOR ${tic_table_name} DISABLED; "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${ticdisabled_db}</span><span class="sc0">
        
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#SET TABLE TRIGGERS, INDEXES, CONSTRAINTS ENABLED</span><span class="sc0">
</span><span class="sc8">ticenabled</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ticenabled_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">ticenabled_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
        
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${ticenabled_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${ticenabled_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${ticenabled_server}</span><span class="sc0">

    </span><span class="sc8">tic_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
    SET CONSTRAINTS,INDEXES,TRIGGERS FOR ${tic_table_name} ENABLED; "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${ticenabled_db}</span><span class="sc0">
        
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Change whole DB log mode to no log, if you have no space to add physical/logical log</span><span class="sc0">
</span><span class="sc2">#without parameter, this will change db log mode to unbuf, it's default</span><span class="sc0">
</span><span class="sc8">tlogmode</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tlogmode_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tlogmode_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tlogmode_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tlogmode_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tlogmode_server}</span><span class="sc0">
    
    </span><span class="sc8">log_mode</span><span class="sc7">=</span><span class="sc10">${1-"unbuf"}</span><span class="sc0">
    </span><span class="sc2">#To change the buffering mode from buffered to unbuffered logging on a database</span><span class="sc0">
    </span><span class="sc2">#run the following command:ondblog unbuf ${tlogmode_db}</span><span class="sc0">

    </span><span class="sc2">#To change the buffering mode from unbuffered to buffered logging on a database</span><span class="sc0">
    </span><span class="sc2">#run the following command: ondblog buf ${tlogmode_db}</span><span class="sc0">
    
    </span><span class="sc2">#To end logging for two databases that are listed in a file called dbfile, </span><span class="sc0">
    </span><span class="sc2">#run the following command: ondblog nolog ${tlogmode_db}</span><span class="sc0">
    
    </span><span class="sc2">#Change to quiescent mode and kill all attached sessions</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">uy</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${log_mode}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"nolog"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">ontape</span><span class="sc0"> </span><span class="sc8">-N</span><span class="sc0"> </span><span class="sc10">${tlogmode_db}</span><span class="sc0">
    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${log_mode}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"buf"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">ontape</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc8">-B</span><span class="sc0"> </span><span class="sc10">${tlogmode_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc8">ontape</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">U</span><span class="sc0"> </span><span class="sc10">${tlogmode_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#Go to multi-user on-line</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">my</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">##########################################################################</span><span class="sc0">
</span><span class="sc2">#Quick script thrown together to find dependencies on a table. </span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2">#Usage: depend.sh database table </span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2">#This will list all tables which refer to this table either by view or by </span><span class="sc0">
</span><span class="sc2">#foreign key.  It will also list any tables that this table depends on.  </span><span class="sc0">
</span><span class="sc2">#It will recurse through a dependency chain. </span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2">#The sysconstraints table has a record for every constraint in the database</span><span class="sc0">
</span><span class="sc2">#   C Check </span><span class="sc0">
</span><span class="sc2">#   P Primary key </span><span class="sc0">
</span><span class="sc2">#   R Reference (Foreign Key) </span><span class="sc0">
</span><span class="sc2">#   U Unique </span><span class="sc0">
</span><span class="sc2">#   N Not Null</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># Jack Parker 2003 </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">############################################################### </span><span class="sc0">
</span><span class="sc8">find_par_view</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
    output to pipe "cat" without headings 
    select trim(b.tabname) 
    from sysdepend c, systables a, systables b 
    where btabid=a.tabid 
    and dtabid=b.tabid 
    and b.tabname = "$2"; 
EOF</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0"> 

</span><span class="sc8">find_child_view</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
    output to pipe "cat" without headings 
    select trim(b.tabname) 
    from sysdepend c, systables a, systables b 
    where btabid=a.tabid 
    and dtabid=b.tabid 
    and a.tabname = "$2"; 
EOF</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">find_par_fk</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
    output to pipe "cat" without headings 
    select trim(d.tabname) || ' ' || trim(constrname) || ' ' || state 
    from systables a, sysconstraints b, sysreferences c, systables d, sysobjstate e 
    where constrtype='R' 
    and a.tabid=b.tabid 
    and b.constrid=c.constrid 
    and b.constrname=e.name 
    and c.ptabid=d.tabid 
    and a.tabname = "$2"; 
EOF</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">find_child_fk</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc13">
    output to pipe "cat" without headings 
    select trim(a.tabname) || ' ' || trim(constrname) || ' ' || state 
    from systables a, sysconstraints b, sysreferences c, systables d, sysobjstate e 
    where constrtype='R' 
    and a.tabid=b.tabid 
    and b.constrid=c.constrid 
    and b.constrname=e.name 
    and c.ptabid=d.tabid 
    and d.tabname = "$2"; 
EOF</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">rec_pfk</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">"$idnt-"</span><span class="sc0"> 
    </span><span class="sc8">find_par_fk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> 
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">junk</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$idnt</span><span class="sc0"> </span><span class="sc5">"Parent of FK: $junk"</span><span class="sc0"> 
        </span><span class="sc8">tab</span><span class="sc7">=</span><span class="sc11">`echo $junk | cut -d" " -f1 `</span><span class="sc0"> 
        </span><span class="sc8">rec_pfk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$tab</span><span class="sc0"> 
    </span><span class="sc4">done</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc11">`echo $idnt | awk '{a=length($0)-1; print substr($0,1,a)}'`</span><span class="sc0"> 
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">rec_cfk</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">"$idnt-"</span><span class="sc0"> 
    </span><span class="sc8">find_child_fk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> 
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">junk</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$idnt</span><span class="sc0"> </span><span class="sc5">"Child of FK: $junk"</span><span class="sc0"> 
        </span><span class="sc8">tab</span><span class="sc7">=</span><span class="sc11">`echo $junk | cut -d" " -f1 `</span><span class="sc0"> 
        </span><span class="sc8">rec_cfk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$tab</span><span class="sc0"> 
    </span><span class="sc4">done</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc11">`echo $idnt | awk '{a=length($0)-1; print substr($0,1,a)}'`</span><span class="sc0"> 
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">rec_pvw</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">"$idnt-"</span><span class="sc0"> 
    </span><span class="sc8">find_par_view</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> 
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">tab</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$idnt</span><span class="sc0"> </span><span class="sc5">"Parent View : $tab"</span><span class="sc0"> 
        </span><span class="sc8">rec_cfk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$tab</span><span class="sc0"> 
    </span><span class="sc4">done</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc11">`echo $idnt | awk '{a=length($0)-1; print substr($0,1,a)}'`</span><span class="sc0"> 
</span><span class="sc7">}</span><span class="sc0"> 
 
</span><span class="sc8">rec_cvw</span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">"$idnt-"</span><span class="sc0"> 
    </span><span class="sc8">find_child_view</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$2</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> 
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">tab</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$idnt</span><span class="sc0"> </span><span class="sc5">"Child of View : $tab"</span><span class="sc0"> 
        </span><span class="sc8">rec_cfk</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc9">$tab</span><span class="sc0"> 
    </span><span class="sc4">done</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc11">`echo $idnt | awk '{a=length($0)-1; print substr($0,1,a)}'`</span><span class="sc0"> 
</span><span class="sc7">}</span><span class="sc0"> 

</span><span class="sc8">tcolumn</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tcolumn_db</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">tcolumn_table</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"select colname from systables,syscolumns
        where tabname like '${tcolumn_table}'
        and systables.tabid=syscolumns.tabid
        order by colno"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tcolumn_db}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">colname</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tshow</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tshow_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tshow_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tshow_server}</span><span class="sc0">
    
    </span><span class="sc8">tshow_table</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" 

    Database: ${tshow_db}
    "</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0"> 
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Searching for tables that (${tshow_table} ) has an FK to:"</span><span class="sc0"> 
    </span><span class="sc8">rec_pfk</span><span class="sc0"> </span><span class="sc10">${tshow_db}</span><span class="sc0"> </span><span class="sc10">${tshow_table}</span><span class="sc0"> 
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0"> 
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Searching for tables that refer to (${tshow_table} ) with an FK:"</span><span class="sc0"> 
    </span><span class="sc8">rec_cfk</span><span class="sc0"> </span><span class="sc10">${tshow_db}</span><span class="sc0"> </span><span class="sc10">${tshow_table}</span><span class="sc0">  
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0"> 
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Searching for Parent tables for potential view (${tshow_table} ):"</span><span class="sc0"> 
    </span><span class="sc8">rec_pvw</span><span class="sc0"> </span><span class="sc10">${tshow_db}</span><span class="sc0"> </span><span class="sc10">${tshow_table}</span><span class="sc0">  
    </span><span class="sc8">idnt</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0"> 
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Searching for Child views for table (${tshow_table} ):"</span><span class="sc0"> 
    </span><span class="sc8">rec_cvw</span><span class="sc0"> </span><span class="sc10">${tshow_db}</span><span class="sc0"> </span><span class="sc10">${tshow_table}</span><span class="sc0"> 

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#This is a recursive algorithm:</span><span class="sc0">
</span><span class="sc2">#function call itself, find all related tables after each function return,</span><span class="sc0">
</span><span class="sc2">#function will not call itself (ends cycling) when "junk" is empty</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#Set local variable in KSH:</span><span class="sc0">
</span><span class="sc2"># - use "function" to set function "trelation", and </span><span class="sc0">
</span><span class="sc2"># - use typeset to set local variable "child_table" &amp; "parent_table"</span><span class="sc0">
</span><span class="sc4">function</span><span class="sc0"> </span><span class="sc8">trelation</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">trelation_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">trelation_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${trelation_server}   </span><span class="sc0">

    </span><span class="sc8">trelation_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="/login/lchen/tools/etc/table/load"}</span><span class="sc0">
    </span><span class="sc8">trelation_table_relation</span><span class="sc7">=</span><span class="sc5">"${trelation_table_dir}/table_relation_$$"</span><span class="sc0">
    </span><span class="sc8">trelation_table_relation_rev</span><span class="sc7">=</span><span class="sc5">"${trelation_table_dir}/table_relation_rev_$$"</span><span class="sc0">

    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc8">trelation_table</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc8">parent_tables</span><span class="sc7">=</span><span class="sc11">$(find_par_fk ${trelation_db} ${trelation_table}|awk '{print $1}')</span><span class="sc0">
    
    </span><span class="sc2">#When recursive forward</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">parent_table</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${parent_tables}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${parent_table} ${trelation_table} $$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${trelation_table_relation}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">        

    </span><span class="sc2">#Check recursive continue condition, it will stop while "junk" is empty</span><span class="sc0">
    </span><span class="sc8">find_child_fk</span><span class="sc0"> </span><span class="sc10">${trelation_db}</span><span class="sc0"> </span><span class="sc10">${trelation_table}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">junk</span><span class="sc0"> 
    </span><span class="sc4">do</span><span class="sc0"> 
        </span><span class="sc8">tab</span><span class="sc7">=</span><span class="sc11">$(echo $junk | cut -d" " -f1)</span><span class="sc0">
        </span><span class="sc8">trelation</span><span class="sc0"> </span><span class="sc9">$tab</span><span class="sc0"> 
    </span><span class="sc4">done</span><span class="sc0"> 
    
    </span><span class="sc2">#When recursive return</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">parent_table</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${parent_tables}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"${trelation_table} ${parent_table} $$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${trelation_table_relation_rev}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0"> 
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Collect and generate DDL for tables' CONSTRAINTS,INDEXES,TRIGGERS </span><span class="sc0">
</span><span class="sc2">#echo "alter table informix.b3 add primary key (b3iid)"|dbaccess ip_systest</span><span class="sc0">
</span><span class="sc2">#echo "alter table informix.b3b add constraint foreign key (b3iid) references informix.b3|dbaccess ip_systest</span><span class="sc0">
</span><span class="sc8">tddl</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tddl_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tddl_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tddl_server}</span><span class="sc0">
    
    </span><span class="sc8">tddl_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tddl_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${tddl_table_dir}</span><span class="sc0">
    
    </span><span class="sc2">#Clean DDL statement if exist   </span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_ddl_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_index_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_index_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_trigger_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_trigger_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">

    </span><span class="sc2">#Generates DDL of load table</span><span class="sc0">
    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_ddl_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    
    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{printf $0} /;/{print ""}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"create.index"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_index_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">   
    
    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{printf $0} /;/{print ""}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"create.index"</span><span class="sc7">|</span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc8">s</span><span class="sc7">/</span><span class="sc8">create</span><span class="sc7">/</span><span class="sc8">drop</span><span class="sc7">/|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $1" "$2" "$3}'</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_index_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> 

    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{printf $0} /;/{print ""}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"create.trigger"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_trigger_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> 
    
    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{printf $0} /;/{print ""}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"create.trigger"</span><span class="sc7">|</span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc8">s</span><span class="sc7">/</span><span class="sc8">create</span><span class="sc7">/</span><span class="sc8">drop</span><span class="sc7">/|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $1" "$2" "$3}'</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_trigger_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">

    </span><span class="sc8">dbschema</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{printf $0} /;/{print ""}'</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc5">"alter.table"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
        
    </span><span class="sc8">primarykn</span><span class="sc7">=</span><span class="sc11">$(dbschema -d ${tddl_db} -t ${tddl_table_name}|grep -i "primary key")</span><span class="sc0"> 
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$primarykn</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"ALTER TABLE ${tddl_table_name} ADD CONSTRAINT $primarykn; "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_create_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
                    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"SELECT constrname FROM  sysconstraints
    WHERE tabid = (SELECT tabid FROM systables
    WHERE tabname = '${tddl_table_name}');"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tddl_db}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">col1</span><span class="sc0"> </span><span class="sc8">cname</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">referencen</span><span class="sc7">=</span><span class="sc11">$(echo $cname | grep ^r)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$referencen</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"ALTER TABLE ${tddl_table_name} DROP CONSTRAINT $referencen; "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    
        </span><span class="sc8">primaryn</span><span class="sc7">=</span><span class="sc11">$(echo $cname | grep ^u)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$primaryn</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"ALTER TABLE ${tddl_table_name} DROP CONSTRAINT $primaryn; "</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${tddl_table_name}</span><span class="sc8">_drop_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tddl_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc8">children</span><span class="sc7">=</span><span class="sc11">$(grep ${tddl_table_name} ${tddl_table_dir}/table_relation_$$ |
                cut -f2 -d" "|grep -vix ${tddl_table_name})</span><span class="sc0">
        
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">child</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${children}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">tddl</span><span class="sc0"> </span><span class="sc10">${child}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#SET CONSTRAINTS, TRIGGERS, INDEXES DISABLED for TABLE in reference chain</span><span class="sc0">
</span><span class="sc2">#(Foreign Key) From Child to Parent(s)</span><span class="sc0">
</span><span class="sc4">function</span><span class="sc0"> </span><span class="sc8">tsd</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tsd_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="/login/lchen/tools/etc/table/load"}</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc8">tsd_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tsd_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc8">children</span><span class="sc7">=</span><span class="sc11">$(grep ${tsd_table_name} ${tsd_table_dir}/table_relation_$$ |
                cut -f2 -d" "|grep -vix ${tsd_table_name})</span><span class="sc0">  
    </span><span class="sc2">#grep -x  match the specified pattern exactly with no additional characters</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">child</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${children}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">tsd</span><span class="sc0"> </span><span class="sc10">${child}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc8">ticdisabled</span><span class="sc0"> </span><span class="sc10">${tsd_table_name}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#SET TABLE CONSTRAINTS, TRIGGERS, INDEXES ENABLED for TABLE in reference chain</span><span class="sc0">
</span><span class="sc2">#(Foreign Key) From Parent to Child(ren)</span><span class="sc0">
</span><span class="sc8">tse</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tse_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="/login/lchen/tools/etc/table/load"}</span><span class="sc0">
    </span><span class="sc8">tse_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc8">ticenabled</span><span class="sc0"> </span><span class="sc10">${tse_table_name}</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tse_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc8">children</span><span class="sc7">=</span><span class="sc11">$(grep ${tse_table_name} ${tse_table_dir}/table_relation_$$ |
                cut -f2 -d" "|grep -vix ${tse_table_name})</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">child</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${children}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">tse</span><span class="sc0"> </span><span class="sc10">${child}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Setting (building) reference constraints CONSISTENCY among tables, </span><span class="sc0">
</span><span class="sc2">#On table(s) of the foreign key(s)' owner, rows which cannot find reference</span><span class="sc0">
</span><span class="sc2">#on its parent table(s) must be deleted</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#DELETE FROM &lt;child-table&gt; WHERE &lt;foreign-keys&gt; NOT IN</span><span class="sc0">
</span><span class="sc2">#(SELECT &lt;foreign-keys&gt; FROM &lt;base-table&gt;)</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#DELETE FROM &lt;child-table&gt;</span><span class="sc0">
</span><span class="sc2">#WHERE 0 = (SELECT COUNT(*) FROM &lt;base-table&gt;</span><span class="sc0">
</span><span class="sc2">#WHERE &lt;child-table&gt;.key1 = &lt;base-table&gt;.key1</span><span class="sc0">
</span><span class="sc2">#AND &lt;child-table&gt;.key2 = &lt;base-table&gt;.key2);</span><span class="sc0">
</span><span class="sc8">tcons</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tcons_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tcons_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tcons_server}</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tcons_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tcons_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">tcons_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="/login/lchen/tools/etc/table/load"}</span><span class="sc0">
    </span><span class="sc8">tcons_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tcons_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${tcons_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">parent_table</span><span class="sc0"> </span><span class="sc8">child_table</span><span class="sc0"> </span><span class="sc8">pid</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">delete_sql</span><span class="sc7">=</span><span class="sc5">"${parent_table}_${child_table}_${pid}_del.sql"</span><span class="sc0">
        
        </span><span class="sc8">column</span><span class="sc7">=</span><span class="sc11">$(dbschema -d ${tcons_db} -t ${child_table}|
            awk '{printf $0} /;/{print ""}'| egrep "alter.table"|
            grep ${parent_table}|cut -f3 -d"("|cut -f1 -d")")</span><span class="sc0">
        </span><span class="sc8">columns</span><span class="sc7">=</span><span class="sc5">"$column,"</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"DATABASE ${tcons_db};\n
          DELETE FROM ${child_table}\n
          WHERE 0 = (SELECT COUNT(*) FROM ${parent_table}\n"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${delete_sql}</span><span class="sc0">
        
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">ikey</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">first_key</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">key</span><span class="sc7">=</span><span class="sc11">$(echo $columns|cut -f${ikey} -d",")</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${first_key}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"WHERE ${child_table}.$key = ${parent_table}.$key\n"</span><span class="sc0">  </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${delete_sql}</span><span class="sc0">
                </span><span class="sc8">first_key</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc5">"$key"</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
                </span><span class="sc4">then</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"AND ${child_table}.$key = ${parent_table}.$key\n"</span><span class="sc0">  </span><span class="sc7">\</span><span class="sc0">
                        </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${delete_sql}</span><span class="sc0">
                </span><span class="sc4">else</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">");"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                        </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${delete_sql}</span><span class="sc0">
                
                    </span><span class="sc4">break</span><span class="sc0">
            
                </span><span class="sc4">fi</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
            
        </span><span class="sc8">ikey</span><span class="sc7">=</span><span class="sc8">ikey+1</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">    

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tdel</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tdel_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tdel_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tdel_server}</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tdel_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tdel_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">tdel_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="/login/lchen/tools/etc/table/load"}</span><span class="sc0">
    </span><span class="sc8">tdel_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${tdel_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${tdel_table_dir}</span><span class="sc7">/</span><span class="sc8">table_relation_</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">parent_table</span><span class="sc0"> </span><span class="sc8">child_table</span><span class="sc0"> </span><span class="sc8">pid</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">delete_sql</span><span class="sc7">=</span><span class="sc5">"${parent_table}_${child_table}_${pid}_del.sql"</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        SET CONSTRAINTS,INDEXES FOR ${parent_table} ENABLED; "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tdel_db}</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        SET CONSTRAINTS,INDEXES FOR ${child_table} ENABLED; "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tdel_db}</span><span class="sc0">
        
        </span><span class="sc2">#Deleting records on child-table not match FK constraints</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc10">${delete_sql}</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">    

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Use the Dirty Read option to copy rows from the database whether or not </span><span class="sc0">
</span><span class="sc2">#there are locks on them. The program that fetches a row places no locks </span><span class="sc0">
</span><span class="sc2">#and it respects none. Dirty Read is the only isolation level available </span><span class="sc0">
</span><span class="sc2">#to databases that do not implement transaction logging.</span><span class="sc0">
</span><span class="sc8">tunload</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tunload_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLESOURCE | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tunload_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLESOURCE | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tunload_server}</span><span class="sc0">

    </span><span class="sc8">unload_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc8">unload_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLEUNLOADDIR:="/login/lchen/tools/etc/table/unload"}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${unload_table_dir}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${unload_table_dir}</span><span class="sc0">
    
    </span><span class="sc8">unload_table_file</span><span class="sc7">=</span><span class="sc10">${unload_table_dir}</span><span class="sc7">/</span><span class="sc10">${unload_table_name}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc0">
    </span><span class="sc8">unload_table_bkup</span><span class="sc7">=</span><span class="sc10">${unload_table_dir}</span><span class="sc7">/</span><span class="sc10">${unload_table_name}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">bk</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${unload_table_file}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mv</span><span class="sc0"> </span><span class="sc10">${unload_table_file}</span><span class="sc0"> </span><span class="sc10">${unload_table_bkup}</span><span class="sc0">

</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tunload_db}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOT!</span><span class="sc13">
BEGIN WORK;
SET ISOLATION to DIRTY READ;
UNLOAD TO "${unload_table_file}" SELECT * FROM ${unload_table_name};
COMMIT WORK;
EOT!</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Transfer Table data file from Produciton DB to DEVELOPMENT DB</span><span class="sc0">
</span><span class="sc8">tget</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tget_remote_host</span><span class="sc7">=</span><span class="sc10">${FTPHOST:="ifx01"}</span><span class="sc0">
    </span><span class="sc8">tget_user</span><span class="sc7">=</span><span class="sc10">${FTPUSER:="lchen"}</span><span class="sc0">
    </span><span class="sc8">tget_passwd</span><span class="sc7">=</span><span class="sc10">${FTPPASSWD:="admin12"}</span><span class="sc0">
    </span><span class="sc8">tget_table_dir</span><span class="sc7">=</span><span class="sc10">${FTPLOCALDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tget_remote_dir</span><span class="sc7">=</span><span class="sc10">${FTPREMOTEDIR:="/archbkup/dbbkup/stage"}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"$remote_host"</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">tget_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc8">ftp_get</span><span class="sc0"> </span><span class="sc10">${tget_remote_host}</span><span class="sc0"> </span><span class="sc10">${tget_user}</span><span class="sc0"> </span><span class="sc10">${tget_passwd}</span><span class="sc0"> </span><span class="sc10">${tget_table_dir}</span><span class="sc0"> </span><span class="sc10">${tget_remote_dir}</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${tget_table_name}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc0"> </span><span class="sc10">${tget_table_name}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tput</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tput_remote_host</span><span class="sc7">=</span><span class="sc10">${FTPHOST:="ifx01"}</span><span class="sc0">
    </span><span class="sc8">tput_user</span><span class="sc7">=</span><span class="sc10">${FTPUSER:="lchen"}</span><span class="sc0">
    </span><span class="sc8">tput_passwd</span><span class="sc7">=</span><span class="sc10">${FTPPASSWD:="admin12"}</span><span class="sc0">
    </span><span class="sc8">tput_table_dir</span><span class="sc7">=</span><span class="sc10">${FTPLOCALDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tput_remote_dir</span><span class="sc7">=</span><span class="sc10">${FTPREMOTEDIR:="/archbkup/dbbkup/stage"}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"$remote_host"</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">tput_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc10">${tput_remote_host}</span><span class="sc0"> </span><span class="sc10">${tput_user}</span><span class="sc0"> </span><span class="sc10">${tput_passwd}</span><span class="sc0"> </span><span class="sc10">${tput_table_dir}</span><span class="sc0"> </span><span class="sc10">${tput_remote_dir}</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${tput_table_name}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc0"> </span><span class="sc10">${tput_table_name}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Split data file if it's so huge!!!</span><span class="sc0">
</span><span class="sc2">#It's also a good idea if you do not want to load huge table due to</span><span class="sc0">
</span><span class="sc2">#system resorce limit, just split data file to smaller ones, and load</span><span class="sc0">
</span><span class="sc2">#them one by one.</span><span class="sc0">
</span><span class="sc8">tsplit</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">wc</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc10">${load_table_file}</span><span class="sc0">
    </span><span class="sc4">split</span><span class="sc0"> </span><span class="sc8">-l</span><span class="sc0"> </span><span class="sc10">${lines}</span><span class="sc0"> </span><span class="sc10">${load_table_file}</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">tload</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">tload_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tload_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tload_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tload_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tload_server}</span><span class="sc0">
    
    </span><span class="sc8">tload_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tload_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    </span><span class="sc8">tload_table_file</span><span class="sc7">=</span><span class="sc10">${tload_table_dir}</span><span class="sc7">/</span><span class="sc10">${tload_table_name}</span><span class="sc7">.</span><span class="sc10">${current_date}</span><span class="sc0">
                
</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tload_db}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOT!</span><span class="sc13">
BEGIN WORK;
LOAD FROM "${tload_table_file}" INSERT INTO ${tload_table_name};
COMMIT WORK;
EOT!</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#After table load, run update statistics against the DB</span><span class="sc0">
</span><span class="sc8">tus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tus_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tus_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc2">#[[ ${tus_server} == "ipdb" ]] &amp;&amp; return 119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tus_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tus_server}</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"update statistics"</span><span class="sc7">|</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tus_db}</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"upstat done!"</span><span class="sc0"> </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Calculate table size, check if you have enough physical and logical log space</span><span class="sc0">
</span><span class="sc2">#in case DB server rollback you transaction.</span><span class="sc0">
</span><span class="sc8">tsize</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tsize_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tsize_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tsize_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tsize_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tsize_server}</span><span class="sc0">
    
    </span><span class="sc2">#run update statistics before colculate table size</span><span class="sc0">
    </span><span class="sc8">tus</span><span class="sc0">
    
    </span><span class="sc8">size_table</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">

    </span><span class="sc8">rowsize</span><span class="sc7">=</span><span class="sc11">$(echo "
         select rowsize from systables 
         where tabname = '${size_table}'" |
         dbaccess ${tsize_db} | grep -v rowsize)</span><span class="sc0">
        
    </span><span class="sc8">nrows</span><span class="sc7">=</span><span class="sc11">$(echo "
         select nrows from systables 
         where tabname = '${size_table}'" |
         dbaccess ${tsize_db} | grep -v nrows)</span><span class="sc0">
        
    </span><span class="sc8">size</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc8">rowsize</span><span class="sc7">*</span><span class="sc8">nrows</span><span class="sc7">/</span><span class="sc3">1024</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    
    </span><span class="sc8">logfiles</span><span class="sc7">=</span><span class="sc11">$(onstat -c | grep ^LOGFILES | awk '{print $2}')</span><span class="sc0">
    </span><span class="sc8">logsize</span><span class="sc7">=</span><span class="sc11">$(onstat -c | grep ^LOGSIZE | awk '{print $2}')</span><span class="sc0">
    </span><span class="sc8">ltxhwm</span><span class="sc7">=</span><span class="sc11">$(onstat -c | grep ^LTXHWM | awk '{print $2}')</span><span class="sc0">
    
    </span><span class="sc8">rollback</span><span class="sc7">=$((</span><span class="sc0"> </span><span class="sc8">logfiles</span><span class="sc7">*</span><span class="sc8">logsize</span><span class="sc7">*</span><span class="sc8">ltxhwm</span><span class="sc7">/</span><span class="sc3">100</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$rowsize</span><span class="sc0"> </span><span class="sc9">$nrows</span><span class="sc0"> </span><span class="sc9">$size</span><span class="sc0">
    </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc10">${size}</span><span class="sc0">
         
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Load table, and recontructure data in related tables according to FK reference</span><span class="sc0">
</span><span class="sc8">tcopy</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">tcopy_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tcopy_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tcopy_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tcopy_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tcopy_server}</span><span class="sc0">
    
    </span><span class="sc8">tcopy_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tcopy_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc2">#Get data file from remote server   </span><span class="sc0">
    </span><span class="sc2">#tget ${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Disconnect all sessions during table copy</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">uy</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0">
    
    </span><span class="sc8">trelation</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Generates table DDL</span><span class="sc0">
    </span><span class="sc8">tddl</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    </span><span class="sc8">tcons</span><span class="sc0">
    
    </span><span class="sc2">#SET TABLE CONSTRAINTS, TRIGGERS, INDEXES DISABLED</span><span class="sc0">
    </span><span class="sc8">tsd</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Backup table before truncate it</span><span class="sc0">
    </span><span class="sc8">tunload</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Delete all records </span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tcopy_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tcopy_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"truncate ${tcopy_table_name}"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tcopy_db}</span><span class="sc0">
        
    </span><span class="sc2">#Load all records</span><span class="sc0">
    </span><span class="sc8">tload</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#On table(s) of the foreign key(s)' owner, rows must which cannot find reference</span><span class="sc0">
    </span><span class="sc2">#on its parent table(s) must be deleted, if long transaction failure due to huge</span><span class="sc0">
    </span><span class="sc2">#data on deleted table, you may have to change whole database log mode to "nolog"</span><span class="sc0">
    </span><span class="sc8">tdel</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#SET TABLE CONSTRAINTS, TRIGGERS, INDEXES ENABLED</span><span class="sc0">
    </span><span class="sc8">tse</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Double check INDEX,CONSTRAINT and TRIGGERS status are all ENABLED</span><span class="sc0">
    </span><span class="sc2">#in the "sysobjstate" system catalog table with status 'E'</span><span class="sc0">
    </span><span class="sc8">tshow</span><span class="sc0"> </span><span class="sc10">${tcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#The server is blocking transactions because the physical log is too small</span><span class="sc0">
    </span><span class="sc2">#Based on the current workload, to prevent the server from blocking future</span><span class="sc0">
    </span><span class="sc2">#transactions, increase the size of the physical log to 110040 KB</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">ckp</span><span class="sc0">
    
    </span><span class="sc2">#onparams -p -s 110040 -d rootdbs -y</span><span class="sc0">
    </span><span class="sc2">#onstat -l</span><span class="sc0">
    
    </span><span class="sc2">#After table load, run update statistics against the DB</span><span class="sc0">
    </span><span class="sc8">tus</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#######################################################################################</span><span class="sc0">
</span><span class="sc2">#  Filename    : large_table.ksh</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Author      : Liru Chen</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Description  :   </span><span class="sc0">
</span><span class="sc2">#  Load data for a group of related tables from Production DB to DEVELOPMENT DB</span><span class="sc0">
</span><span class="sc2">#  using no log raw table</span><span class="sc0">
</span><span class="sc2">#   1. Tables are listed in &lt;loadtables&gt;, in sequence like:</span><span class="sc0">
</span><span class="sc2">#             &lt;child-table&gt; </span><span class="sc0">
</span><span class="sc2">#             ....</span><span class="sc0">
</span><span class="sc2">#             &lt;base-table&gt;</span><span class="sc0">
</span><span class="sc2">#      Prepare &lt;loadtables&gt; carefully, it's the start-point of this tool</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   2. For raw TYPE table, INDEX is OK, but No referential(foreign key), </span><span class="sc0">
</span><span class="sc2">#      or unique constraints(primary key) is allowed</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#          ALTER TABLE &lt;tablename&gt; DROP CONSTRAINT &lt;Reference name(rNum)&gt;</span><span class="sc0">
</span><span class="sc2">#          ALTER TABLE &lt;tablename&gt; DROP CONSTRAINT &lt;Primary KeyName(uNum)&gt; </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#          notice: rNum and uNum are generated by INFORMIX automatically</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   3. Re-Build reference, if Failure to satisfy referential constraint</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#          DELETE FROM &lt;child-table&gt; WHERE &lt;foreign-keys&gt; NOT IN</span><span class="sc0">
</span><span class="sc2">#          (SELECT &lt;foreign-keys&gt; FROM &lt;base-table&gt;)</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#          or, you may need following when table is so huge or reference condition</span><span class="sc0">
</span><span class="sc2">#          is complex,</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#          DELETE FROM &lt;child-table&gt;</span><span class="sc0">
</span><span class="sc2">#          WHERE 0 = (SELECT COUNT(*) FROM &lt;base-table&gt;</span><span class="sc0">
</span><span class="sc2">#          WHERE &lt;child-table&gt;.key1 = &lt;base-table&gt;.key1</span><span class="sc0">
</span><span class="sc2">#          AND &lt;child-table&gt;.key2 = &lt;base-table&gt;.key2);</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   4. ENABLE ALL the index,constraint and trigger, and double check their status</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Date : 2015-05-15</span><span class="sc0">
</span><span class="sc2">#                </span><span class="sc0">
</span><span class="sc2">########################################################################################</span><span class="sc0">
</span><span class="sc2">#Phase I: Collect/generate DDL for table's CONSTRAINTS,INDEXES,TRIGGERS </span><span class="sc0">

</span><span class="sc2">#Phase II: unload data for roll back if needed, example:</span><span class="sc0">
</span><span class="sc2">#lii_client - tariff</span><span class="sc0">
</span><span class="sc2">#       |</span><span class="sc0">
</span><span class="sc2">#   lii_account ---&gt; user_locus_xref</span><span class="sc0">
</span><span class="sc2">#                       | </span><span class="sc0">
</span><span class="sc2">#   client --------&gt; securuser -&gt; search_criteria</span><span class="sc0">
</span><span class="sc2">#                       | ------&gt; srchcrit_batch</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#   &lt;---- table unload sequence (direction)</span><span class="sc0">
</span><span class="sc2">#   table load sequence (direction) ----&gt;</span><span class="sc0">


</span><span class="sc2">#Phase III: Raw TABLE</span><span class="sc0">
</span><span class="sc2">#RAW tables are nonlogging permanent tables that are similar to tables in a nonlogging database.</span><span class="sc0">
</span><span class="sc2">#Update, insert, and delete operations on rows in a RAW table are supported but are not logged. </span><span class="sc0">
</span><span class="sc2">#You can define indexes on RAW tables, but you cannot define unique constraints, primary-key </span><span class="sc0">
</span><span class="sc2">#constraints, or referential constraints on RAW tables. Light appends are not supported for </span><span class="sc0">
</span><span class="sc2">#loading RAW tables, except in High-Performance Loader (HPL) operations and in queries that </span><span class="sc0">
</span><span class="sc2">#specify INTO TEMP ... WITH NO LOG. </span><span class="sc0">

</span><span class="sc2">#RAW tables are intended for the initial loading and validation of data. To load RAW tables, </span><span class="sc0">
</span><span class="sc2">#you can use any loading utility, including dbexport, the LOAD statement of DB-Access, </span><span class="sc0">
</span><span class="sc2">#or the HPL in express mode. If an error or failure occurs while loading a RAW table, the </span><span class="sc0">
</span><span class="sc2">#resulting data is whatever was on the disk at the time of the failure.</span><span class="sc0">

</span><span class="sc2">#Phase IV: DROP PRIMARY KEYS AND REFERENCE KEYS CONSTRAINTS, ALTER TYPE(RAW)</span><span class="sc0">
</span><span class="sc8">traw</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">traw_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">traw_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${traw_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${traw_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${traw_server}</span><span class="sc0">
    
    </span><span class="sc8">traw_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">traw_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${traw_db}</span><span class="sc0"> </span><span class="sc10">${traw_table_dir}</span><span class="sc7">/</span><span class="sc10">${traw_table_name}</span><span class="sc8">_drop_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${traw_db}</span><span class="sc0"> </span><span class="sc10">${traw_table_dir}</span><span class="sc7">/</span><span class="sc10">${traw_table_name}</span><span class="sc8">_drop_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
    ALTER TABLE ${traw_table_name} TYPE(RAW); "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${traw_db}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Phase V: LOAD TABLE</span><span class="sc0">

</span><span class="sc2">#Phase VI: ALTER TABLE TYPE(STANDARD)</span><span class="sc0">

</span><span class="sc2">#Restriction: Do not use RAW tables within a transaction. After you have loaded the data, </span><span class="sc0">
</span><span class="sc2">#use the ALTER TABLE statement to change the table to type STANDARD and perform a level-0 backup</span><span class="sc0">
</span><span class="sc2">#before you use the table in a transaction.</span><span class="sc0">
</span><span class="sc8">tstdd</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tstdd_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tstdd_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tstdd_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tstdd_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tstdd_server}</span><span class="sc0">

    </span><span class="sc8">tstdd_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
    ALTER TABLE ${tstdd_table_name} TYPE(STANDARD); "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tstdd_db}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Re-Build primary-key constraints on raw table which is just turn to standard</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc8">tprim</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tprim_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tprim_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tprim_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tprim_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tprim_server}</span><span class="sc0">
    
    </span><span class="sc8">tprim_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">tprim_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${tprim_table_dir}</span><span class="sc0">
    
    </span><span class="sc2">#cat *_create_primarykey_$$.sql &gt; create_primarykey_all_$$.sql</span><span class="sc0">
    </span><span class="sc2">#dbaccess ${tprim_db} create_primarykey_all_$$.sql</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tprim_db}</span><span class="sc0"> </span><span class="sc10">${tprim_table_name}</span><span class="sc8">_create_primarykey_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Re-Build foreign-keys referential constraints on all related tables</span><span class="sc0">
</span><span class="sc8">tfk</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">tfk_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">tfk_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${tfk_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${tfk_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${tfk_server}</span><span class="sc0">
    
    </span><span class="sc8">tfk_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${tfk_table_dir}</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">*</span><span class="sc8">_create_reference_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">create_reference_all_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${tfk_db}</span><span class="sc0"> </span><span class="sc8">create_reference_all_</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Large table Load, and recontructure data in related tables according to FK reference</span><span class="sc0">
</span><span class="sc8">ltcopy</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">ltcopy_server</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f1 -d",")</span><span class="sc0">
    </span><span class="sc8">ltcopy_db</span><span class="sc7">=</span><span class="sc11">$(echo $TABLETARGET | cut -f2 -d",")</span><span class="sc0">
    
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${ltcopy_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${ltcopy_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">

    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${ltcopy_server}</span><span class="sc0">
    
    </span><span class="sc8">ltcopy_table_dir</span><span class="sc7">=</span><span class="sc10">${TABLELOADDIR:="$ETC/table/load"}</span><span class="sc0">
    </span><span class="sc8">ltcopy_table_name</span><span class="sc7">=</span><span class="sc10">${1-"securuser"}</span><span class="sc0">
    
    </span><span class="sc2">#Get data file from remote server</span><span class="sc0">
    </span><span class="sc2">#tget ${ltcopy_table_name}</span><span class="sc0">
        

    </span><span class="sc2">#Disconnect all sessions during table copy</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">uy</span><span class="sc0">
    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0">

    </span><span class="sc8">trelation</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Get load table DDL</span><span class="sc0">
    </span><span class="sc8">tddl</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">
    </span><span class="sc8">tcons</span><span class="sc0">
    
    </span><span class="sc2">#SET TABLE CONSTRAINTS, TRIGGERS, INDEXES DISABLED</span><span class="sc0">
    </span><span class="sc8">tsd</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Backup table before truncate it</span><span class="sc0">
    </span><span class="sc8">tunload</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Delete all records </span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${ltcopy_server}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">119</span><span class="sc0">
    </span><span class="sc2">#[[ ${ltcopy_server} == "systestdb" ]] &amp;&amp; return 110</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"truncate ${ltcopy_table_name}"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${ltcopy_db}</span><span class="sc0">
    
    </span><span class="sc2">#Set table to raw type</span><span class="sc0">
    </span><span class="sc8">traw</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#Load all records</span><span class="sc0">
    </span><span class="sc8">tload</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Set table to normal after huge data loading</span><span class="sc0">
    </span><span class="sc8">tstdd</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Build PRIMARY Key for load table, which is need to accelerate tdel process</span><span class="sc0">
    </span><span class="sc8">tprim</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#On table(s) of the foreign key(s)' owner, rows must which cannot find reference</span><span class="sc0">
    </span><span class="sc2">#on its parent table(s) must be deleted, if long transaction failure due to huge</span><span class="sc0">
    </span><span class="sc2">#data on deleted table, you may have to change whole database log mode to "nolog"</span><span class="sc0">
    </span><span class="sc8">tdel</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Build foreign-keys constraints for load table</span><span class="sc0">
    </span><span class="sc8">tfk</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#SET TABLE CONSTRAINTS, TRIGGERS, INDEXES ENABLED</span><span class="sc0">
    </span><span class="sc8">tse</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">

    </span><span class="sc2">#Double check INDEX,CONSTRAINT and TRIGGERS status are all ENABLED</span><span class="sc0">
    </span><span class="sc2">#in the "sysobjstate" system catalog table with status 'E'</span><span class="sc0">
    </span><span class="sc8">tshow</span><span class="sc0"> </span><span class="sc10">${ltcopy_table_name}</span><span class="sc0">
    
    </span><span class="sc2">#The server is blocking transactions because the physical log is too small</span><span class="sc0">
    </span><span class="sc2">#Based on the current workload, to prevent the server from blocking future</span><span class="sc0">
    </span><span class="sc2">#transactions, increase the size of the physical log to 110040 KB</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">ckp</span><span class="sc0">
    
    </span><span class="sc2">#onparams -p -s 110040 -d rootdbs -y</span><span class="sc0">
    </span><span class="sc2">#onstat -l</span><span class="sc0">
    
    </span><span class="sc2">#After table load, run update statistics against the DB</span><span class="sc0">
    </span><span class="sc8">tus</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">


</span><span class="sc2">#Application</span><span class="sc0">


</span><span class="sc2">#INFORMIX CONFIGURATION FILES BACKUP</span><span class="sc0">
</span><span class="sc8">bkiconf</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${1-"systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">
        
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$ETC</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$ETC</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$ETC</span><span class="sc0">
    
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$ids_env</span><span class="sc0"> </span><span class="sc8">IDSENV.</span><span class="sc10">${ids_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$INFORMIXDIR</span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc9">$ONCONFIG</span><span class="sc0"> </span><span class="sc8">ONCONFIG.</span><span class="sc10">${ids_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$INFORMIXDIR</span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">sqlhosts</span><span class="sc0"> </span><span class="sc8">SQLHOSTS.</span><span class="sc10">${ids_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">etc</span><span class="sc7">/</span><span class="sc8">services</span><span class="sc0"> </span><span class="sc8">SERVICES.</span><span class="sc10">${ids_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">IDSSTORAGE.</span><span class="sc10">${ids_server}</span><span class="sc7">.</span><span class="sc11">$(hostname)</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc2"># Purpose: Used to start INFORMIX services</span><span class="sc0">
</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc8">start_ids</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">

    </span><span class="sc2">#ps -ef|grep -v "grep"|grep oninit</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"On-Line"</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0"> 
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) INFORMIX ${ids_server} STILL RUNNING!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">   </span><span class="sc2">#exit 0</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc2">#Start IDS Server ${ids_server}</span><span class="sc0">
    </span><span class="sc8">oninit</span><span class="sc0"> </span><span class="sc8">-w</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc0">    </span><span class="sc2">#Returns 1 if the server fails to initialize within 60 seconds</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"INFORMIX START IS NOT COMPLETED ...\n"</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) ERROR START INFORMIX ${ids_server}!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">   </span><span class="sc2">#exit 1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) INFORMIX ${ids_server} START!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc2">#exit 0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">##############################################################################</span><span class="sc0">
</span><span class="sc2"># Purpose: start LOCUS services</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2"># If loucs cannot be started, it could be locus NOT stop properly, </span><span class="sc0">
</span><span class="sc2"># using following tools to clear locus share memory</span><span class="sc0">
</span><span class="sc2">#   1. ipcs, to find share memory location of ipgown</span><span class="sc0">
</span><span class="sc2">#   2. ipcrm -rm &lt;&gt;, to clear locus share memory</span><span class="sc0">
</span><span class="sc2">##############################################################################</span><span class="sc0">
</span><span class="sc8">start_locus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'ipgown'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be ipgown user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">apps</span><span class="sc7">/</span><span class="sc8">ipg</span><span class="sc7">/</span><span class="sc8">ver001</span><span class="sc7">/</span><span class="sc8">srv</span><span class="sc7">/</span><span class="sc8">locus</span><span class="sc0">
    </span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">./</span><span class="sc8">setenv.locus</span><span class="sc0">

    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"grep"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">./</span><span class="sc8">tcl</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"TCL IS STILL RUNNING, IT IS UNUSUAL ...\n"</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) TCL IS RUNNING UNUSUAL!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"VERIFY WHETHER LOCUS SERVICE HAS BEEN SHUTDOWN COMPLETELY ....\n"</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">locus</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"grep"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"loc_restart"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"start_locus"</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"LOCUS SHUTDOWN IS NOT COMPLETED ...\n"</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOCUS STILL RUNNING!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"LOCUS SERVICES SHUTDOWN HAS COMPLETED.\n"</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"... RESTART SERVICES IN PROGRESS ...\n"</span><span class="sc0">
    </span><span class="sc8">tmboot</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"VERIFY LOCUS SERVICES ....\n"</span><span class="sc0"> 
    </span><span class="sc8">count</span><span class="sc7">=</span><span class="sc11">`ps -ef|grep locus|grep -v "grep"|grep -v "loc_restart"|grep -v "start_locus"|wc -l`</span><span class="sc0"> 
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$count</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">16</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"WE HAVE DIFFICULTY TO RESTART LOCUS SERVICES ...\n"</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) ERROR START LOCUS SERVICES!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOCUS SERVICES START `date`"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

</span><span class="sc2">#exit 0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc2"># Purpose: Stop LOCUS services </span><span class="sc0">
</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc8">stop_locus</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'ipgown'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be ipgown user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">apps</span><span class="sc7">/</span><span class="sc8">ipg</span><span class="sc7">/</span><span class="sc8">ver001</span><span class="sc7">/</span><span class="sc8">srv</span><span class="sc7">/</span><span class="sc8">locus</span><span class="sc0">
    </span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">./</span><span class="sc8">setenv.locus</span><span class="sc0">

    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"grep"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">./</span><span class="sc8">tcl</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"TCL IS STILL RUNNING, IT IS UNUSUAL ...\n"</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) TCL IS RUNNING UNUSUAL!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">  </span><span class="sc2">#exit 1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"VERIFY WHETHER LOCUS SERVICE HAS BEEN SHUTDOWN COMPLETELY ....\n"</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">locus</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"grep"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"loc_restart"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"stop_locus"</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOCUS ALREADY DOWN!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">  </span><span class="sc2">#exit 0</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"SHUTDOWN LOCUS SERVICES IN PROGRESS .....\n\n\n"</span><span class="sc0">
    </span><span class="sc8">tmshutdown</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">y</span><span class="sc0">
    </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">60</span><span class="sc0">

    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">locus</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"grep"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"loc_restart"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"stop_locus"</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOCUS SERVICES NOT STOPPED PROPERLY!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">  </span><span class="sc2">#exit 0</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) LOCUS SERVICES STOPPED"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc2">#exit 0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc2"># Purpose: Stop INFORMIX services</span><span class="sc0">
</span><span class="sc2">########################################################</span><span class="sc0">
</span><span class="sc8">stop_ids</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
      </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
      </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">

    </span><span class="sc2">#ps -ef|grep -v "grep"|grep oninit</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"On-Line"</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0"> 
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"INFORMIX ${ids_server} IS RUNNING!"</span><span class="sc0"> 
        </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ky</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) INFORMIX STOP FAILED"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">  </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">  </span><span class="sc2">#exit 1</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) INFORMIX ${ids_server} STOPPED!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc2">#exit 0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">insight_start_now</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'root'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"START INFORMIX SERVICE..."</span><span class="sc0">
    </span><span class="sc4">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$BASE/shlib start_ids"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc8">start_insight.log</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"START LOCUS SERVICES..."</span><span class="sc0">
    </span><span class="sc4">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">ipgown</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$BASE/shlib start_locus"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc8">start_insight.log</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">insight_stop_now</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'root'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be root user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Stop locus services..."</span><span class="sc0">
    </span><span class="sc4">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">ipgown</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$BASE/shlib stop_locus"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc8">stop_insight.log</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Stop informix service..."</span><span class="sc0">
    </span><span class="sc4">su</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc8">-c</span><span class="sc0"> </span><span class="sc5">"$BASE/shlib stop_ids"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc8">stop_insight.log</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Check informix dbspace usage, make sure there is at least one free chunk on </span><span class="sc0">
</span><span class="sc2">#each dbspace and email to DBA when no free chunk</span><span class="sc0">
</span><span class="sc8">chchunk</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${1-"systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">

    </span><span class="sc2">#Check chunk free page daily</span><span class="sc0">
    </span><span class="sc8">oncheck</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">pr</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"Chunk path"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_chunkpath</span><span class="sc0">
    </span><span class="sc8">oncheck</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">pr</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"Number of free pages"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_chunkusage</span><span class="sc0">
    
    </span><span class="sc4">paste</span><span class="sc0"> </span><span class="sc8">tmp_chunkpath</span><span class="sc0"> </span><span class="sc8">tmp_chunkusage</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_chunk</span><span class="sc0">
    </span><span class="sc4">diff</span><span class="sc0"> </span><span class="sc8">tmp_chunk.old</span><span class="sc0"> </span><span class="sc8">tmp_chunk</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">chunk.mail</span><span class="sc0">

    </span><span class="sc2">#send out alert email if final chunk of each dbspace started</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">dat</span><span class="sc9">$i</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc3">249997</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(hostname) datadbs$i FULL, ADD CHUNK IMMEDIATELY"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">chunk.mail</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">idx</span><span class="sc9">$i</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc3">249997</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(hostname) indxdbs$i FULL, ADD CHUNK IMMEDIATELY"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">chunk.mail</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) CHUNK PAGE USAGE CHANGE(OLD-NEW)"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">chunk.mail</span><span class="sc0">
    </span><span class="sc4">mv</span><span class="sc0"> </span><span class="sc8">tmp_chunk</span><span class="sc0"> </span><span class="sc8">tmp_chunk.old</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################</span><span class="sc0">
</span><span class="sc2">#Name:  ontape_s</span><span class="sc0">
</span><span class="sc2">#       Level 0 ontape backup</span><span class="sc0">
</span><span class="sc2">###########################################################</span><span class="sc0">
</span><span class="sc8">ontape_s</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">bkup_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${bkup_server}</span><span class="sc0">
    
    </span><span class="sc8">bkup_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">bkup_dir</span><span class="sc7">=</span><span class="sc10">${IDSBKDIR:="/dbbkup"}</span><span class="sc0">
    </span><span class="sc8">bkup_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc10">${bkup_server}</span><span class="sc8">_ONTAPE_L0.</span><span class="sc10">${bkup_date}</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">   

    </span><span class="sc8">db_image</span><span class="sc7">=</span><span class="sc10">${bkup_dir}</span><span class="sc7">/</span><span class="sc10">${bkup_server}</span><span class="sc8">_ONTAPE_L0.</span><span class="sc10">${bkup_date}</span><span class="sc0">
    </span><span class="sc2">#db_image=/dev/null</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${bkup_dir}</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc10">${bkup_server}</span><span class="sc8">_ONTAPE_L0</span><span class="sc7">*</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$db_image</span><span class="sc0">
    </span><span class="sc4">chown</span><span class="sc0"> </span><span class="sc8">informix</span><span class="sc7">:</span><span class="sc8">informix</span><span class="sc0"> </span><span class="sc9">$db_image</span><span class="sc0">
    </span><span class="sc4">chmod</span><span class="sc0"> </span><span class="sc3">660</span><span class="sc0"> </span><span class="sc9">$db_image</span><span class="sc0">

</span><span class="sc8">ontape</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc8">-L</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc9">$db_image</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${bkup_log}</span><span class="sc0">  </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc13">
^M
^M
EOF</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nERROR: DATABASE BACKUP FAILED"</span><span class="sc0"> 
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) ${bkup_server} BACKUP FAILED!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">202</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">bkiconf</span><span class="sc0"> </span><span class="sc10">${bkup_server}</span><span class="sc0">
    </span><span class="sc8">chchunk</span><span class="sc0"> </span><span class="sc10">${bkup_server}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$log_bkup</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) ${bkup_server} BACKUP DONE!"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc10">${bkup_log}</span><span class="sc0">

</span><span class="sc2">#exit 0</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#################################################################</span><span class="sc0">
</span><span class="sc2">#Name:  ontape_r</span><span class="sc0">
</span><span class="sc2">#       ontape restore INFORMIX DBSERVER from level 0 backup</span><span class="sc0">
</span><span class="sc2">#################################################################</span><span class="sc0">
</span><span class="sc8">ontape_r</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$USER</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc6">'informix'</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"You should be informix user"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">201</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">restore_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${restore_server}</span><span class="sc0">

    </span><span class="sc8">restore_log</span><span class="sc7">=</span><span class="sc10">${LOG}</span><span class="sc7">/</span><span class="sc10">${restore_server}</span><span class="sc8">_RESTORE_L0.</span><span class="sc9">$restore_date</span><span class="sc7">.</span><span class="sc8">log</span><span class="sc0">

    </span><span class="sc8">restore_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M)</span><span class="sc0">
    </span><span class="sc8">restore_dir</span><span class="sc7">=</span><span class="sc10">${IDSBKDIR:="/dbbkup"}</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$restore_dir</span><span class="sc0">
    </span><span class="sc2">#mv ${restore_server}_ONTAPE_L0* ${restore_server}_RESTORE_L0</span><span class="sc0">

    </span><span class="sc2">#ontape -r -t ${restore_server}_RESTORE_L0 -v|tee -a ${restore_log}</span><span class="sc0">
    </span><span class="sc8">ontape</span><span class="sc0"> </span><span class="sc8">-r</span><span class="sc0"> </span><span class="sc8">-t</span><span class="sc0"> </span><span class="sc8">ipdb_bkup_L0.201510240001</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc7">|</span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) DATABASE RESTORE FAILED"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0">
        </span><span class="sc2">#exit 1</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc8">onmode</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">m</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${restore_log}</span><span class="sc0">

    </span><span class="sc2"># A message informs you when the restore is complete.</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"RESTORE COMPLETED SUCCESSFULLY, PLEASE CHECK THE MAIL ...\n"</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) INFORMIX DATABASE RESTORE SUCCESSFUL"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$restore_log</span><span class="sc0">

    </span><span class="sc2">#exit 0 </span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">##########################################################################</span><span class="sc0">
</span><span class="sc2"># Trace/Collect SQL statements on Livingston Production INFORMIX database</span><span class="sc0">
</span><span class="sc2"># while TEXUDO loading Data from VMS system</span><span class="sc0">
</span><span class="sc2">##########################################################################</span><span class="sc0">
</span><span class="sc8">tlsql</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    
    </span><span class="sc8">dmq</span><span class="sc7">=(</span><span class="sc11">$(ps -ef|grep -v grep|grep ./tcl|awk '{print $9}')</span><span class="sc7">)</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${#dmq[@]}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">    </span><span class="sc2">#number of RUNNING DMQ is zero</span><span class="sc0">
    
    </span><span class="sc8">dmqpid</span><span class="sc7">=</span><span class="sc11">$(ps -ef|grep -v grep|grep ./tcl|awk '{print $2}')</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------"</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" DATA LOADER PROCESS"</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"--------------------"</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"DMQ:"</span><span class="sc0"> </span><span class="sc10">${dmq[@]}</span><span class="sc0">           </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$dmqpid</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\nCURRENT DMQ PID $i "</span><span class="sc0">        </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc8">session</span><span class="sc7">=</span><span class="sc11">$(onstat -g ses|grep $i|cut -f1 -d" ")</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"CURRENT SESSION ID $session "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$session</span><span class="sc0">      </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">icc</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $2}'</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">iccpid</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n-----------------------"</span><span class="sc0">    </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" ICC JAVA LOADER PROCESS"</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"------------------------"</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"ICC PID LIST: $iccpid    "</span><span class="sc0">    </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" "</span><span class="sc0">                            </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc8">iccses</span><span class="sc7">=</span><span class="sc11">$( onstat -g ses|grep "1       ifx01"|cut -f1 -d" " )</span><span class="sc0">
        </span><span class="sc2">#iccses=$(onstat -g ses|grep $iccpid|cut -f1 -d" ")</span><span class="sc0">
        </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$iccses</span><span class="sc0">               </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc8">tuxedo</span><span class="sc7">=</span><span class="sc11">$( onstat -g ses|grep ifx01|cut -f1 -d" " )</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\n-----------------------"</span><span class="sc0">    </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" TUXEDO LOADER PROCESS "</span><span class="sc0">      </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"-------------------------"</span><span class="sc0">    </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">k</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$tuxedo</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0"> 
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"LOCAL TUXEDO SERVICE SESSION $k "</span><span class="sc0">     </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
            </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-g</span><span class="sc0"> </span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$k</span><span class="sc0">                </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">tee</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_TUXEDO_LOAD_SQL_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">

    </span><span class="sc2">#remove</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_tls</span><span class="sc9">$$</span><span class="sc7">.</span><span class="sc8">txt</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Identify B3 archive database name based on data archive year and month</span><span class="sc0">
</span><span class="sc2">#This function need to be modified when database reused</span><span class="sc0">
</span><span class="sc8">b3_ardb</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">month</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2008</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">    </span><span class="sc2">#arch_db=ip_arch01@ardb</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">    </span><span class="sc2">#arch_db=ip_arch02@ardb</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2009</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch02@ardb</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2010</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">04</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch02@ardb</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch03@ardb</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2011</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch03@ardb</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch04@ardb</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2012</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch04@ardb</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2013</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">04</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch04@ardb</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch05@ardb</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
        
    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2014</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$month</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">le</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch05@ardb</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch01@ardb</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">elif</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">2015</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">        </span><span class="sc2">#arch_db=ip_arch01@ardb</span><span class="sc0">
        
    </span><span class="sc4">fi</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Start INFORMIX Archive database server as root user on ifx01</span><span class="sc0">
</span><span class="sc2"># 1. . /home/informix/ids115.env ardb</span><span class="sc0">
</span><span class="sc2"># 2. oninit</span><span class="sc0">
</span><span class="sc2"># 3. Please re-check referenced sample files: /home/lchen/tools/db/informix/download/CLIENT_SAMPLE.sql and entry.head</span><span class="sc0">
</span><span class="sc2">#    are correctly located under /home/lchen/tools/tmp/$client_number</span><span class="sc0">
</span><span class="sc2">#    and contents are correct</span><span class="sc0">
</span><span class="sc2"># </span><span class="sc0">
</span><span class="sc2"># Example:</span><span class="sc0">
</span><span class="sc2"># client 202817, please provide the B3 data where the b3 is between  November 2011 to December 2013</span><span class="sc0">
</span><span class="sc2"># $/home/lchen/tools/shlib b3_arch_download 2011 2013 11 12</span><span class="sc0">
</span><span class="sc2"># result: /home/lchen/tools/tmp/202817</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#Stop INFORMIX Archive database, firstly double check your shell environment parameters</span><span class="sc0">
</span><span class="sc2">#point to archive database: ardb</span><span class="sc0">
</span><span class="sc2"># 1. echo $INFORMIXSERVER, the output should be ardb !!!</span><span class="sc0">
</span><span class="sc2"># 2. onmode -ky</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc8">b3_arch_download</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"Parameter less than five"</span><span class="sc0">
        </span><span class="sc4">return</span><span class="sc0"> </span><span class="sc3">205</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">
    
    </span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">lchen</span><span class="sc7">/</span><span class="sc8">ids115.env</span><span class="sc0"> </span><span class="sc8">ardb</span><span class="sc0">
    
    </span><span class="sc8">client_number</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">year_start</span><span class="sc7">=</span><span class="sc9">$2</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">year_end</span><span class="sc7">=</span><span class="sc9">$3</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">month_start</span><span class="sc7">=</span><span class="sc9">$4</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">month_end</span><span class="sc7">=</span><span class="sc9">$5</span><span class="sc0">
    
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc9">$year_start</span><span class="sc0">
    </span><span class="sc8">month</span><span class="sc7">=(</span><span class="sc3">00</span><span class="sc0"> </span><span class="sc3">01</span><span class="sc0"> </span><span class="sc3">02</span><span class="sc0"> </span><span class="sc3">03</span><span class="sc0"> </span><span class="sc3">04</span><span class="sc0"> </span><span class="sc3">05</span><span class="sc0"> </span><span class="sc3">06</span><span class="sc0"> </span><span class="sc3">07</span><span class="sc0"> </span><span class="sc3">08</span><span class="sc0"> </span><span class="sc3">09</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc3">11</span><span class="sc0"> </span><span class="sc3">12</span><span class="sc7">)</span><span class="sc0">

    </span><span class="sc8">b3_arch_resource_dir</span><span class="sc7">=</span><span class="sc5">"/home/lchen/tools/db/informix/download"</span><span class="sc0">
    
    </span><span class="sc8">b3_arch_result_dir</span><span class="sc7">=</span><span class="sc10">${TMP}</span><span class="sc7">/</span><span class="sc10">${client_number}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc10">${b3_arch_result_dir}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${b3_arch_result_dir}</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${b3_arch_result_dir}</span><span class="sc0">
    
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year_start</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$year_end</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">month_start</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;=</span><span class="sc0"> </span><span class="sc8">month_end</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">b3_ardb</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc10">${month[i]}</span><span class="sc0">
            </span><span class="sc8">arch_db</span><span class="sc7">=</span><span class="sc8">ip_arch0</span><span class="sc9">$?</span><span class="sc7">@</span><span class="sc8">ardb</span><span class="sc0">
                
            </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${b3_arch_resource_dir}</span><span class="sc7">/</span><span class="sc8">CLIENT_SAMPLE.sql</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
            </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"DATABASE"</span><span class="sc0"> </span><span class="sc5">"$arch_db"</span><span class="sc0">
            </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"CLINETNO"</span><span class="sc0"> </span><span class="sc5">"$client_number"</span><span class="sc0">
            </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"YEAR"</span><span class="sc0"> </span><span class="sc5">"$year"</span><span class="sc0">
            </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"MONTH"</span><span class="sc0"> </span><span class="sc5">"${month[i]}"</span><span class="sc0">
            </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"${b3_arch_resource_dir}"</span><span class="sc0"> </span><span class="sc5">"${b3_arch_result_dir}"</span><span class="sc0">
            
            </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
            </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">else</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">year</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">year_end</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">

            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$year_start</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">month_start</span><span class="sc0">
                </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">i</span><span class="sc0"> </span><span class="sc7">&lt;=</span><span class="sc0"> </span><span class="sc3">12</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc8">b3_ardb</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc10">${month[i]}</span><span class="sc0">
                    </span><span class="sc8">arch_db</span><span class="sc7">=</span><span class="sc8">ip_arch0</span><span class="sc9">$?</span><span class="sc7">@</span><span class="sc8">ardb</span><span class="sc0">
                    
                    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${b3_arch_resource_dir}</span><span class="sc7">/</span><span class="sc8">CLIENT_SAMPLE.sql</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"DATABASE"</span><span class="sc0"> </span><span class="sc5">"$arch_db"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"CLINETNO"</span><span class="sc0"> </span><span class="sc5">"$client_number"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"YEAR"</span><span class="sc0"> </span><span class="sc5">"$year"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"MONTH"</span><span class="sc0"> </span><span class="sc5">"${month[i]}"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"${b3_arch_resource_dir}"</span><span class="sc0"> </span><span class="sc5">"${b3_arch_result_dir}"</span><span class="sc0">
                
                    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">i</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                    </span><span class="sc8">i</span><span class="sc7">=</span><span class="sc8">i+1</span><span class="sc0">
                </span><span class="sc4">done</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
            
            </span><span class="sc8">year</span><span class="sc7">=</span><span class="sc8">year+1</span><span class="sc0">
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc9">$year_end</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">j</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
                </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">j</span><span class="sc0"> </span><span class="sc7">&lt;=</span><span class="sc0"> </span><span class="sc8">month_end</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc8">b3_ardb</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc10">${month[j]}</span><span class="sc0">
                    </span><span class="sc8">arch_db</span><span class="sc7">=</span><span class="sc8">ip_arch0</span><span class="sc9">$?</span><span class="sc7">@</span><span class="sc8">ardb</span><span class="sc0">
                    
                    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${b3_arch_resource_dir}</span><span class="sc7">/</span><span class="sc8">CLIENT_SAMPLE.sql</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"DATABASE"</span><span class="sc0"> </span><span class="sc5">"$arch_db"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"CLINETNO"</span><span class="sc0"> </span><span class="sc5">"$client_number"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"YEAR"</span><span class="sc0"> </span><span class="sc5">"$year"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"MONTH"</span><span class="sc0"> </span><span class="sc5">"${month[j]}"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"${b3_arch_resource_dir}"</span><span class="sc0"> </span><span class="sc5">"${b3_arch_result_dir}"</span><span class="sc0">
                    
                    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">j</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                    </span><span class="sc8">j</span><span class="sc7">=</span><span class="sc8">j+1</span><span class="sc0">
                </span><span class="sc4">done</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">k</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0"> </span><span class="sc3">3</span><span class="sc0"> </span><span class="sc3">4</span><span class="sc0"> </span><span class="sc3">5</span><span class="sc0"> </span><span class="sc3">6</span><span class="sc0"> </span><span class="sc3">7</span><span class="sc0"> </span><span class="sc3">8</span><span class="sc0"> </span><span class="sc3">9</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc3">11</span><span class="sc0"> </span><span class="sc3">12</span><span class="sc0">
                </span><span class="sc4">do</span><span class="sc0">
                    </span><span class="sc8">b3_ardb</span><span class="sc0"> </span><span class="sc9">$year</span><span class="sc0"> </span><span class="sc10">${month[k]}</span><span class="sc0">
                    </span><span class="sc8">arch_db</span><span class="sc7">=</span><span class="sc8">ip_arch0</span><span class="sc9">$?</span><span class="sc7">@</span><span class="sc8">ardb</span><span class="sc0">
                    
                    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc10">${b3_arch_resource_dir}</span><span class="sc7">/</span><span class="sc8">CLIENT_SAMPLE.sql</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"DATABASE"</span><span class="sc0"> </span><span class="sc5">"$arch_db"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"CLINETNO"</span><span class="sc0"> </span><span class="sc5">"$client_number"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"YEAR"</span><span class="sc0"> </span><span class="sc5">"$year"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"MONTH"</span><span class="sc0"> </span><span class="sc5">"${month[k]}"</span><span class="sc0">
                    </span><span class="sc8">str_replace</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc5">"${b3_arch_resource_dir}"</span><span class="sc0"> </span><span class="sc5">"${b3_arch_result_dir}"</span><span class="sc0">
                
                    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc9">$year$</span><span class="sc7">{</span><span class="sc8">month</span><span class="sc7">[</span><span class="sc8">k</span><span class="sc7">]}.</span><span class="sc8">sql</span><span class="sc0">
                </span><span class="sc4">done</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">
        
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${b3_arch_resource_dir}</span><span class="sc7">/</span><span class="sc8">entry.head</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc8">tmp</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">oldshipment</span><span class="sc9">$client_number</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># Insight keeps only 7 years b3 data, </span><span class="sc0">
</span><span class="sc2"># purge data older than 7 years in archive db </span><span class="sc0">
</span><span class="sc8">b3_arch_purge</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc2">##input clear archive database here</span><span class="sc0">
</span><span class="sc8">database</span><span class="sc7">=</span><span class="sc8">ip_arch</span><span class="sc0">
</span><span class="sc8">diretory</span><span class="sc7">=/</span><span class="sc8">archbkup</span><span class="sc7">/</span><span class="sc8">dbbkup</span><span class="sc0">
</span><span class="sc8">log</span><span class="sc7">=/</span><span class="sc8">archbkup</span><span class="sc7">/</span><span class="sc8">dbbkup</span><span class="sc7">/</span><span class="sc9">$database</span><span class="sc7">.</span><span class="sc8">b3_arch_purge.log</span><span class="sc0">

</span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">informix</span><span class="sc7">/</span><span class="sc8">ids115.env</span><span class="sc0"> </span><span class="sc8">artestdb</span><span class="sc0">

</span><span class="sc2">##processing start</span><span class="sc0">
</span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$INFORMIXSERVER</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ipdb"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
</span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$database</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"ip_0p"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc0">

    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc9">$log</span><span class="sc0">
    </span><span class="sc8">dbexport</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ss</span><span class="sc0"> </span><span class="sc9">$database</span><span class="sc0"> </span><span class="sc8">-o</span><span class="sc0"> </span><span class="sc9">$diretory</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc9">$log</span><span class="sc0">

    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$database</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">&gt;&gt;</span><span class="sc9">$log</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc13">
    TRUNCATE b3_line_comment;
    TRUNCATE b3_recap_details;
    TRUNCATE b3_line;
    TRUNCATE b3_subheader;

    TRUNCATE b3b;
    TRUNCATE status_history;
    TRUNCATE b3;
EOF</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"update statistics"</span><span class="sc7">|</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc9">$database</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc9">$$log</span><span class="sc0">

</span><span class="sc2">##import db again if needed</span><span class="sc0">
    </span><span class="sc2"># echo "rename database $database to $database_replaced"|dbaccess sysmaster</span><span class="sc0">
    </span><span class="sc2"># dbimport -i $diretory $database</span><span class="sc0">
    
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc9">$log</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2"># Description: To manage the INFORMIX storage utilization,</span><span class="sc0">
</span><span class="sc2">#  1. Check storage spaces ( onstat -d). </span><span class="sc0">
</span><span class="sc2">#  2. Check reserved pages ( oncheck -pr). </span><span class="sc0">
</span><span class="sc2">#  3. Add dbspaces, temporary dbspaces, blobspaces, temporary sbspaces, </span><span class="sc0">
</span><span class="sc2">#     and sbspaces (onspaces). </span><span class="sc0">
</span><span class="sc2">#  4. Display and add chunks to a storage space. </span><span class="sc0">
</span><span class="sc2">#  5. Check the dataskip status. </span><span class="sc0">
</span><span class="sc2">#  6. Display and add external spaces. </span><span class="sc0">
</span><span class="sc2">#  7. Display the number of pages in your database, </span><span class="sc0">
</span><span class="sc2">#     percentage of allocated space, and used space (oncheck -pt). </span><span class="sc0">
</span><span class="sc2">#  8. Override ONDBSPACEDOWN. </span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">mtbls</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env $ids_server</span><span class="sc0">

    </span><span class="sc8">ids_database</span><span class="sc7">=</span><span class="sc10">${IDSDB:="ip_systest"}</span><span class="sc0">
    </span><span class="sc8">ids_tables</span><span class="sc7">=</span><span class="sc10">${TABLEMONITOR:="b3"}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${TMP}</span><span class="sc0">
    
    </span><span class="sc2">#History data collection</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-f</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc2">#OS level storage usage</span><span class="sc0">
        </span><span class="sc2">#df -k &gt; tmp_tblspace</span><span class="sc0">

        </span><span class="sc2">#INFORMIX chunk level storage usage</span><span class="sc0">
        </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0">

        </span><span class="sc2">#The oncheck -pt and/or oncheck -pT options print a tblspace report</span><span class="sc0">
        </span><span class="sc2">#for a specific table or fragment</span><span class="sc0">
        </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc10">${ids_tables}</span><span class="sc0">   
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">tablecount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">

        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">xcount</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">xcount</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">tablecount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date)\t${ids_database}\t$1"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0">
            </span><span class="sc8">oncheck</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">pt</span><span class="sc0"> </span><span class="sc10">${ids_database}</span><span class="sc7">:</span><span class="sc9">$1</span><span class="sc0">      </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0">

            </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
            </span><span class="sc8">xcount</span><span class="sc7">=</span><span class="sc8">xcount+1</span><span class="sc0">

        </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc2">#Current data collection</span><span class="sc0">
    </span><span class="sc4">df</span><span class="sc0"> </span><span class="sc8">-k</span><span class="sc0">       </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0">
    </span><span class="sc8">onstat</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc0">   </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0">

    </span><span class="sc4">set</span><span class="sc0"> </span><span class="sc10">${ids_tables}</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">tablecount</span><span class="sc7">=</span><span class="sc9">$#</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">icount</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">

    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc7">((</span><span class="sc0"> </span><span class="sc8">icount</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc8">tablecount</span><span class="sc0"> </span><span class="sc7">))</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$(date)\t${ids_database}\t$1"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0">
        </span><span class="sc8">oncheck</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">pt</span><span class="sc0"> </span><span class="sc10">${ids_database}</span><span class="sc7">:</span><span class="sc9">$1</span><span class="sc0">      </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0">

        </span><span class="sc4">shift</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc8">icount</span><span class="sc7">=</span><span class="sc8">icount+1</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc2">#Email the Storage usage difference to Administrator</span><span class="sc0">
    </span><span class="sc4">diff</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc8">tmp_tblspace.txt</span><span class="sc0">
    
    </span><span class="sc8">mail_</span><span class="sc11">$(uname)</span><span class="sc0"> </span><span class="sc5">"$(hostname)_INFORMIX_TBLSPACE_CHANGE_REPORT"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc10">${TMP}</span><span class="sc0"> </span><span class="sc8">tmp_tblspace.txt</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0">

    </span><span class="sc2"># Create new storage usage file for next compare</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc8">tmp_tblspace.txt</span><span class="sc0">
    </span><span class="sc4">mv</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc9">$$</span><span class="sc0"> </span><span class="sc8">tmp_tblspace</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#purpose: run update statistics to update system catalog information </span><span class="sc0">
</span><span class="sc2">#to optimize the database search</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#If you include no FOR PROCEDURE specification, no Table and Column Scope clause, </span><span class="sc0">
</span><span class="sc2">#and no Resolution clause, then statistics are updated for every table </span><span class="sc0">
</span><span class="sc2">#and SPL routine in the current database, including the system catalog tables.</span><span class="sc0">
</span><span class="sc2"># -systables, </span><span class="sc0">
</span><span class="sc2"># -syscolumns,</span><span class="sc0">
</span><span class="sc2"># -sysindices, </span><span class="sc0">
</span><span class="sc2"># -sysfragments,</span><span class="sc0">
</span><span class="sc2"># -sysdistrib, and </span><span class="sc0">
</span><span class="sc2"># -sysfragdist</span><span class="sc0">
</span><span class="sc8">upstat</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">ids_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">ids_database</span><span class="sc7">=</span><span class="sc10">${IDSDB:="ip_systest"}</span><span class="sc0">
    
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${ids_server}</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"update statistics"</span><span class="sc7">|</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${ids_database}</span><span class="sc0">

    </span><span class="sc2"># export INFORMIXDIR=/usr/apps/inf/ver115UC3</span><span class="sc0">
    </span><span class="sc2"># export INFORMIXSERVER=ipdb</span><span class="sc0">
    </span><span class="sc2"># export PATH=$INFORMIXDIR/bin:$PATH</span><span class="sc0">

    </span><span class="sc2"># SQLDIR=/usr/apps/inf/bob/upstat</span><span class="sc0">

    </span><span class="sc2"># echo</span><span class="sc0">
    </span><span class="sc2"># date</span><span class="sc0">

    </span><span class="sc2"># time dbaccess &lt; $SQLDIR/tbls_med.sql &gt; $SQLDIR/tbls_med.out 2&gt;&amp;1</span><span class="sc0">
    </span><span class="sc2"># time dbaccess &lt; $SQLDIR/tbls_high.sql &gt; $SQLDIR/tbls_high.out 2&gt;&amp;1</span><span class="sc0">
    </span><span class="sc2"># time dbaccess &lt; $SQLDIR/proc.sql &gt; $SQLDIR/proc.out 2&gt;&amp;1</span><span class="sc0">
    
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"${ids_server} ${ids_database} upstat done!"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2">#  Unload &amp; Clear status_history related to WIPs file</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Author : Liru Chen</span><span class="sc0">
</span><span class="sc2">#  Date: 2014-10-07</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">unload_clearSH</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
      </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">$"Usage: $0 WIP_file"</span><span class="sc0">
      </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">tmpDir</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">lchen</span><span class="sc7">/</span><span class="sc8">status_history</span><span class="sc0">
    </span><span class="sc8">tmpFile</span><span class="sc7">=</span><span class="sc9">$tmpDir</span><span class="sc7">/</span><span class="sc11">$(basename $1)</span><span class="sc0">
    </span><span class="sc8">outDate</span><span class="sc7">=</span><span class="sc11">`date +%Y%m%d%H%M`</span><span class="sc0">

    </span><span class="sc8">datecalc</span><span class="sc0"> </span><span class="sc8">-a</span><span class="sc0"> </span><span class="sc11">`date "+%Y"`</span><span class="sc0"> </span><span class="sc11">`date "+%m"`</span><span class="sc0"> </span><span class="sc11">`date "+%d"`</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc3">365</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">tmpYear</span><span class="sc0"> </span><span class="sc8">tmpMonth</span><span class="sc0"> </span><span class="sc8">tmpDay</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$tmpMonth</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">lt</span><span class="sc0"> </span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc8">tmpMonth</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc9">$tmpMonth</span><span class="sc0">

    </span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">informix</span><span class="sc7">/</span><span class="sc8">ids115.env</span><span class="sc0"> </span><span class="sc8">ipdb</span><span class="sc0">

    </span><span class="sc2">## First Part; Record all old b3iid related to WIP ##</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc7">.</span><span class="sc8">status_history.unload</span><span class="sc0"> 
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidOld</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.unload</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">wip</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">liibrno</span><span class="sc7">=</span><span class="sc10">${wip:0:3}</span><span class="sc0">
        </span><span class="sc8">liireno</span><span class="sc7">=</span><span class="sc10">${wip:3:8}</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$liibrno</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$liireno</span><span class="sc0">

        </span><span class="sc8">b3iidOld</span><span class="sc7">=</span><span class="sc11">$(echo "select b3iid from b3 
        where liibrchno = $liibrno and liirefno = $liireno " |
        dbaccess ip_0p | grep -v count | grep -v b3iid )</span><span class="sc0">
        
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$b3iidOld</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidOld</span><span class="sc0">

        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$b3iidOld</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$wip Missed"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.unload</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">

</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc7">@</span><span class="sc8">ipdb</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc0"> </span><span class="sc12">&lt;&lt;EOF</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc7">.</span><span class="sc8">status_history.unload</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc13">
set isolation to dirty read;
select b3.b3iid, b3.createdate, b3.status, status_history.status, statusdate
from b3, status_history
where liibrchno = $liibrno 
and liirefno = $liireno
and b3.b3iid = status_history.b3iid; 
EOF</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0"> 

    </span><span class="sc2">## Second Part; Record old data for status_history ##</span><span class="sc0">
    </span><span class="sc8">unloadTmp</span><span class="sc7">=</span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">unload</span><span class="sc0">
    </span><span class="sc8">unloadTmpTime</span><span class="sc7">=</span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">unloadTime</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">wip</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
         </span><span class="sc8">liibrno</span><span class="sc7">=</span><span class="sc10">${wip:0:3}</span><span class="sc0">
         </span><span class="sc8">liireno</span><span class="sc7">=</span><span class="sc10">${wip:3:8}</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        UNLOAD TO "</span><span class="sc9">$unloadTmp</span><span class="sc7">.</span><span class="sc9">$liibrno</span><span class="sc7">.</span><span class="sc9">$liireno</span><span class="sc5">"
          SELECT status_history.b3iid, status_history.status, 
                 status_history.statusdate FROM b3,status_history
          where  liibrchno = $liibrno 
            and  liirefno = $liireno 
            and  b3.b3iid = status_history.b3iid "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc0">

        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        UNLOAD TO "</span><span class="sc9">$unloadTmpTime</span><span class="sc7">.</span><span class="sc9">$liibrno</span><span class="sc7">.</span><span class="sc9">$liireno</span><span class="sc5">"
          SELECT status_history.b3iid, status_history.status, 
                 status_history.statusdate FROM b3,status_history
          where  liibrchno = $liibrno
            and  liirefno = $liireno
            and  b3.b3iid = status_history.b3iid
            and  statusdate &gt; '$tmpYear/$tmpMonth/%'"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$unloadTmp</span><span class="sc7">.*</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0">
    </span><span class="sc2">#rm -f $unloadTmp.*</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$unloadTmpTime</span><span class="sc7">.*</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$unloadTmpTime</span><span class="sc7">.*</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$unloadTmp</span><span class="sc7">.*</span><span class="sc0">

    </span><span class="sc2">## Third Part;  Clear old data for status_history ##</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidOld</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">b3iid_delete</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        DELETE FROM status_history
        where  b3iid = $b3iid_delete"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidOld</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidOld.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.unload</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">lchenMail.unload</span><span class="sc0">
     
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"status_history download for $(basename $1) completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">lchenMail.unload</span><span class="sc0"> 

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"status_history download for $(basename $1) with Time completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0"> 

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"status_history download for $(basename $1) completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">EKotsalainen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.unload</span><span class="sc0"> 

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2">#  load status_history related to WIPs file</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Author : Liru Chen</span><span class="sc0">
</span><span class="sc2">#  Date: 2014-10-07</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc8">load_clearedSH</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$#</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
      </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">$"Usage: $0 WIP_file"</span><span class="sc0">
      </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc8">tmpDir</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">lchen</span><span class="sc7">/</span><span class="sc8">status_history</span><span class="sc0">
    </span><span class="sc8">tmpFile</span><span class="sc7">=</span><span class="sc9">$tmpDir</span><span class="sc7">/</span><span class="sc11">$(basename $1)</span><span class="sc0">
    </span><span class="sc8">loadTmp</span><span class="sc7">=</span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">load</span><span class="sc0">

    </span><span class="sc2">#yearLoad="|2014"</span><span class="sc0">
    </span><span class="sc8">outDate</span><span class="sc7">=</span><span class="sc11">`date +%Y%m%d%H%M`</span><span class="sc0">

    </span><span class="sc7">.</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">informix</span><span class="sc7">/</span><span class="sc8">ids115.env</span><span class="sc0"> </span><span class="sc8">ipdb</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew</span><span class="sc0">
    </span><span class="sc2">#cat /dev/null &gt; $tmpFile.b3iid</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">exclude</span><span class="sc0">
    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.load</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$1</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">wip</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">liibrno</span><span class="sc7">=</span><span class="sc10">${wip:0:3}</span><span class="sc0">
        </span><span class="sc8">liireno</span><span class="sc7">=</span><span class="sc10">${wip:3:8}</span><span class="sc0">

        </span><span class="sc8">b3iidNew</span><span class="sc7">=</span><span class="sc11">$( echo "select b3iid from b3
            where liibrchno = $liibrno and liirefno = $liireno " |
            dbaccess ip_0p | grep -v count | grep -v b3iid )</span><span class="sc0">
            
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$b3iidNew</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew</span><span class="sc0">

        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$b3iidNew</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"$wip Missed"</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.load</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">b3iidNew</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
        UNLOAD TO "</span><span class="sc9">$loadTmp</span><span class="sc7">.</span><span class="sc9">$b3iidNew</span><span class="sc5">"
          SELECT b3iid, status
          FROM status_history
          where b3iid = $b3iidNew "</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$loadTmp</span><span class="sc7">.*</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">exclude</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$loadTmp</span><span class="sc7">.*</span><span class="sc0">

    </span><span class="sc2">#Get a list of the b3iid</span><span class="sc0">
    </span><span class="sc2">#paste -d " " $tmpFile.b3iidOld $tmpFile.b3iidNew &gt; $tmpFile.b3iid</span><span class="sc0">
    </span><span class="sc2">#rm -f $tmpFile.b3iidOld $tmpFile.b3iidNew</span><span class="sc0">

    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew.</span><span class="sc9">$outDate</span><span class="sc0">
    </span><span class="sc2">#cp $tmpFile.b3iid $tmpFile.b3iid.$outDate</span><span class="sc0">

    </span><span class="sc2">#cat $tmpFile.b3iid | </span><span class="sc0">
    </span><span class="sc2"># while read b3iidOld b3iidNew</span><span class="sc0">
    </span><span class="sc2"># do</span><span class="sc0">
    </span><span class="sc2">#  #Replace old b3iid with related new one</span><span class="sc0">
    </span><span class="sc2">#  /cgi/bin/cgi.replace $tmpFile.recordOld \
    #     $b3iidOld $b3iidNew</span><span class="sc0">
    </span><span class="sc2"># done</span><span class="sc0">

    </span><span class="sc2">#Get a list of loadable status_history_record</span><span class="sc0">

    </span><span class="sc2">#Remove blank lines in New b3iid file</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">b3iidNew</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">include</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Ff</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">include</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
         </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld.tmp1</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Fvf</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">exclude</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld.tmp1</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
         </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOld.tmp2</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Ff</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">include</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
         </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.tmp1</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">Fvf</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">exclude</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.tmp1</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
         </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.tmp2</span><span class="sc0">

    </span><span class="sc2">#load status_history data in 12 months</span><span class="sc0">
    </span><span class="sc2">#grep "$yearLoad" $tmpFile.recordOld.tmp2 \
    #     &gt; $tmpFile.record.final</span><span class="sc0">

    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"$yearLoad"</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">recordOldTime.tmp2</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
         </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">record.final</span><span class="sc0">
         
    </span><span class="sc8">recordnum</span><span class="sc7">=</span><span class="sc11">$(cat $tmpFile.record.final|wc -l)</span><span class="sc0">

    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"
    LOAD FROM $tmpFile.record.final
    INSERT INTO status_history"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc8">ip_0p</span><span class="sc0"> 

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.load</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">record.final</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">lchenMail.load</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"status_history load for $(basename $1) completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">lchenMail.load</span><span class="sc0">

    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"status_history load for $(basename $1) with $recordnum completed"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc8">EKotsalainen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$tmpFile</span><span class="sc7">.</span><span class="sc8">ekotMail.load</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">###########################################################################</span><span class="sc0">
</span><span class="sc2">#  AWS Project</span><span class="sc0">
</span><span class="sc2">#</span><span class="sc0">
</span><span class="sc2">#  Author : Liru Chen</span><span class="sc0">
</span><span class="sc2">#  Date: 2015-09-22</span><span class="sc0">
</span><span class="sc2">###########################################################################</span><span class="sc0">

</span><span class="sc8">awsparser</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc8">JAVA_HOME</span><span class="sc7">=/</span><span class="sc8">usr</span><span class="sc7">/</span><span class="sc8">java6</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">JAVA_HOME</span><span class="sc0">
</span><span class="sc8">PATH</span><span class="sc7">=.:</span><span class="sc9">$JAVA_HOME</span><span class="sc7">/</span><span class="sc8">bin</span><span class="sc7">:</span><span class="sc9">$PATH</span><span class="sc0">
</span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">PATH</span><span class="sc0">

</span><span class="sc8">java</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">jar</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">home</span><span class="sc7">/</span><span class="sc8">csalas</span><span class="sc7">/</span><span class="sc8">VaxFileParser_v0.6</span><span class="sc7">/</span><span class="sc8">VAXFilesParser_v0.6.jar</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># #AWS project, prepare condition for select SQL</span><span class="sc0">
</span><span class="sc2"># awsrec () {</span><span class="sc0">
    </span><span class="sc2"># echo $1 | grep = &gt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># [[ $? -ne 0 ]] &amp;&amp; {</span><span class="sc0">
        </span><span class="sc2"># echo ""</span><span class="sc0">
        </span><span class="sc2"># return</span><span class="sc0">
    </span><span class="sc2"># }</span><span class="sc0">
    
    </span><span class="sc2"># awssc_col=$(echo $1|cut -f1 -d=)</span><span class="sc0">
    </span><span class="sc2"># awssc_val=$(echo $1|cut -f2 -d=)</span><span class="sc0">
            
    </span><span class="sc2"># echo ${awssc_col} | grep date$ &gt; /dev/null</span><span class="sc0">
    </span><span class="sc2"># daterc=$?</span><span class="sc0">
    
    </span><span class="sc2"># if [[ ${daterc} -eq 0 ]]</span><span class="sc0">
    </span><span class="sc2"># then</span><span class="sc0">
        </span><span class="sc2"># awsdate_year=${awssc_val:0:4}</span><span class="sc0">
        </span><span class="sc2"># awsdate_month=${awssc_val:4:2}</span><span class="sc0">
        </span><span class="sc2"># awsdate_day=${awssc_val:6:2}</span><span class="sc0">
        
        </span><span class="sc2"># awsdate_val="${awsdate_year}/${awsdate_month}/${awsdate_day}"</span><span class="sc0">
        </span><span class="sc2"># echo "${awssc_col} like '${awsdate_val}%'"</span><span class="sc0">
    </span><span class="sc2"># else</span><span class="sc0">
        </span><span class="sc2"># echo "${awssc_col} = '${awssc_val}'"</span><span class="sc0">
    </span><span class="sc2"># fi</span><span class="sc0">
     
</span><span class="sc2"># }</span><span class="sc0">

</span><span class="sc2">#Build AWS SELECT CLAUSE ( as globle variable ${select_clause} ) based on the all the columns of the table </span><span class="sc0">
</span><span class="sc8">awscolums</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awscolums_table_name</span><span class="sc7">=</span><span class="sc11">$(echo $1|tr A-Z a-z)</span><span class="sc0">
    
    </span><span class="sc8">awscolums_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">awscolums_database</span><span class="sc7">=</span><span class="sc10">${IDSDB:="ip_systest"}</span><span class="sc0">

    </span><span class="sc2"># #[[ ${awsdbaccess_server}== "ipdb" ]] &amp;&amp; return 119</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${awscolums_server}</span><span class="sc0">
    
    </span><span class="sc8">first_column</span><span class="sc7">=</span><span class="sc5">"Y"</span><span class="sc0">
    </span><span class="sc8">select_clause</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc8">tcolumn</span><span class="sc0"> </span><span class="sc10">${awscolums_database}</span><span class="sc0"> </span><span class="sc10">${awscolums_table_name}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">column</span><span class="sc0"> </span><span class="sc8">columnname</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${first_column}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"Y"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
        </span><span class="sc4">then</span><span class="sc0">
            </span><span class="sc8">select_clause</span><span class="sc7">=</span><span class="sc5">"SELECT ${awscolums_table_name}.${columnname},'|'"</span><span class="sc0">
            </span><span class="sc8">first_column</span><span class="sc7">=</span><span class="sc5">"N"</span><span class="sc0">
        </span><span class="sc4">else</span><span class="sc0">
            </span><span class="sc8">select_clause</span><span class="sc7">=</span><span class="sc5">"${select_clause},${awscolums_table_name}.${columnname},'|'"</span><span class="sc0">
        </span><span class="sc4">fi</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc2">#echo ${select_clause}</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Prepare SQL by reading each record provided by VAXFilesParser output, call txt2sql.pl</span><span class="sc0">
</span><span class="sc8">awssql</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2">#AWS SOURCE KEYS DATA FILE FORMAT EXAMPLE:</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150029,hstarifftrtmnt=29,effdate=20150101</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150010,hstarifftrtmnt=30,effdate=20150101</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150011,hstarifftrtmnt=30,effdate=20150101</span><span class="sc0">
    </span><span class="sc2"># change it to:</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150029,hstarifftrtmnt=29,effdate like '2015/01/01%'</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150010,hstarifftrtmnt=30,effdate like '2015/01/01%'</span><span class="sc0">
    </span><span class="sc2"># HS_DUTY_RATE,hsno=7318150011,hstarifftrtmnt=30,effdate like '2015/01/01%'</span><span class="sc0">

    
    </span><span class="sc8">awssql_input_key</span><span class="sc7">=</span><span class="sc10">${1-$AWSINPUTKEY}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${awssql_input_key}</span><span class="sc0">      </span><span class="sc2">#add one more line to the end of input file</span><span class="sc0">

    </span><span class="sc8">awssql_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    </span><span class="sc8">awssql_output_dir</span><span class="sc7">=</span><span class="sc10">${AWSOUTDIR:="/dmqjtmp/rcp/stage/VaxParserOutput"}</span><span class="sc0">

    </span><span class="sc2">#awk '{for (i=2; i&lt;NF; i++) printf $i " "; print $NF}' filename</span><span class="sc0">
    </span><span class="sc2">#perl -lane 'print join " ",@F[1..$#F,0]' file</span><span class="sc0">
    
    </span><span class="sc2">#Method Two, read and parser key file to SQL line by line</span><span class="sc0">

    </span><span class="sc8">last_table_name</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">  
    </span><span class="sc2">#integer awssql_record_num=0</span><span class="sc0">
    </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">single_table_key</span><span class="sc7">=</span><span class="sc11">$(sort ${awssql_input_key}|uniq|cut -f1 -d"~"|uniq|grep -v "^$"|wc -l)</span><span class="sc0">
    
    </span><span class="sc2">#The command first compares adjacent lines and then removes the second and succeeding </span><span class="sc0">
    </span><span class="sc2">#duplications of a line. Duplicated lines must be adjacent. (Before issuing the uniq </span><span class="sc0">
    </span><span class="sc2">#command, use the sort command to make all duplicate lines adjacent)</span><span class="sc0">
    </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc10">${awssql_input_key}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">uniq</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">awssql_record_line</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc2">#awssql_record_num=awssql_record_num+1</span><span class="sc0">
        </span><span class="sc8">awssql_table_name</span><span class="sc7">=</span><span class="sc11">$(echo "${awssql_record_line}~"|cut -f1 -d"~"|tr A-Z a-z)</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${awssql_table_name}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">continue</span><span class="sc0">    </span><span class="sc2">#empty line</span><span class="sc0">

        </span><span class="sc8">awssql_table_condition</span><span class="sc7">=</span><span class="sc11">$(echo "${awssql_record_line}~"|cut -f2- -d"~")</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${awssql_table_condition}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">" ${awssql_input_key} wrong input key format"</span><span class="sc0">
            </span><span class="sc4">return</span><span class="sc0">      </span><span class="sc2">#wrong input key format</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">
        
        </span><span class="sc8">awssql_table_vax</span><span class="sc7">=</span><span class="sc10">${awssql_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${awssql_table_name}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">vax4sql</span><span class="sc0">
        </span><span class="sc8">awssql_table_sql</span><span class="sc7">=</span><span class="sc10">${awssql_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${awssql_table_name}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0">

        </span><span class="sc2">#awssql_table_sql=${awssql_tmp_dir}/${awssql_table_name}.${awssql_record_num}.$$.${current_time}.sql</span><span class="sc0">
        </span><span class="sc2">#awssql_table_out=${awssql_tmp_dir}/${awssql_table_name}.${awssql_record_num}.$$.${current_time}.out</span><span class="sc0">
        
        </span><span class="sc2">#echo "</span><span class="sc0">
        </span><span class="sc2">#BEGIN WORK;</span><span class="sc0">
        </span><span class="sc2">#SET ISOLATION to DIRTY READ;</span><span class="sc0">
        </span><span class="sc2">#UNLOAD TO "${awssql_table_out}"</span><span class="sc0">
        
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${last_table_name}</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc10">${awssql_table_name}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc8">last_table_name</span><span class="sc7">=</span><span class="sc10">${awssql_table_name}</span><span class="sc0">
            
            </span><span class="sc2">#grep -x Displays lines that match the specified pattern exactly with no additional characters.</span><span class="sc0">
            </span><span class="sc2">#grep -i Ignores the case (uppercase or lowercase) of letters when making comparisons.</span><span class="sc0">
            </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc10">${awssql_input_key}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">uniq</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc5">"^${awssql_table_name}~"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awssql_table_vax}</span><span class="sc0">
            
            </span><span class="sc8">txt2sql.pl</span><span class="sc0"> </span><span class="sc10">${awssql_table_vax}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awssql_table_sql}</span><span class="sc7">.</span><span class="sc8">tmp</span><span class="sc0">

            </span><span class="sc8">awscolums</span><span class="sc0"> </span><span class="sc10">${awssql_table_name}</span><span class="sc0">

            </span><span class="sc2">#Substitute with sed</span><span class="sc0">
            </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'s/^SELECT_CLAUSE.*/'</span><span class="sc5">"${select_clause}"</span><span class="sc6">'/g'</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${awssql_table_sql}</span><span class="sc7">.</span><span class="sc8">tmp</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awssql_table_sql}</span><span class="sc0">
            
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${single_table_key}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">break</span><span class="sc0">
            
        </span><span class="sc7">}</span><span class="sc0">
 
        </span><span class="sc2"># echo ${select_clause} &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
        </span><span class="sc2"># echo "FROM ${awssql_table_name}" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">

        </span><span class="sc2"># integer sql_column_num=2</span><span class="sc0">
        </span><span class="sc2"># first_column="Y"</span><span class="sc0">
        </span><span class="sc2"># while true</span><span class="sc0">
        </span><span class="sc2"># do</span><span class="sc0">
            </span><span class="sc2"># awssql_column_value=$(echo ${awssql_record_line}|cut -f${sql_column_num} -d",")</span><span class="sc0">
            </span><span class="sc2"># [[ ${awssql_column_value} == "" ]] &amp;&amp; {</span><span class="sc0">
                </span><span class="sc2"># echo ";" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># break</span><span class="sc0">
            </span><span class="sc2"># }</span><span class="sc0">
            
            </span><span class="sc2"># if [[ ${first_column} == "Y" ]]</span><span class="sc0">
            </span><span class="sc2"># then</span><span class="sc0">
                </span><span class="sc2"># #echo "WHERE \n" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #awsdate ${awssql_column_value} &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #echo "${awssql_column_value} \n" &gt;&gt; </span><span class="sc0">
                </span><span class="sc2"># echo "WHERE " $(awsrec ${awssql_column_value}) &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #echo ${awssql_condition} &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># first_column="N"</span><span class="sc0">
            </span><span class="sc2"># else</span><span class="sc0">
                </span><span class="sc2"># #echo "AND \n" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #awsdate ${awssql_column_value} &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #echo "${awssql_column_value} \n" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># [[ $(awsrec ${awssql_column_value}) != "" ]] &amp;&amp; \
                # echo "AND " $(awsrec ${awssql_column_value}) &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
                </span><span class="sc2"># #echo ${awssql_condition} &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
            </span><span class="sc2"># fi</span><span class="sc0">
    
        </span><span class="sc2"># sql_column_num=sql_column_num+1</span><span class="sc0">
        </span><span class="sc2"># done</span><span class="sc0">

        </span><span class="sc2"># #echo "COMMIT WORK;" &gt;&gt; ${awssql_table_sql}</span><span class="sc0">
        
        </span><span class="sc2">#cat ${awssql_table_sql} &gt;&gt; ${awssql_tmp_dir}/${awssql_table_name}.${current_time}.sql</span><span class="sc0">

        </span><span class="sc2">#rm -f ${awssql_table_sql}</span><span class="sc0">
        </span><span class="sc2">#rm -f ${awssql_table_out}</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#pass arguments to sed, append $2 to a line with pattern $1 in file $3</span><span class="sc0">
</span><span class="sc8">seda</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'
/'</span><span class="sc5">"$1"</span><span class="sc6">'/ a\
'</span><span class="sc5">"$2"</span><span class="sc6">'
'</span><span class="sc0"> </span><span class="sc9">$3</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#pass arguments to sed, insert a line $2 with pattern $1 in file $3</span><span class="sc0">
</span><span class="sc8">sedi</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
</span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'
/'</span><span class="sc5">"$1"</span><span class="sc6">'/ i\
'</span><span class="sc5">"$2"</span><span class="sc6">'
'</span><span class="sc0"> </span><span class="sc9">$3</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Prepare SQL for B3 related tables</span><span class="sc0">
</span><span class="sc8">awsb3</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awsb3_related_tables</span><span class="sc7">=</span><span class="sc10">${AWSB3}</span><span class="sc0">
    </span><span class="sc8">awsb3_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    
    </span><span class="sc8">last_table_name</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">awsb3_table</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc10">${awsb3_related_tables}</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">awsb3_tablename</span><span class="sc7">=</span><span class="sc11">$(echo "${awsb3_table}@"|cut -f1 -d"@"|tr A-Z a-z)</span><span class="sc0">  
        </span><span class="sc2">#tablename is uppercase</span><span class="sc0">
        </span><span class="sc8">awsb3_tone</span><span class="sc7">=</span><span class="sc11">$(echo "${awsb3_tablename},"|cut -f1 -d",")</span><span class="sc0">
        </span><span class="sc8">awsb3_ttwo</span><span class="sc7">=</span><span class="sc11">$(echo "${awsb3_tablename},"|cut -f2 -d",")</span><span class="sc0">
        
        </span><span class="sc2">#Return if no b3 parent table exist</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${awsb3_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${awsb3_ttwo}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc0">

        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${last_table_name}</span><span class="sc0"> </span><span class="sc7">!=</span><span class="sc0"> </span><span class="sc10">${awsb3_tone}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc8">last_table_name</span><span class="sc7">=</span><span class="sc10">${awsb3_tone}</span><span class="sc0">
            </span><span class="sc8">awscolums</span><span class="sc0"> </span><span class="sc10">${awsb3_tone}</span><span class="sc0">
        </span><span class="sc7">}</span><span class="sc0">

        </span><span class="sc2">#Substitute strings with sed</span><span class="sc0">
        </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'s/^SELECT.*/'</span><span class="sc5">"${select_clause}"</span><span class="sc6">'/g'</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${awsb3_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${awsb3_ttwo}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awsb3_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${awsb3_tone}</span><span class="sc7">.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">sql.tmp1</span><span class="sc0">
        
        </span><span class="sc2">#The special character "&amp;" corresponds to the pattern found: "^FROM.*"</span><span class="sc0">
        </span><span class="sc2">#and append: , '"${awsb3_tone}"' to the and of "^FROM.*"</span><span class="sc0">
        </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'s/^FROM.*/&amp;,'</span><span class="sc5">"${awsb3_tone}"</span><span class="sc6">'/g'</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp1"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp2"</span><span class="sc0">
            
        </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp2"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp1"</span><span class="sc0">
                
        </span><span class="sc8">awsb3_column</span><span class="sc7">=</span><span class="sc11">$(echo "${awsb3_table}@"|cut -f2 -d"@")</span><span class="sc0">
        
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">b3_column_num</span><span class="sc7">=</span><span class="sc3">1</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">awsb3_column_name</span><span class="sc7">=</span><span class="sc11">$(echo "${awsb3_column},"|cut -f${b3_column_num} -d",")</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${awsb3_column_name}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp1"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                    </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql"</span><span class="sc0">
                </span><span class="sc4">break</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
            
            </span><span class="sc8">awsb3_char</span><span class="sc7">=</span><span class="sc5">";"</span><span class="sc0">
            </span><span class="sc8">awsb3_string</span><span class="sc7">=</span><span class="sc5">"AND ${awsb3_tone}.${awsb3_column_name} = ${awsb3_ttwo}.${awsb3_column_name}"</span><span class="sc0">
            </span><span class="sc8">awsb3_file</span><span class="sc7">=</span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp1"</span><span class="sc0">
            
            </span><span class="sc8">sedi</span><span class="sc0"> </span><span class="sc5">"${awsb3_char}"</span><span class="sc0"> </span><span class="sc5">"${awsb3_string}"</span><span class="sc0"> </span><span class="sc5">"${awsb3_file}"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp2"</span><span class="sc0">
                
            </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp2"</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
                </span><span class="sc5">"${awsb3_tmp_dir}/${awsb3_tone}.${current_time}.sql.tmp1"</span><span class="sc0">
    
        </span><span class="sc8">b3_column_num</span><span class="sc7">=</span><span class="sc8">b3_column_num+1</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#run SQL generated by awssql() and awsb3()</span><span class="sc0">
</span><span class="sc8">awsdbaccess</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awsdbaccess_sql_file</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    
    </span><span class="sc8">awsdbaccess_server</span><span class="sc7">=</span><span class="sc10">${IDSSERVER:="systestdb"}</span><span class="sc0">
    </span><span class="sc8">awsdbaccess_database</span><span class="sc7">=</span><span class="sc10">${IDSDB:="ip_systest"}</span><span class="sc0">
    
    </span><span class="sc2"># #[[ ${awsdbaccess_server}== "ipdb" ]] &amp;&amp; return 119</span><span class="sc0">
    </span><span class="sc8">ids_env</span><span class="sc7">=</span><span class="sc10">${IDSENV:="/login/lchen/ids115.env"}</span><span class="sc0">
    </span><span class="sc2"># #. $ids_env ${awsdbaccess_server}</span><span class="sc0">

    </span><span class="sc8">awsdbaccess_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    </span><span class="sc8">awsdbaccess_output_dir</span><span class="sc7">=</span><span class="sc10">${AWSOUTDIR:="/dmqjtmp/rcp/stage/VaxParserOutput"}</span><span class="sc0">
    
    </span><span class="sc8">awsdbaccess_dbaccess_out</span><span class="sc7">=</span><span class="sc10">${awsdbaccess_tmp_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${awsdbaccess_sql_file} .sql)</span><span class="sc7">.</span><span class="sc8">dbaccess</span><span class="sc0">
    
    </span><span class="sc2">#Set isolation to dirty read</span><span class="sc0">
    </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc6">'1 i\
'</span><span class="sc5">"set isolation to dirty read;"</span><span class="sc6">''</span><span class="sc0"> </span><span class="sc10">${awsdbaccess_sql_file}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awsdbaccess_tmp_dir}</span><span class="sc7">/</span><span class="sc8">run.sql</span><span class="sc0">
    
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"START$(basename ${awsdbaccess_sql_file})\n"</span><span class="sc0">
    </span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc10">${awsdbaccess_database}</span><span class="sc0"> </span><span class="sc10">${awsdbaccess_tmp_dir}</span><span class="sc7">/</span><span class="sc8">run.sql</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awsdbaccess_dbaccess_out}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"STOP$(basename ${awsdbaccess_sql_file})\n"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#change dbaccess output to load/unload output format</span><span class="sc0">
</span><span class="sc8">awsoutput</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awsoutput_dbaccess_out</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    
    </span><span class="sc8">awsoutput_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    </span><span class="sc8">awsoutput_output_dir</span><span class="sc7">=</span><span class="sc10">${AWSOUTDIR:="/dmqjtmp/rcp/stage/AWSOutput"}</span><span class="sc0">

    </span><span class="sc8">awsoutput_unload_out</span><span class="sc7">=</span><span class="sc10">${awsoutput_tmp_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${awsoutput_dbaccess_out} .dbaccess)</span><span class="sc7">.</span><span class="sc8">unload</span><span class="sc0">
    
    </span><span class="sc8">awsoutput_output</span><span class="sc7">=</span><span class="sc10">${awsoutput_output_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${awsoutput_dbaccess_out} .dbaccess)</span><span class="sc0">
    
    </span><span class="sc2">#egrep -v "constant.*constant"  | uniq |</span><span class="sc0">
    </span><span class="sc8">col2rows.pl</span><span class="sc0"> </span><span class="sc10">${awsoutput_dbaccess_out}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awsoutput_unload_out}</span><span class="sc0">
        
    </span><span class="sc2"># #chang dbaccess output format to unload output format</span><span class="sc0">
    </span><span class="sc2"># column_item=""</span><span class="sc0">
    </span><span class="sc2"># column_string=""</span><span class="sc0">
    </span><span class="sc2"># egrep -v "constant.*constant" ${awsoutput_dbaccess_out} | uniq |</span><span class="sc0">
    </span><span class="sc2"># while read record_line_out</span><span class="sc0">
    </span><span class="sc2"># do</span><span class="sc0">
        </span><span class="sc2"># echo ${record_line_out} | grep -E "\|.*\|"</span><span class="sc0">
        </span><span class="sc2"># short_formant=$?</span><span class="sc0">
        </span><span class="sc2"># [[  ${short_formant} -eq 0  ]] &amp;&amp; {</span><span class="sc0">
            </span><span class="sc2"># echo ${record_line_out} &gt;&gt; ${awsoutput_unload_out}</span><span class="sc0">
            </span><span class="sc2"># continue</span><span class="sc0">
        </span><span class="sc2"># }</span><span class="sc0">
        
        </span><span class="sc2"># #Other line considered as short_formant dbaccess output</span><span class="sc0">
        </span><span class="sc2"># [[ ${record_line_out} == "" ]] &amp;&amp; {</span><span class="sc0">
            </span><span class="sc2"># echo "${column_string}" &gt;&gt; ${awsoutput_unload_out}</span><span class="sc0">
            
            </span><span class="sc2"># column_item=""</span><span class="sc0">
            </span><span class="sc2"># column_string=""</span><span class="sc0">
            </span><span class="sc2"># continue</span><span class="sc0">
        </span><span class="sc2"># }</span><span class="sc0">
        </span><span class="sc2"># #get values and trim space before and after strings with "xargs"</span><span class="sc0">
        </span><span class="sc2"># column_item=$(echo "${record_line_out}"|cut -f 2- -d " "|xargs)</span><span class="sc0">
        </span><span class="sc2"># column_string="${column_string}${column_item}"</span><span class="sc0">

    </span><span class="sc2"># done</span><span class="sc0">
    
    </span><span class="sc2">#Remove blank lines</span><span class="sc0">
    </span><span class="sc2">#grep -v "^$" ${awsoutput_unload_out} &gt; ${awsoutput_output}</span><span class="sc0">
    </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc10">${awsoutput_unload_out}</span><span class="sc7">|</span><span class="sc4">uniq</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc4">egrep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"constant.*constant"</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awsoutput_output}</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Get missed keys against incremental data</span><span class="sc0">
</span><span class="sc8">awscomp</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awscomp_dir</span><span class="sc7">=</span><span class="sc10">${AWSOUTDIR:="/dmqjtmp/rcp/stage/AWSOutput"}</span><span class="sc0">
    </span><span class="sc8">awscomp_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    
    </span><span class="sc8">awscomp_file</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">
    </span><span class="sc8">awscomp_missed</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc7">.</span><span class="sc8">missed</span><span class="sc0">
    </span><span class="sc8">awscomp_out</span><span class="sc7">=</span><span class="sc10">${awscomp_tmp_dir}</span><span class="sc7">/</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">all</span><span class="sc0">
    
    </span><span class="sc4">cat</span><span class="sc0">  </span><span class="sc10">${awscomp_dir}</span><span class="sc7">/*.</span><span class="sc10">${current_time}</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${awscomp_out}</span><span class="sc0">
    
    </span><span class="sc4">sort</span><span class="sc0"> </span><span class="sc10">${awscomp_file}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">uniq</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">awscomp_record_line</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">integer</span><span class="sc0"> </span><span class="sc8">comp_column_num</span><span class="sc7">=</span><span class="sc3">2</span><span class="sc0">
        </span><span class="sc8">first_column</span><span class="sc7">=</span><span class="sc5">"Y"</span><span class="sc0">
        </span><span class="sc8">grep_string</span><span class="sc7">=</span><span class="sc5">""</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">true</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">awscomp_column_name</span><span class="sc7">=</span><span class="sc11">$(echo "${awscomp_record_line}~"|cut -f${comp_column_num} -d"~"|cut -f1 -d=)</span><span class="sc0">
            </span><span class="sc8">awscomp_column_value</span><span class="sc7">=</span><span class="sc11">$(echo "${awscomp_record_line}~"|cut -f${comp_column_num} -d"~"|cut -f2 -d=)</span><span class="sc0">
            
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${awscomp_column_name}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">date</span><span class="sc9">$
</span><span class="sc0">            </span><span class="sc8">daterc</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
    
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${daterc}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">awscomp_date_year</span><span class="sc7">=</span><span class="sc10">${awscomp_column_value:0:4}</span><span class="sc0">
                </span><span class="sc8">awscomp_date_month</span><span class="sc7">=</span><span class="sc10">${awscomp_column_value:4:2}</span><span class="sc0">
                </span><span class="sc8">awscomp_date_day</span><span class="sc7">=</span><span class="sc10">${awscomp_column_value:6:2}</span><span class="sc0">
        
                </span><span class="sc8">awscomp_column_value</span><span class="sc7">=</span><span class="sc5">"${awscomp_date_year}/${awscomp_date_month}/${awscomp_date_day}"</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${awscomp_column_value}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">""</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                </span><span class="sc4">eval</span><span class="sc0"> </span><span class="sc10">${grep_string}</span><span class="sc0">
                </span><span class="sc8">grep_rc</span><span class="sc7">=</span><span class="sc9">$?</span><span class="sc0">
                </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${grep_rc}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc10">${awscomp_record_line}</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${awscomp_missed}</span><span class="sc0">
                </span><span class="sc4">break</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
            
            </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc10">${first_column}</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"Y"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
            </span><span class="sc4">then</span><span class="sc0">
                </span><span class="sc8">grep_string</span><span class="sc7">=</span><span class="sc5">"grep ${awscomp_column_value} ${awscomp_out}"</span><span class="sc0"> 
                </span><span class="sc8">first_column</span><span class="sc7">=</span><span class="sc5">"N"</span><span class="sc0">
            </span><span class="sc4">else</span><span class="sc0">
                </span><span class="sc8">grep_string</span><span class="sc7">=</span><span class="sc5">"${grep_string}|grep \"${awscomp_column_value}\""</span><span class="sc0">
            </span><span class="sc4">fi</span><span class="sc0">
        
        </span><span class="sc8">comp_column_num</span><span class="sc7">=</span><span class="sc8">comp_column_num+1</span><span class="sc0">
        
        </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc4">done</span><span class="sc0">
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2"># #Find the row number of select_sql with no rows found in dbaccess output file</span><span class="sc0">
</span><span class="sc2"># #Use this row number to identify the SQL in the source sql file</span><span class="sc0">
</span><span class="sc2"># awsmissed () {</span><span class="sc0">
    </span><span class="sc2"># awsmissed_dir=${AWSOUTDIR:="/dmqjtmp/rcp/stage/VaxParserOutput"}</span><span class="sc0">
    </span><span class="sc2"># awsmissed_tmp_dir=${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    
    </span><span class="sc2"># awsmissed_out=${awsmissed_tmp_dir}/MISSED.out</span><span class="sc0">
    </span><span class="sc2"># awsmissed_file=${awsmissed_tmp_dir}/$(basename $1 .sql).missednumber</span><span class="sc0">
    </span><span class="sc2"># awsmissed_start=START$(basename $1)</span><span class="sc0">
    </span><span class="sc2"># awsmissed_stop=STOP$(basename $1)</span><span class="sc0">

    </span><span class="sc2"># cat /dev/null &gt; ${awsmissed_file}</span><span class="sc0">
    </span><span class="sc2"># awk '/'"${awsmissed_stop}"'/{found=0} {if(found) print} /'"${awsmissed_start}"'/{found=1}' \
    # ${awsmissed_out}|grep -iv database |grep -iv "Isolation level"|grep -v "^$" |</span><span class="sc0">
    </span><span class="sc2"># grep -n "row" | grep "No rows found" |</span><span class="sc0">
    </span><span class="sc2"># while read linenumber</span><span class="sc0">
    </span><span class="sc2"># do</span><span class="sc0">
        </span><span class="sc2"># echo $linenumber &gt;&gt; ${awsmissed_file}</span><span class="sc0">
    </span><span class="sc2"># done</span><span class="sc0">
    
    </span><span class="sc2"># #find 18th line</span><span class="sc0">
    </span><span class="sc2"># #sed '18q;d' filename</span><span class="sc0">
    </span><span class="sc2"># #awk 'NR==18 {print;exit}' filename</span><span class="sc0">
    
    </span><span class="sc2"># #sed -n '10,20p' &lt;filename&gt;</span><span class="sc0">
</span><span class="sc2"># }</span><span class="sc0">

</span><span class="sc2"># #Find SQL with no rows found using the number identified by awsmissed ()</span><span class="sc0">
</span><span class="sc2"># awsnorow () {</span><span class="sc0">
    </span><span class="sc2"># awsnorow_dir=${AWSOUTDIR:="/dmqjtmp/rcp/stage/VaxParserOutput"}</span><span class="sc0">
    </span><span class="sc2"># awsnorow_tmp_dir=${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    
    </span><span class="sc2"># awsnorow_sql=$1</span><span class="sc0">
    </span><span class="sc2"># integer awsnorow_line=$2-1</span><span class="sc0">
    
    </span><span class="sc2"># integer awsnorow_sql_lines</span><span class="sc0">
    </span><span class="sc2"># cat ${awsnorow_sql}|while read sqlstop</span><span class="sc0">
    </span><span class="sc2"># do</span><span class="sc0">
        </span><span class="sc2"># awsnorow_sql_lines=awsnorow_sql_lines+1</span><span class="sc0">
        </span><span class="sc2"># [[  "$sqlstop" == ";" ]] &amp;&amp; break</span><span class="sc0">
    </span><span class="sc2"># done</span><span class="sc0">
    
    </span><span class="sc2"># integer awsnorow_line_start=awsnorow_line*awsnorow_sql_lines+1</span><span class="sc0">
    </span><span class="sc2"># integer awsnorow_line_end=awsnorow_line_start+awsnorow_sql_lines-1</span><span class="sc0">
    
    </span><span class="sc2"># sed -n ''"${awsnorow_line_start}"','"${awsnorow_line_end}"'p' ${awsnorow_sql}</span><span class="sc0">

</span><span class="sc2"># }</span><span class="sc0">

</span><span class="sc2">#Run on Produciton Server to put DB image to development server for Informix DB refresh</span><span class="sc0">
</span><span class="sc8">awsput</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">awsput_remote_host</span><span class="sc7">=</span><span class="sc10">${AWSFTPHOST:="ipdev"}</span><span class="sc0">
    </span><span class="sc8">awsput_user</span><span class="sc7">=</span><span class="sc10">${AWSFTPUSER:="lchen"}</span><span class="sc0">
    </span><span class="sc8">awsput_passwd</span><span class="sc7">=</span><span class="sc10">${AWSFTPPASSWD:="admin12"}</span><span class="sc0">
    </span><span class="sc8">awsput_image_dir</span><span class="sc7">=</span><span class="sc10">${AWSFTPLOCALDIR:="/livebkup"}</span><span class="sc0">
    </span><span class="sc8">awsput_remote_dir</span><span class="sc7">=</span><span class="sc10">${AWSFTPREMOTEDIR:="/tmpimage"}</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc11">$(hostname)</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">"$remote_host"</span><span class="sc0"> </span><span class="sc7">]];</span><span class="sc0"> </span><span class="sc4">then</span><span class="sc0"> </span><span class="sc4">return</span><span class="sc7">;</span><span class="sc0"> </span><span class="sc4">fi</span><span class="sc0">
    
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${awsput_image_dir}</span><span class="sc0">
    </span><span class="sc4">ls</span><span class="sc0"> </span><span class="sc8">ipdb_bkup_L0.</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">image</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc10">${awsput_remote_host}</span><span class="sc0"> </span><span class="sc10">${awsput_user}</span><span class="sc0"> </span><span class="sc10">${awsput_passwd}</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${awsput_image_dir}</span><span class="sc0"> </span><span class="sc10">${awsput_remote_dir}</span><span class="sc0"> </span><span class="sc10">${image}</span><span class="sc0"> </span><span class="sc10">${image}</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"image transfer done"</span><span class="sc0"> </span><span class="sc8">lchen</span><span class="sc7">@</span><span class="sc8">livingstonintl.com</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
    
</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Process all VAXFilesParser output files under ${AWSINDIR}</span><span class="sc0">
</span><span class="sc8">aws</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">aws_input_dir</span><span class="sc7">=</span><span class="sc10">${AWSINDIR:="/dmqjtmp/rcp/stage/VaxParserOutput"}</span><span class="sc0">
    </span><span class="sc8">aws_tmp_dir</span><span class="sc7">=</span><span class="sc10">${AWSTMPDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    
    </span><span class="sc2">#Start processing VAX Key files</span><span class="sc0">
    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${aws_input_dir}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">vax_out_put</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">current_time</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">
        
        </span><span class="sc8">awssql</span><span class="sc0"> </span><span class="sc10">${vax_out_put}</span><span class="sc0">
        </span><span class="sc8">awsb3</span><span class="sc0">
        
        </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${aws_tmp_dir}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">current_time_sql</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">awsdbaccess</span><span class="sc0"> </span><span class="sc10">${current_time_sql}</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
        
        </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${aws_tmp_dir}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc10">${current_time}</span><span class="sc7">.</span><span class="sc8">dbaccess</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">current_time_dbaccess_out</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">awsoutput</span><span class="sc0"> </span><span class="sc10">${current_time_dbaccess_out}</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">
        
        </span><span class="sc2">#awscomp ${vax_out_put}</span><span class="sc0">
        
        </span><span class="sc2">#awssend</span><span class="sc0">
                
        </span><span class="sc4">mv</span><span class="sc0"> </span><span class="sc10">${vax_out_put}</span><span class="sc0"> </span><span class="sc10">${aws_input_dir}</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc0">
        
        </span><span class="sc4">sleep</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">     
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Script to run aws jobs in root crontab to process VAX files and key files</span><span class="sc0">
</span><span class="sc8">rundata</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">aws</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0">

    </span><span class="sc8">MAILALERT</span><span class="sc7">=</span><span class="sc5">"lchen@livingstonintl.com"</span><span class="sc0">

    </span><span class="sc2">#AWS's Parameter </span><span class="sc0">
    </span><span class="sc8">AWSDATE</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">
    </span><span class="sc8">AWSTIME</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">

    </span><span class="sc8">AWSRUNDIR</span><span class="sc7">=/</span><span class="sc8">insight</span><span class="sc7">/</span><span class="sc8">local</span><span class="sc7">/</span><span class="sc8">scripts</span><span class="sc7">/</span><span class="sc8">VaxParser</span><span class="sc7">/</span><span class="sc8">tools</span><span class="sc0">

    </span><span class="sc8">AWSINDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">VaxParserOutput</span><span class="sc0">
    </span><span class="sc8">AWSOUTBASE</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">AWSOutput</span><span class="sc0">
    </span><span class="sc8">AWSOUTDIR</span><span class="sc7">=</span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc10">${AWSDATE}</span><span class="sc0">
    </span><span class="sc8">AWSTMPDIR</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">AWS</span><span class="sc7">/</span><span class="sc8">tmp</span><span class="sc0">
    </span><span class="sc8">AWSTMPOUTDIR</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">AWS</span><span class="sc7">/</span><span class="sc10">${AWSDATE}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">

    </span><span class="sc8">AWSREMOTE</span><span class="sc7">=</span><span class="sc5">"ingest@a0almcdhcan01.dev.liiaws.net"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEDATA</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/data/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEKEY</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/key/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEVAX</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/locusvax/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2">#AWSREMOTE="lchen@ifx01"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEDATA="/home/lchen/opt/ingest/informix/data/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEKEY="/home/lchen/opt/ingest/informix/key/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEVAX="/home/lchen/opt/ingest/informix/locusvax/${AWSDATE}"</span><span class="sc0">

    </span><span class="sc2">#VaxParser's Parameter</span><span class="sc0">
    </span><span class="sc8">VAXDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">done</span><span class="sc0">
    </span><span class="sc8">VAXPARSERINDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">vaxparser</span><span class="sc0">
    </span><span class="sc8">VAXPARSERPROCESSEDDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">vaxparserprocessed</span><span class="sc0">
    </span><span class="sc8">VAXPARSEROUTDIR</span><span class="sc7">=</span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc8">VAXPARSERRUNDIR</span><span class="sc7">=/</span><span class="sc8">insight</span><span class="sc7">/</span><span class="sc8">local</span><span class="sc7">/</span><span class="sc8">scripts</span><span class="sc7">/</span><span class="sc8">VaxParser</span><span class="sc0">

    </span><span class="sc8">ICCDATAUPLOADOUTDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">iccdatauploadOutput</span><span class="sc0">
    </span><span class="sc8">ICCBILLINGUPLOADOUTDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">ICCBillingUploadOutput</span><span class="sc0">

    </span><span class="sc8">AWSPRIVATEKEY</span><span class="sc7">=</span><span class="sc9">$AWSRUNDIR</span><span class="sc7">/.</span><span class="sc8">ssh</span><span class="sc7">/</span><span class="sc8">Privatekey</span><span class="sc0">

    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">AWSINDIR</span><span class="sc0"> </span><span class="sc8">AWSOUTDIR</span><span class="sc0"> </span><span class="sc8">AWSRUNDIR</span><span class="sc0"> </span><span class="sc8">AWSTMPDIR</span><span class="sc0"> 
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">VAXPARSERINDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSERPROCESSEDDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSEROUTDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSERRUNDIR</span><span class="sc0">
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">ICCDATAUPLOADOUTDIR</span><span class="sc0"> </span><span class="sc8">ICCBILLINGUPLOADOUTDIR</span><span class="sc0">
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">AWSREMOTE</span><span class="sc0"> </span><span class="sc8">AWSREMOTEDATA</span><span class="sc0"> </span><span class="sc8">AWSREMOTEKEY</span><span class="sc0"> </span><span class="sc8">AWSREMOTEVAX</span><span class="sc0"> </span><span class="sc8">AWSPRIVATEKEY</span><span class="sc0">

    </span><span class="sc2">#Start parse VAX data file</span><span class="sc0">

    </span><span class="sc2">#clear running directory</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$VAXPARSERPROCESSEDDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$VAXPARSERPROCESSEDDIR</span><span class="sc7">/*.</span><span class="sc8">vax</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$VAXPARSERPROCESSEDDIR</span><span class="sc7">/*.</span><span class="sc8">vaxtoken</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*</span><span class="sc0">

    </span><span class="sc2">#Get Locus VAX data files, </span><span class="sc0">
    </span><span class="sc4">touch</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxdone.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$VAXDIR</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc8">vax</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">amin</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc3">10</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vf</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxdone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc9">$VAXPARSERINDIR</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxdone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxdonelast.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">vaxdone.</span><span class="sc9">$AWSDATE</span><span class="sc0">

    </span><span class="sc2">#Parse Locus VAX data file, generate Locus VAX data key files</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$VAXPARSERRUNDIR</span><span class="sc0">
    </span><span class="sc7">./</span><span class="sc8">token.sh</span><span class="sc0">
    </span><span class="sc7">./</span><span class="sc8">awsparser.ksh</span><span class="sc0">

    </span><span class="sc2">#Prepare/Copy Claudio's java ICCDATAUPLOAD key files</span><span class="sc0">


    </span><span class="sc2">#Start generate incremental data and send to AWS</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSRUNDIR</span><span class="sc0">
    </span><span class="sc7">./</span><span class="sc8">shlib</span><span class="sc0"> </span><span class="sc8">aws</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">&gt;</span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">error</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp1</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp2</span><span class="sc0">

    </span><span class="sc2">#cd $AWSINDIR/keydone</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $AWSREMOTEDATA ]] &amp;&amp; mkdir -p $AWSREMOTEDATA"</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $$AWSREMOTEKEY ]] &amp;&amp; mkdir -p $AWSREMOTEKEY"</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $AWSREMOTEVAX ]] &amp;&amp; mkdir -p $AWSREMOTEVAX"</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0">
    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEDATA</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"AWS incremental data upload failed"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">token.sh</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*.</span><span class="sc8">token</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEDATA</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"AWS incremental data upload completed"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*.error"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">size</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">errorfile</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Failed key of $errorfile"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">error</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Errors in SQL MISSED$AWSTIME.out"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#Script to run aws jobs in root crontab to process JAVA key files</span><span class="sc0">
</span><span class="sc8">rundataicc</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">ps</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ef</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc8">grep</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">aws</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">exit</span><span class="sc0">

    </span><span class="sc8">MAILALERT</span><span class="sc7">=</span><span class="sc5">"lchen@livingstonintl.com"</span><span class="sc0">

    </span><span class="sc2">#AWS's Parameter </span><span class="sc0">
    </span><span class="sc8">AWSDATE</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">
    </span><span class="sc8">AWSTIME</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">

    </span><span class="sc8">AWSRUNDIR</span><span class="sc7">=/</span><span class="sc8">insight</span><span class="sc7">/</span><span class="sc8">local</span><span class="sc7">/</span><span class="sc8">scripts</span><span class="sc7">/</span><span class="sc8">VaxParser</span><span class="sc7">/</span><span class="sc8">tools</span><span class="sc0">

    </span><span class="sc8">AWSINDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">VaxParserOutput</span><span class="sc0">
    </span><span class="sc8">AWSOUTBASE</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">AWSOutput</span><span class="sc0">
    </span><span class="sc8">AWSOUTDIR</span><span class="sc7">=</span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc10">${AWSDATE}</span><span class="sc0">
    </span><span class="sc8">AWSTMPDIR</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">AWS</span><span class="sc7">/</span><span class="sc8">tmp</span><span class="sc0">
    </span><span class="sc8">AWSTMPOUTDIR</span><span class="sc7">=/</span><span class="sc8">recyclebox</span><span class="sc7">/</span><span class="sc8">AWS</span><span class="sc7">/</span><span class="sc10">${AWSDATE}</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-d</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mkdir</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">

    </span><span class="sc8">AWSREMOTE</span><span class="sc7">=</span><span class="sc5">"ingest@a0almcdhcan01.dev.liiaws.net"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEDATA</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/data/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEKEY</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/key/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEVAX</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/locusvax/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTE="lchen@ifx01"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEDATA="/home/lchen/opt/ingest/informix/data/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEKEY="/home/lchen/opt/ingest/informix/key/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc2"># AWSREMOTEVAX="/home/lchen/opt/ingest/informix/locusvax/${AWSDATE}"</span><span class="sc0">

    </span><span class="sc2">#VaxParser's Parameter</span><span class="sc0">
    </span><span class="sc8">VAXDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">done</span><span class="sc0">
    </span><span class="sc8">VAXPARSERINDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">vaxparser</span><span class="sc0">
    </span><span class="sc8">VAXPARSERPROCESSEDDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">vaxparserprocessed</span><span class="sc0">
    </span><span class="sc8">VAXPARSEROUTDIR</span><span class="sc7">=</span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc8">VAXPARSERRUNDIR</span><span class="sc7">=/</span><span class="sc8">insight</span><span class="sc7">/</span><span class="sc8">local</span><span class="sc7">/</span><span class="sc8">scripts</span><span class="sc7">/</span><span class="sc8">VaxParser</span><span class="sc0">

    </span><span class="sc8">ICCDATAUPLOADOUTDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">iccdatauploadOutput</span><span class="sc0">
    </span><span class="sc8">ICCBILLINGUPLOADOUTDIR</span><span class="sc7">=/</span><span class="sc8">dmqjtmp</span><span class="sc7">/</span><span class="sc8">rcp</span><span class="sc7">/</span><span class="sc8">stage</span><span class="sc7">/</span><span class="sc8">ICCBillingUploadOutput</span><span class="sc0">

    </span><span class="sc8">AWSPRIVATEKEY</span><span class="sc7">=</span><span class="sc9">$AWSRUNDIR</span><span class="sc7">/.</span><span class="sc8">ssh</span><span class="sc7">/</span><span class="sc8">Privatekey</span><span class="sc0">

    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">AWSINDIR</span><span class="sc0"> </span><span class="sc8">AWSOUTDIR</span><span class="sc0"> </span><span class="sc8">AWSRUNDIR</span><span class="sc0"> </span><span class="sc8">AWSTMPDIR</span><span class="sc0"> 
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">VAXPARSERINDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSERPROCESSEDDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSEROUTDIR</span><span class="sc0"> </span><span class="sc8">VAXPARSERRUNDIR</span><span class="sc0">
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">ICCDATAUPLOADOUTDIR</span><span class="sc0"> </span><span class="sc8">ICCBILLINGUPLOADOUTDIR</span><span class="sc0">
    </span><span class="sc4">export</span><span class="sc0"> </span><span class="sc8">AWSREMOTE</span><span class="sc0"> </span><span class="sc8">AWSREMOTEDATA</span><span class="sc0"> </span><span class="sc8">AWSREMOTEKEY</span><span class="sc0"> </span><span class="sc8">AWSREMOTEVAX</span><span class="sc0"> </span><span class="sc8">AWSPRIVATEKEY</span><span class="sc0">

    </span><span class="sc2">#clear running directory</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*</span><span class="sc0">

    </span><span class="sc2">#Prepare/Copy Claudio's java ICCDATAUPLOAD key files</span><span class="sc0">
    </span><span class="sc2">#ls *${AWSDATE}*.txt |</span><span class="sc0">
    </span><span class="sc4">touch</span><span class="sc0">  </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$ICCDATAUPLOADOUTDIR</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*${AWSDATE}*.txt"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">amin</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc3">15</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vf</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc9">$VAXPARSEROUTDIR</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploaddonelast.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccdatauploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0">

    </span><span class="sc2">#Prepare/Copy ICCBILLINGUPLOAD keys</span><span class="sc0">
    </span><span class="sc2">#ls *${AWSDATE}*.txt |</span><span class="sc0">
    </span><span class="sc4">touch</span><span class="sc0">  </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$ICCBILLINGUPLOADOUTDIR</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*${AWSDATE}*.txt"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">amin</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc3">15</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">vf</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">name</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$name</span><span class="sc0"> </span><span class="sc9">$VAXPARSEROUTDIR</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploaddonelast.</span><span class="sc9">$AWSDATE</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploadcurrent.</span><span class="sc9">$AWSDATE</span><span class="sc0"> </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">iccbillinguploaddone.</span><span class="sc9">$AWSDATE</span><span class="sc0">

    </span><span class="sc2">#Start generate incremental data and send to AWS</span><span class="sc0">
    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSRUNDIR</span><span class="sc0">
    </span><span class="sc7">./</span><span class="sc8">shlib</span><span class="sc0"> </span><span class="sc8">aws</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc7">&gt;</span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;&amp;</span><span class="sc3">1</span><span class="sc0">

    </span><span class="sc2"># #find SQL which returns no row</span><span class="sc0">
    </span><span class="sc2"># cd $AWSRUNDIR</span><span class="sc0">
    </span><span class="sc2"># ./shlib awsnorowfound</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">error</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp1</span><span class="sc0">
    </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPDIR</span><span class="sc7">/*.</span><span class="sc8">tmp2</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc0">
    </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc9">$AWSINDIR</span><span class="sc7">/</span><span class="sc8">keydone</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $AWSREMOTEDATA ]] &amp;&amp; mkdir -p $AWSREMOTEDATA"</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $$AWSREMOTEKEY ]] &amp;&amp; mkdir -p $AWSREMOTEKEY"</span><span class="sc0">

    </span><span class="sc8">ssh</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
    </span><span class="sc5">"[[ ! -d $AWSREMOTEVAX ]] &amp;&amp; mkdir -p $AWSREMOTEVAX"</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc0">
    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEDATA</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">ne</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"AWS incremental data upload failed"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc9">$AWSOUTBASE</span><span class="sc7">/</span><span class="sc8">token.sh</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSOUTDIR</span><span class="sc7">/*.</span><span class="sc8">token</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEDATA</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"AWS incremental data upload completed"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">

    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0">
    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">sql</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/*.</span><span class="sc8">txt</span><span class="sc0">

    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc5">"*.error"</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">size</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">errorfile</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Failed key of $errorfile"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$errorfile</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEKEY</span><span class="sc0">
    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc8">error</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"Errors in SQL MISSED$AWSTIME.out"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$AWSTMPOUTDIR</span><span class="sc7">/</span><span class="sc8">MISSED</span><span class="sc9">$AWSTIME</span><span class="sc7">.</span><span class="sc8">out</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc2">#prepare the no rows found SQLs</span><span class="sc0">
</span><span class="sc8">awsnorowfound</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">TMPSQLDIR</span><span class="sc7">=</span><span class="sc9">$1</span><span class="sc0">

    </span><span class="sc8">tmp_sql_dir</span><span class="sc7">=</span><span class="sc10">${TMPSQLDIR:="/recyclebox/lchen/aws"}</span><span class="sc0">
    </span><span class="sc8">missed_out</span><span class="sc7">=</span><span class="sc10">${tmp_sql_dir}</span><span class="sc7">/</span><span class="sc8">MISSED.out</span><span class="sc0">

    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${tmp_sql_dir}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">missed_sql</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc8">missed_file</span><span class="sc7">=</span><span class="sc10">${tmp_sql_dir}</span><span class="sc7">/</span><span class="sc11">$(basename $missed_sql .sql)</span><span class="sc7">.</span><span class="sc8">missednumber</span><span class="sc0">
        </span><span class="sc8">missed_start</span><span class="sc7">=</span><span class="sc8">START</span><span class="sc11">$(basename $missed_sql)</span><span class="sc0">
        </span><span class="sc8">missed_stop</span><span class="sc7">=</span><span class="sc8">STOP</span><span class="sc11">$(basename $missed_sql)</span><span class="sc0">

        </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${missed_file}</span><span class="sc0">
        </span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'/'</span><span class="sc5">"${missed_stop}"</span><span class="sc6">'/{found=0} {if(found) print} /'</span><span class="sc5">"${missed_start}"</span><span class="sc6">'/{found=1}'</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
        </span><span class="sc10">${missed_out}</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">iv</span><span class="sc0"> </span><span class="sc8">database</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">iv</span><span class="sc0"> </span><span class="sc5">"Isolation level"</span><span class="sc7">|</span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">v</span><span class="sc0"> </span><span class="sc5">"^$"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc5">"row"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc5">"No rows found"</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">linenumber</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$linenumber</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">${missed_file}</span><span class="sc0">
        </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">done</span><span class="sc0">

    </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${tmp_sql_dir}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">name</span><span class="sc0"> </span><span class="sc7">*.</span><span class="sc8">sql</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">print</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">norow_sql</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${tmp_sql_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${norow_sql} .sql)</span><span class="sc7">.</span><span class="sc8">missednumber</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc4">cut</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">f1</span><span class="sc0"> </span><span class="sc8">-d</span><span class="sc7">:</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">norownumber</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc8">norow_line</span><span class="sc7">=$((</span><span class="sc8">norownumber-1</span><span class="sc7">))</span><span class="sc0">

            </span><span class="sc8">sql_lines</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc0">
            </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc10">${norow_sql}</span><span class="sc7">|</span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">sqlstop</span><span class="sc0">
            </span><span class="sc4">do</span><span class="sc0">
                </span><span class="sc8">sql_lines</span><span class="sc7">=$((</span><span class="sc8">sql_lines+1</span><span class="sc7">))</span><span class="sc0">
                </span><span class="sc7">[[</span><span class="sc0">  </span><span class="sc5">"$sqlstop"</span><span class="sc0"> </span><span class="sc7">==</span><span class="sc0"> </span><span class="sc5">";"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
                    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc9">$sql_lines</span><span class="sc0"> </span><span class="sc7">&gt;</span><span class="sc0"> </span><span class="sc10">${tmp_sql_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${norow_sql} .sql)</span><span class="sc7">.</span><span class="sc8">line</span><span class="sc0">
                    </span><span class="sc4">break</span><span class="sc0">
                </span><span class="sc7">}</span><span class="sc0">
            </span><span class="sc4">done</span><span class="sc0">
            
            </span><span class="sc8">lines</span><span class="sc7">=</span><span class="sc11">$(cat ${tmp_sql_dir}/$(basename ${norow_sql} .sql).line)</span><span class="sc0">
            </span><span class="sc8">norow_line_start</span><span class="sc7">=$((</span><span class="sc8">norow_line</span><span class="sc7">*</span><span class="sc8">lines+1</span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc8">norow_line_end</span><span class="sc7">=$((</span><span class="sc8">norow_line_start+lines-1</span><span class="sc7">))</span><span class="sc0">        
            </span><span class="sc4">sed</span><span class="sc0"> </span><span class="sc8">-n</span><span class="sc0"> </span><span class="sc6">''</span><span class="sc5">"${norow_line_start}"</span><span class="sc6">','</span><span class="sc5">"${norow_line_end}"</span><span class="sc6">'p'</span><span class="sc0"> </span><span class="sc10">${norow_sql}</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0"> </span><span class="sc4">grep</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">iv</span><span class="sc0"> </span><span class="sc8">server</span><span class="sc0"> </span><span class="sc7">&gt;&gt;</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${tmp_sql_dir}</span><span class="sc7">/</span><span class="sc11">$(basename ${norow_sql} .sql)</span><span class="sc7">.</span><span class="sc8">norowfound</span><span class="sc0">
            
        </span><span class="sc4">done</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">aws_whole_table</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc8">MAILALERT</span><span class="sc7">=</span><span class="sc5">"lchen@livingstonintl.com"</span><span class="sc0">

    </span><span class="sc2">#AWS's Parameter </span><span class="sc0">
    </span><span class="sc8">AWSDATE</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">
    </span><span class="sc8">AWSTIME</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">
    </span><span class="sc8">AWSRUNDIR</span><span class="sc7">=/</span><span class="sc8">insight</span><span class="sc7">/</span><span class="sc8">local</span><span class="sc7">/</span><span class="sc8">scripts</span><span class="sc7">/</span><span class="sc8">VaxParser</span><span class="sc7">/</span><span class="sc8">tools</span><span class="sc0">
    </span><span class="sc8">AWSREMOTE</span><span class="sc7">=</span><span class="sc5">"ingest@a0almcdhcan01.dev.liiaws.net"</span><span class="sc0">
    </span><span class="sc8">AWSREMOTEDATA</span><span class="sc7">=</span><span class="sc5">"/opt/ingest/informix/key/${AWSDATE}"</span><span class="sc0">
    </span><span class="sc8">AWSPRIVATEKEY</span><span class="sc7">=</span><span class="sc9">$AWSRUNDIR</span><span class="sc7">/.</span><span class="sc8">ssh</span><span class="sc7">/</span><span class="sc8">Privatekey</span><span class="sc0">

    </span><span class="sc4">for</span><span class="sc0"> </span><span class="sc8">aws_table</span><span class="sc0"> </span><span class="sc4">in</span><span class="sc0"> </span><span class="sc9">$AWSTABLE</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc9">$TABLEUNLOADDIR</span><span class="sc0">
        </span><span class="sc4">rm</span><span class="sc0"> </span><span class="sc8">-f</span><span class="sc0"> </span><span class="sc9">$TABLEUNLOADDIR</span><span class="sc7">/</span><span class="sc10">${aws_table}</span><span class="sc7">*</span><span class="sc0">
        
        </span><span class="sc8">tunload</span><span class="sc0"> </span><span class="sc10">${aws_table}</span><span class="sc0">
        </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">i</span><span class="sc0"> </span><span class="sc9">$AWSPRIVATEKEY</span><span class="sc0"> </span><span class="sc9">$TABLEUNLOADDIR</span><span class="sc7">/</span><span class="sc10">${aws_table}</span><span class="sc7">*</span><span class="sc0"> </span><span class="sc9">$AWSREMOTE</span><span class="sc7">:</span><span class="sc9">$AWSREMOTEDATA</span><span class="sc0">
        </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$?</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">eq</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
            </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"AWS ${aws_table} upload completed"</span><span class="sc0"> </span><span class="sc5">"$MAILALERT"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
            </span><span class="sc7">}</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">immigrate_files</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc2"># $ cat imm.file</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/Templates/dicomnb_template.rtf</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/Templates/dicomsb_template.rtf</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/CMSession.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/CMSession.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/Carrier.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/Carrier.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/CoverPage.cfg</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWB1.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWB1.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWB2.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWB2.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWBSB.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessDICOMWBSB.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessRNSFiles.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessRNSFiles.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessStatUpdSB.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessStatUpdSB.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB.ini</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB1.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB1.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB2.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ProcessWBSB2.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ShadowRouter.class</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ShadowRouter.ini</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/ShadowRouter.java</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/carriercode.ini</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/carrierprobills.ini</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/dicom.jpg</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/exceptions.ini</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/startprocessDICOMWB1cron.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/startprocessDICOMWB2cron.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/startprocessDICOMWBSBcron.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/stopprocessDICOMWB1.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/stopprocessDICOMWB2.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/stopprocessDICOMWBSB.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/startAll.sh</span><span class="sc0">
    </span><span class="sc2"># /admsrv/local/apps/rns/stopAll.sh</span><span class="sc0">
    
    </span><span class="sc2">##Date &amp; Time</span><span class="sc0">
    </span><span class="sc8">current_date</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d)</span><span class="sc0">
    </span><span class="sc8">current_time</span><span class="sc7">=</span><span class="sc11">$(date +%Y%m%d%H%M%S)</span><span class="sc0">

    </span><span class="sc8">sourcehost</span><span class="sc7">=</span><span class="sc8">cm07</span><span class="sc0">

    </span><span class="sc4">cat</span><span class="sc0"> </span><span class="sc8">imm.file</span><span class="sc0"> </span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">immigratefile</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc9">$immigratefile</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc4">cp</span><span class="sc0"> </span><span class="sc8">-p</span><span class="sc0"> </span><span class="sc9">$immigratefile</span><span class="sc0"> </span><span class="sc9">$immigratefile</span><span class="sc7">.</span><span class="sc9">$current_time</span><span class="sc0">
            </span><span class="sc8">scp</span><span class="sc0"> </span><span class="sc9">$sourcehost</span><span class="sc7">:</span><span class="sc9">$immigratefile</span><span class="sc0"> </span><span class="sc9">$immigratefile</span><span class="sc0">
    </span><span class="sc4">done</span><span class="sc0">


</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">send_report</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">

    </span><span class="sc8">local_dir</span><span class="sc7">=</span><span class="sc11">$(dirname $1)</span><span class="sc0">
    </span><span class="sc8">local_name</span><span class="sc7">=</span><span class="sc11">$(basename $1)</span><span class="sc0">
    
    </span><span class="sc8">remote_dir</span><span class="sc7">=</span><span class="sc11">$(dirname $2)</span><span class="sc0">
    </span><span class="sc8">remote_name</span><span class="sc7">=</span><span class="sc11">$(basename $2)</span><span class="sc0">

    </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc7">!</span><span class="sc0"> </span><span class="sc4">-e</span><span class="sc0"> </span><span class="sc10">${local_name}</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0"> </span><span class="sc7">&amp;&amp;</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
        </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) NO_LOCAL_FILE to send"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">
        </span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">1</span><span class="sc0">
    </span><span class="sc7">}</span><span class="sc0">

    </span><span class="sc4">cd</span><span class="sc0"> </span><span class="sc10">${local_dir}</span><span class="sc0">

    </span><span class="sc8">ftp_put</span><span class="sc0"> </span><span class="sc10">${remotehost}</span><span class="sc0"> </span><span class="sc10">${username}</span><span class="sc0"> </span><span class="sc10">${password}</span><span class="sc0"> </span><span class="sc10">${local_dir}</span><span class="sc0"> </span><span class="sc10">${remote_dir}</span><span class="sc0"> </span><span class="sc10">${local_name}</span><span class="sc0"> </span><span class="sc10">${remote_name}</span><span class="sc0">
    </span><span class="sc4">mail</span><span class="sc0"> </span><span class="sc8">-s</span><span class="sc0"> </span><span class="sc5">"$(hostname) Large file REPORT SEND"</span><span class="sc0"> </span><span class="sc5">"${mail_alert}"</span><span class="sc0"> </span><span class="sc7">&lt;</span><span class="sc0"> </span><span class="sc7">/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc0">


</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc8">large_file_report</span><span class="sc0"> </span><span class="sc7">()</span><span class="sc0"> </span><span class="sc7">{</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">E15</span><span class="sc0"> </span><span class="sc8">TOTAL_SIZE</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc7">.</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">E15</span><span class="sc0"> </span><span class="sc8">F_SIZE</span><span class="sc7">=</span><span class="sc3">0</span><span class="sc7">.</span><span class="sc3">0</span><span class="sc0">
    </span><span class="sc4">typeset</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">E15</span><span class="sc0"> </span><span class="sc8">MONITOR_FILE_SIZE</span><span class="sc0">

    </span><span class="sc8">PLATFORM</span><span class="sc7">=</span><span class="sc11">$(uname)</span><span class="sc0">

    </span><span class="sc8">MONITOR_FILE_SIZE</span><span class="sc7">=</span><span class="sc10">${1-500}</span><span class="sc0">      </span><span class="sc2">#default 500M</span><span class="sc0">
    </span><span class="sc7">((</span><span class="sc8">MONITOR_FILE_SIZE</span><span class="sc7">=(</span><span class="sc8">MONITOR_FILE_SIZE</span><span class="sc7">*</span><span class="sc3">1024</span><span class="sc7">)*</span><span class="sc3">2</span><span class="sc7">))</span><span class="sc0">    </span><span class="sc2">#number of blocks (512 bytes per block)</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"AIX"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">mount_point_column</span><span class="sc7">=</span><span class="sc3">2</span><span class="sc0">
        </span><span class="sc8">fstype_monitor</span><span class="sc7">=</span><span class="sc5">"grep jfs"</span><span class="sc0">
        </span><span class="sc8">output_item</span><span class="sc7">=</span><span class="sc5">"f_perm f_num_link f_owner f_group F_SIZE f_modify_month f_modify_date f_modify_time f_name"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">if</span><span class="sc0"> </span><span class="sc7">[[</span><span class="sc0"> </span><span class="sc9">$PLATFORM</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc5">"Linux"</span><span class="sc0"> </span><span class="sc7">]]</span><span class="sc0">
    </span><span class="sc4">then</span><span class="sc0">
        </span><span class="sc8">mount_point_column</span><span class="sc7">=</span><span class="sc3">3</span><span class="sc0">
        </span><span class="sc8">fstype_monitor</span><span class="sc7">=</span><span class="sc5">"grep ext"</span><span class="sc0">
        </span><span class="sc8">output_item</span><span class="sc7">=</span><span class="sc5">"f_perm f_num_link f_owner f_group F_SIZE f_modify_month f_modify_date f_modify_time f_name"</span><span class="sc0">
    </span><span class="sc4">fi</span><span class="sc0">

    </span><span class="sc4">printf</span><span class="sc0"> </span><span class="sc5">"%-12s %-8s %18s %-50s\r\n"</span><span class="sc0">  </span><span class="sc8">Owner</span><span class="sc0"> </span><span class="sc8">Size</span><span class="sc0"> </span><span class="sc8">Last_Modify_Time</span><span class="sc0"> </span><span class="sc8">Name</span><span class="sc0">

    </span><span class="sc4">mount</span><span class="sc7">|</span><span class="sc10">${fstype_monitor}</span><span class="sc7">|</span><span class="sc4">awk</span><span class="sc0"> </span><span class="sc6">'{print $'</span><span class="sc10">${mount_point_column}</span><span class="sc6">'}'</span><span class="sc7">|</span><span class="sc0">
    </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc8">mount_point</span><span class="sc0">
    </span><span class="sc4">do</span><span class="sc0">
        </span><span class="sc4">find</span><span class="sc0"> </span><span class="sc10">${mount_point}</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">xdev</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">-</span><span class="sc8">type</span><span class="sc0"> </span><span class="sc8">f</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">-</span><span class="sc8">size</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc10">${MONITOR_FILE_SIZE}</span><span class="sc0"> </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc7">-</span><span class="sc8">exec</span><span class="sc0"> </span><span class="sc8">ls</span><span class="sc0"> </span><span class="sc7">-</span><span class="sc8">la</span><span class="sc0"> </span><span class="sc7">{}</span><span class="sc0"> </span><span class="sc8">\;</span><span class="sc0"> </span><span class="sc3">2</span><span class="sc7">&gt;/</span><span class="sc8">dev</span><span class="sc7">/</span><span class="sc8">null</span><span class="sc7">|</span><span class="sc0">
        </span><span class="sc4">while</span><span class="sc0"> </span><span class="sc4">read</span><span class="sc0"> </span><span class="sc10">${output_item}</span><span class="sc0">
        </span><span class="sc4">do</span><span class="sc0">
            </span><span class="sc7">((</span><span class="sc8">F_SIZE</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc7">(</span><span class="sc8">F_SIZE</span><span class="sc7">/</span><span class="sc3">1024</span><span class="sc7">)/</span><span class="sc3">1024</span><span class="sc7">))</span><span class="sc0">
            </span><span class="sc7">((</span><span class="sc8">TOTAL_SIZE</span><span class="sc0"> </span><span class="sc7">=</span><span class="sc0"> </span><span class="sc8">TOTAL_SIZE</span><span class="sc0"> </span><span class="sc7">+</span><span class="sc0"> </span><span class="sc8">F_SIZE</span><span class="sc7">))</span><span class="sc0">
            
            </span><span class="sc4">printf</span><span class="sc0"> </span><span class="sc5">"%-12s %8.2fM %4s %-3s %-8s %-50s\r\n"</span><span class="sc0">   </span><span class="sc7">\</span><span class="sc0">
            </span><span class="sc10">${f_owner}</span><span class="sc0"> </span><span class="sc10">${F_SIZE}</span><span class="sc0"> </span><span class="sc10">${f_modify_month}</span><span class="sc0"> </span><span class="sc10">${f_modify_date}</span><span class="sc0"> </span><span class="sc10">${f_modify_time}</span><span class="sc0"> </span><span class="sc10">${f_name}</span><span class="sc0">
        
        </span><span class="sc4">done</span><span class="sc0">
        
    </span><span class="sc4">done</span><span class="sc0">
            
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\r\n"</span><span class="sc0">
    </span><span class="sc4">printf</span><span class="sc0"> </span><span class="sc5">"HOST[$(hostname)] Total Large File Size:   %15.2fM\n"</span><span class="sc0"> </span><span class="sc10">${TOTAL_SIZE}</span><span class="sc0">
    </span><span class="sc4">echo</span><span class="sc0"> </span><span class="sc5">"\r\n"</span><span class="sc0">

</span><span class="sc7">}</span><span class="sc0">

</span><span class="sc9">$@</span><span class="sc0">

</span><span class="sc4">exit</span><span class="sc0"> </span><span class="sc3">0</span><span class="sc0">
</span></div></body>
</html>
